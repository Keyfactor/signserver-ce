<!doctype html>

<html class="no-js" lang="en" data-vp-page-id="371000794">


    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="_scroll_external/attachments/e415105eb31a/ssdocs">

    <!-- Primary Meta Tags -->
    <meta name="exp-export-timestamp" content="2024-11-07T13:05:46.537+0000">
    <meta name="exp-page-id" content="371000794">
    <meta name="exp-page-title" content="Key Wrapping">
    <meta name="exp-page-version" content="2">
    <meta name="exp-page-scroll-page-id" content="70f3b6e6654f7945fe6378a9f230c86d">
    <meta name="exp-page-created" content="2022-08-20T10:38:20.000+0000">
    <meta name="exp-page-last-modified" content="2024-04-05T07:56:26.726+0000">
    <meta name="exp-page-labels" content="dss-1567,key_wrapping,signserveree">
    <meta name="exp-page-context-keys" content="">
    <meta name="exp-space-key" content="SSDOCS">
    <meta name="exp-space-title" content="SignServer Documentation">

    <!-- Additional Meta Tags -->
    <meta name="exp-document-id" content="371111034">
    <meta name="exp-document-title" content="SignServer Documentation">
    <meta name="exp-version-status" content="in-progress">
    <meta name="exp-version-id" content="8a3e757d15e64586aa644eaf0980f27a">
    <meta name="exp-version-name" content="Working version">
    <meta name="exp-version-description" content="">
    <meta name="exp-version-date" content="2024-02-17T13:18:25Z">
    <meta name="exp-variant-id" content="">
    <meta name="exp-variant-name" content="">
    <meta name="exp-variant-description" content="">
    <meta name="exp-language-code" content="">
    <meta name="exp-language-name" content="">

    <link rel="stylesheet" href="css/app.css">



<script id="search-worker" type="javascript/worker">
    onmessage = function(event) {
        // dispatch events to handling functions
        var message = event.data;

        if ((message.type === 'setup') && message.baseUrl) {
            setup(message.baseUrl);
        }

        if (message.type === 'search-request') {
            search(message.query);
        }
    }

    var searchIndex;

    function setup(baseUrl) {
        importScripts(
            baseUrl + 'js/lunr.js',
            baseUrl + 'js/lunr-index.js',
            baseUrl + 'js/lunr-data.js'
        );
        try {
            // load lunr-extras if it exists, which contains language-specific files for languages other than english
            importScripts(baseUrl + 'js/lunr-extras.js');
        } catch (e) {}
        searchIndex = lunr.Index.load(lunrIndex);
    }

    function search(query) {
        var searchHits = searchIndex.search(query);
        var results = searchHits.map(function (result) {
            return lunrData.filter(function (d) {
                return d.id === result.ref;
            })[0]
        });
        postMessage({ type: 'search-results', results: results, query: query });
    }
</script>
    <title>Key Wrapping</title>

<meta name="generator" content="Scroll HTML Exporter / K15t GmbH"></head>
    <!-- pageid attribute is deprecated - please use data-vp-page-id on html element instead -->
    <body id="KeyWrapping-top" pageid="371000794" class="flex flex-col" data-confluence-editor-version="v1">
        <div id="vp-js-desktop__navigation__skip-to-navigation-link"></div>




<header class="home-icon-container flex justify-between header hc-header-background-color hc-header-background-color ">
    <div class="header__navigation--logo">
        <a href="SignServer_Documentation.html">
            <img src="_scroll_external/attachments/e415105eb31a/ssdocs" alt="SignServer Documentation" title="SignServer Documentation">
        </a>
    </div>
        <div class="top-bar-right no-print header__navigation--large__menu hc-header-background-color">
    

    <div data-vp-id="search-bar-placeholder" data-vp-component="search-bar" class="vp-search-bar" aria-hidden="true">
        <form action="/search.html" method="GET" class="vp-search-bar__input-container">
            <div data-vp-component="search-input" data-vp-variant="border" class="vp-search-input vp-search-input--border">
                <input type="search" id="search-texbox" autocomplete="off" class="vp-search-input__input" style="margin-right: 0;">
                <div class="vp-search-input__icon" aria-hidden="true">
                    <span class="vp-icon material-icons mdi-magnify w-6 h-6 text-icon-md"></span>
                </div>
            </div>
        </form>
        <div id="search-suggestion-container" class="vp-search-suggestion-panel" data-vp-component="search-suggestion"></div>
        <template id="search-suggestion-option-template">
            <div class="vp-search-suggestion-option-container vp-search-form__suggestion">
                <a class="vp-search-suggestion-option vp-search-form__suggestion" href=""></a>
            </div>
        </template>
    </div>

        </div>
</header>

        <main>



<div class="vp-article vp-container vp-container--with-content-padding article vp-container--full full vp-article--wide">
    <div class="flex">

        <div id="exp-navigation-wrapper" class="hidden lg:block">
            <iframe src="toc.html?pageId=371000794" class="border-0"></iframe>
        </div>


        <div class="vp-article__content-panel flex-auto grid-container full js-loading" id="article-content">
            <article role="article">
                <header>
<nav aria-label="Breadcrumb" role="navigation">
    <div class="breadcrumbs-wrapper">
        <ol class="breadcrumbs breadcrumbs--fit-content js-loading js-loading__stacked js-loading__stacked--breadcrumb">
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Documentation.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Documentation</a>
                </li>
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Reference.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Reference</a>
                </li>
            <li class="breadcrumbs--active js-hide-until-loaded">
                <a href="Key_Wrapping.html" target="_self" aria-current="page">Key Wrapping</a>
            </li>
        </ol>
        <div class="breadcrumbs-wrapper__scroll-mask"></div>
    </div>
</nav>
                    <!-- CSS class article__heading is deprecated and will be removed in the future -->
                    <h1 class="cell vp-article__heading article__heading js-loading js-loading__stacked js-loading__stacked--heading scroll-h1 scroll-original-h1 scroll-relative-h1 scroll-custom-section-heading scroll-document-section-heading" role="heading" data-scroll-heading-rank="1" data-scroll-original-heading-rank="1" data-scroll-relative-heading-rank="1" id="no-src_generated-id-a45f3718253cf989664842623233a1fa525f6f3143bab628752641944e2ec312"><span class="js-hide-until-loaded">Key Wrapping</span></h1>
                </header>
                <section class="page" id="content" role="main">
                    <div id="vp-js-desktop__navigation__skip-to-navigation-target"></div>
                    <div id="main-content" class="wiki-content article__content js-tocBot-content js-hide-until-loaded">
                        <p><span class="status-macro aui-lozenge aui-lozenge-complete">enterprise</span></p><h2 id="KeyWrapping-Introduction" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">Introduction</h2><p>Key wrapping allows solving issues arising when the number of keys you need to handle exceeds the amount that can be stored in a limited storage space for an HSM. The feature enables exporting the key material in a protected manner and storing the wrapped, encrypted key in an external database.</p><p>A key-pair is generated within the HSM and the private key is wrapped (that is, encrypted with a secret key in the HSM) and exported and stored in the database. When you are going to sign with the key, the wrapped key is fetched from the database and unwrapped in the HSM, used for signing and then removed from the HSM again. Keys are thus only available in the HSM when used and only take up space in the HSM during that time.</p><p>For information on the steps required to set up key wrapping, see <a href="Setting_up_Key_Wrapping.html" data-linked-resource-id="370999522" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="370999522" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999522/Setting+up+Key+Wrapping" data-scroll-link-target-source-id="370999522">Setting up Key Wrapping</a>.</p><p>The following displays an overview of the key wrapping operations:</p><p><span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><img class="confluence-embedded-image scroll-document-image" height="250" src="_scroll_external/attachments/1cf6d2ccaad9/keywrappingoverview.png"></span></p><ul><li>The Source Crypto Worker contains a Crypto Token in order to communicate with the HSM and perform key operations. The wrapping key (secret key: <code>aeskey001)</code> is created in the HSM using the Source Crypto Token.<br clear="none"><br clear="none"></li><li><p>The Key Wrapping Crypto Worker contains a Key Wrapping Crypto Token in order to perform wrapped key operations.&nbsp;The Key Wrapping Crypto Worker references the Source Crypto Worker to get hold of HSM objects and perform key operations in the HSM.</p><p>The main operations of the Key Wrapping Crypto Token are to generate the wrapped key and to unwrap the wrapped key (using the wrapping key) in the HSM to be used for signing.<br clear="none"><br clear="none"></p></li><li><p>The Plain Signer references the Key Wrapping Crypto Worker in order to perform a signing operation. The Plain Signer can be configured to use either a fixed key <code>(fixedkey01)</code> or an individual user key (<code>userkey1/userkey2/userkey3</code>) depending on the requirement.</p></li></ul><h2 id="KeyWrapping-Prerequisites" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">Prerequisites</h2><p>The key wrapping use case requires that the key wrapping functions PKCS#11 C_WrapKey and C_UnwrapKey are supported and allowed by both the HSM and the crypto token.</p><p>The SignServer <a href="PKCS11CryptoToken.html" data-linked-resource-id="371000127" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="371000127" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000127/PKCS11CryptoToken" data-scroll-link-target-source-id="371000127">PKCS11CryptoToken</a> uses the SunPKCS11 provider/wrapper from Java for interactions with the HSM and this provider/wrapper does not implement wrapping functions. Instead, the new P11NG provider in SignServer can be used, using the <a href="P11NGCryptoToken.html" data-linked-resource-id="371000135" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="371000135" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000135/P11NGCryptoToken" data-scroll-link-target-source-id="371000135">P11NGCryptoToken</a>. Additionally, for the key wrapping functionality, the <a href="P11NGKeyWrappingCryptoToken.html" data-linked-resource-id="371000143" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="371000143" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000143/P11NGKeyWrappingCryptoToken" data-scroll-link-target-source-id="371000143">P11NGKeyWrappingCryptoToken</a> or the <a href="P11NGKeyWrappingCryptoWorker.html" data-linked-resource-id="371000098" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="371000098" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000098/P11NGKeyWrappingCryptoWorker" data-scroll-link-target-source-id="371000098">P11NGKeyWrappingCryptoWorker</a> can also be used.</p><p>Note that since the key material is stored in the database, this use case is not supported when running SignServer without database (also called NoDB mode).</p><h2 id="KeyWrapping-Limitations" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">Limitations</h2><p>As of SignServer 4.3, the key wrapping use case has been successfully tested on the SafeNet ProtectServer Gold (HSM emulator).</p><p>While the key wrapping feature has been tested on Thales nCipher there are some open issues with stability. If using Thales nCipher, the following environment variable needs to be set:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">export CKNFAST_OVERRIDE_SECURITY_ASSURANCES=</code><code class="string">"tokenkeys;explicitness"</code></div>
</div>
</div><p>The following algorithms are supported:</p><ul><li>Key algorithms: AES, RSA and ECDSA.</li><li>Signature algorithms: <span style="color: rgb(0,0,0);">SHAxwithRSA, SHAxwithRSAandMGF1 and SHAxwithECDSA.</span></li></ul><p>Note that EdDSA is not yet supported.</p>
<nav id="ht-post-nav">
        <a href="Client-Side_Hashing.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Client-Side Hashing</span>
        </a>

        <a href="Developer_Reference.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Developer Reference</span>
        </a>
</nav>
                    </div>
                </section>
            </article>
        </div>

        <div class="vp-article__aside-right flex-shrink-0 w-1/6 article__toc hidden xl:block no-print">
            <div class="vp-scrollable-container vp-scrollable-container--hidden-scrollbars">
                <div class="js-tocBot">
                                    </div>
            </div>
        </div>

    </div>
</div>
        </main>


        <div id="vp-js-mobile__navigation">
            <div tabindex="-1" class="vp-mobile-navigation__trigger fixed outline-none z-mobile-menu-trigger">
                <button type="button" class="vp-button vp-button--variant-floating-action vp-mobile-navigation__button flex items-center justify-center" aria-label="navigation.open.label">
                    <div class="vp-mobile-navigation__button__icon relative">
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                    </div>
                </button>
            </div>
        </div>

        <script src="js/app.js"></script>
    </body>
</html>