<!doctype html>

<html class="no-js" lang="en" data-vp-page-id="371000481">


    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="_scroll_external/attachments/e415105eb31a/ssdocs">

    <!-- Primary Meta Tags -->
    <meta name="exp-export-timestamp" content="2024-11-07T13:05:33.877+0000">
    <meta name="exp-page-id" content="371000481">
    <meta name="exp-page-title" content="Logging and Monitoring">
    <meta name="exp-page-version" content="1">
    <meta name="exp-page-scroll-page-id" content="fbbdae2152c68e3ccaabd3477664640f">
    <meta name="exp-page-created" content="2022-11-18T15:06:40.000+0000">
    <meta name="exp-page-last-modified" content="2022-11-25T15:15:27.000+0000">
    <meta name="exp-page-labels" content="">
    <meta name="exp-page-context-keys" content="">
    <meta name="exp-space-key" content="SSDOCS">
    <meta name="exp-space-title" content="SignServer Documentation">

    <!-- Additional Meta Tags -->
    <meta name="exp-document-id" content="371111034">
    <meta name="exp-document-title" content="SignServer Documentation">
    <meta name="exp-version-status" content="in-progress">
    <meta name="exp-version-id" content="8a3e757d15e64586aa644eaf0980f27a">
    <meta name="exp-version-name" content="Working version">
    <meta name="exp-version-description" content="">
    <meta name="exp-version-date" content="2024-02-17T13:18:25Z">
    <meta name="exp-variant-id" content="">
    <meta name="exp-variant-name" content="">
    <meta name="exp-variant-description" content="">
    <meta name="exp-language-code" content="">
    <meta name="exp-language-name" content="">

    <link rel="stylesheet" href="css/app.css">



<script id="search-worker" type="javascript/worker">
    onmessage = function(event) {
        // dispatch events to handling functions
        var message = event.data;

        if ((message.type === 'setup') && message.baseUrl) {
            setup(message.baseUrl);
        }

        if (message.type === 'search-request') {
            search(message.query);
        }
    }

    var searchIndex;

    function setup(baseUrl) {
        importScripts(
            baseUrl + 'js/lunr.js',
            baseUrl + 'js/lunr-index.js',
            baseUrl + 'js/lunr-data.js'
        );
        try {
            // load lunr-extras if it exists, which contains language-specific files for languages other than english
            importScripts(baseUrl + 'js/lunr-extras.js');
        } catch (e) {}
        searchIndex = lunr.Index.load(lunrIndex);
    }

    function search(query) {
        var searchHits = searchIndex.search(query);
        var results = searchHits.map(function (result) {
            return lunrData.filter(function (d) {
                return d.id === result.ref;
            })[0]
        });
        postMessage({ type: 'search-results', results: results, query: query });
    }
</script>
    <title>Logging and Monitoring</title>

<meta name="generator" content="Scroll HTML Exporter / K15t GmbH"></head>
    <!-- pageid attribute is deprecated - please use data-vp-page-id on html element instead -->
    <body id="LoggingandMonitoring-top" pageid="371000481" class="flex flex-col" data-confluence-editor-version="v1">
        <div id="vp-js-desktop__navigation__skip-to-navigation-link"></div>




<header class="home-icon-container flex justify-between header hc-header-background-color hc-header-background-color ">
    <div class="header__navigation--logo">
        <a href="SignServer_Documentation.html">
            <img src="_scroll_external/attachments/e415105eb31a/ssdocs" alt="SignServer Documentation" title="SignServer Documentation">
        </a>
    </div>
        <div class="top-bar-right no-print header__navigation--large__menu hc-header-background-color">
    

    <div data-vp-id="search-bar-placeholder" data-vp-component="search-bar" class="vp-search-bar" aria-hidden="true">
        <form action="/search.html" method="GET" class="vp-search-bar__input-container">
            <div data-vp-component="search-input" data-vp-variant="border" class="vp-search-input vp-search-input--border">
                <input type="search" id="search-texbox" autocomplete="off" class="vp-search-input__input" style="margin-right: 0;">
                <div class="vp-search-input__icon" aria-hidden="true">
                    <span class="vp-icon material-icons mdi-magnify w-6 h-6 text-icon-md"></span>
                </div>
            </div>
        </form>
        <div id="search-suggestion-container" class="vp-search-suggestion-panel" data-vp-component="search-suggestion"></div>
        <template id="search-suggestion-option-template">
            <div class="vp-search-suggestion-option-container vp-search-form__suggestion">
                <a class="vp-search-suggestion-option vp-search-form__suggestion" href=""></a>
            </div>
        </template>
    </div>

        </div>
</header>

        <main>



<div class="vp-article vp-container vp-container--with-content-padding article vp-container--full full vp-article--wide">
    <div class="flex">

        <div id="exp-navigation-wrapper" class="hidden lg:block">
            <iframe src="toc.html?pageId=371000481" class="border-0"></iframe>
        </div>


        <div class="vp-article__content-panel flex-auto grid-container full js-loading" id="article-content">
            <article role="article">
                <header>
<nav aria-label="Breadcrumb" role="navigation">
    <div class="breadcrumbs-wrapper">
        <ol class="breadcrumbs breadcrumbs--fit-content js-loading js-loading__stacked js-loading__stacked--breadcrumb">
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Documentation.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Documentation</a>
                </li>
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Reference.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Reference</a>
                </li>
                <li class="js-hide-until-loaded">
                    <a href="SignServer_TimeMonitor_Application.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer TimeMonitor Application</a>
                </li>
                <li class="js-hide-until-loaded">
                    <a href="SignServer_TimeMonitor_Overview.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer TimeMonitor Overview</a>
                </li>
            <li class="breadcrumbs--active js-hide-until-loaded">
                <a href="Logging_and_Monitoring.html" target="_self" aria-current="page">Logging and Monitoring</a>
            </li>
        </ol>
        <div class="breadcrumbs-wrapper__scroll-mask"></div>
    </div>
</nav>
                    <!-- CSS class article__heading is deprecated and will be removed in the future -->
                    <h1 class="cell vp-article__heading article__heading js-loading js-loading__stacked js-loading__stacked--heading scroll-h1 scroll-original-h1 scroll-relative-h1 scroll-custom-section-heading scroll-document-section-heading" role="heading" data-scroll-heading-rank="1" data-scroll-original-heading-rank="1" data-scroll-relative-heading-rank="1" id="no-src_generated-id-b2cff8cf1a31921c070cf37078b1c49fc2ea466c7a0fc92aacca5d5628fa2b4f"><span class="js-hide-until-loaded">Logging and Monitoring</span></h1>
                </header>
                <section class="page" id="content" role="main">
                    <div id="vp-js-desktop__navigation__skip-to-navigation-target"></div>
                    <div id="main-content" class="wiki-content article__content js-tocBot-content js-hide-until-loaded">
                        <p>The following sections cover logging the time, report, and leap state and monitoring the current state of the TimeMonitor application.</p><h2 id="LoggingandMonitoring-Logging" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">Logging</h2><p>Logging is configured in <strong>conf/log4j.properties</strong> (given that the wrapper scripts in <strong>bin/</strong> are used to run the application).</p><p>By default, events at <strong>INFO</strong> level are logged to a local file called signserver-timemonitor.log.</p><p>It is recommended to use syslog or similar mechanisms to send the logs to a remote server where they can be inspected when the time is detected to be out of sync.</p><p>The TimeMonitor maintains three types of states: <strong>Time state</strong>, <strong>Report state</strong>, and <strong>Leap state</strong>.</p><h3 id="LoggingandMonitoring-TimeState" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Time State</h3><p>Time State for time synchronization describes the status of the time source and can be:</p><ul><li><strong>INSYNC</strong>: The time is in sync as it was detected to be within the configured range.</li><li><strong>SOON_OUT_OF_SYNC</strong>: The time is in sync but was detected to be within the configured range to give a warning.</li><li><strong>OUT_OF_SYNC</strong>: The time was detected to be out of sync.</li><li><strong>UNKNOWN</strong>: The status of the time is unknown as the time server has not yet been contacted, it could not be contacted, or some other error occurred preventing the TimeMonitor from getting the status.</li></ul><h3 id="LoggingandMonitoring-ReportState" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Report State</h3><p>Report State describes the status of the publishing of the results to SignServer and can be:</p><ul><li><strong>REPORTED</strong>: The results were successfully published to SignServer.</li><li><strong>REPORTED_BUT_EXPIRE_TIME_SHORT</strong>: The results were successfully published to SignServer but the time it took to perform the measurements and publish it was longer than the time configured as timemonitor.warnRunTime. The log gives more information about the actual run time and how much time was spent during the query and publishing when the state changes to this state.</li><li><strong>FAILED_TO_REPORT</strong>:&nbsp;The results could not be published to SignServer. An error message could be available in the log when the state changes to this state.</li></ul><h3 id="LoggingandMonitoring-LeapState" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Leap State</h3><p>Leap State is reported to SignServer with the following values:&nbsp;</p><ul><li><strong>NONE</strong>: No leap second is scheduled at the next possible leap second occurrence.&nbsp;</li></ul><ul><li><strong>POSITIVE</strong>: A positive (inserted) leap second is scheduled at the next possible leap second occurrence.&nbsp;</li></ul><ul><li><strong>NEGATIVE</strong>: A negative (removed) leap second is scheduled at the next possible leap second occurrence.&nbsp;</li></ul><ul><li><strong>UNKNOWN</strong>: Leapsecond state was unknown when querying the time server (for Builtin SNTP) or the NTP daemon (for Local NTP Commands). </li></ul><p>For more information on StatusReportingLocalComputerTimeSource and setting up leap second handling, see <a href="Time_Sources_in_SignServer.html" data-linked-resource-id="371000354" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="371000354" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000354/Time+Sources+in+SignServer" data-scroll-link-target-source-id="371000354">Time Sources in SignServer</a>.</p><h3 id="LoggingandMonitoring-Examples" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Examples</h3><p>Each time any of the states change, the new Time, Report, and Leap states are logged at INFO level:</p><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>14:56:01,983  INFO TimeMonitorRunnable:60 - Started
14:56:02,491 ERROR TimeMonitorRunnable:214 - Command failed (1): 31 Oct 14:56:02
 ntpdate[26321]: no server suitable for synchronization found
14:56:02,511 ERROR TimeMonitorRunnable:268 - Failed to update status property: Connection
&nbsp;refused
14:56:02,515  INFO TimeMonitorRunnable:91 - State changed to: UNKNOWN,FAILED_TO_REPORT,NONE
14:58:11,152  INFO TimeMonitorRunnable:91 - State changed to: UNKNOWN,REPORTED,NONE
15:01:23,310  INFO TimeMonitorRunnable:91 - State changed to: INSYNC,REPORTED,NONE</pre>
</div></div><p>&nbsp;When the state changes from INSYNC or SOON_OUT_OF_SYNC to either OUT_OF_SYNC or UNKNOWN, an additional log entry outputs the last time determined to be in sync:</p><div class="preformatted panel" style="border-width: 1px;"><div class="preformattedContent panelContent">
<pre>15:32:05,990 INFO&nbsp; [TimeMonitorRunnable] State changed to: INSYNC,REPORTED,NONE
15:32:06,492 INFO&nbsp; [TimeMonitorRunnable] State changed to: OUT_OF_SYNC,REPORTED,NONE
15:32:06,492 INFO&nbsp; [TimeMonitorRunnable] Last trusted time was: 2012-11-27 15:32:05,990</pre>
</div></div><h2 id="LoggingandMonitoring-Monitoring" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">Monitoring</h2><p>The current state of the TimeMonitor application can also be monitored from an external service if the state-showing web (health check) server is enabled.</p><p>Example of getting the current state from the state web page:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">$ curl http:</code><code class="comments">//tsaserver:8980/state</code></div>
<div class="line"><code class="plain"> </code><code class="value">1409050686281</code><code class="plain">,INSYNC,REPORTED,NONE,1ccdf46b,</code><code class="value">0</code><code class="plain">,</code><code class="value">508</code><code class="plain">,</code><code class="value">8</code><code class="plain">,</code><code class="value">6</code><code class="plain"> </code></div>
</div>
</div><p>It is also possible to use the <a href="TimeMonitorStatusReportWorker.html" data-linked-resource-id="371000090" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="371000090" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000090/TimeMonitorStatusReportWorker" data-scroll-link-target-source-id="371000090">TimeMonitorStatusReportWorker</a> to monitor the TimeMonitor application. In this case, the external system sends a request to the worker.</p><p>Example of getting the current state from the TimeMonitorStatusReportWorker:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">$ curl http:</code><code class="comments">//tsaserver:8080/signserver/process -d workerName=TimeMonitorStatusReport -d data=</code></div>
<div class="line"><code class="plain"> </code><code class="value">1409050686281</code><code class="plain">,INSYNC,REPORTED,NONE,1ccdf46b,</code><code class="value">0</code><code class="plain">,</code><code class="value">508</code><code class="plain">,</code><code class="value">8</code><code class="plain">,</code><code class="value">6</code><code class="plain"> </code></div>
</div>
</div><p>The current state is returned as a comma-separated list of values:</p><ol><li>Update time: The current time when the expiration time to set was calculated</li><li>Time state: See states in the <a href="Logging_and_Monitoring.html#LoggingandMonitoring-Logging" data-scroll-target-source-id="371000481" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000481/Logging+and+Monitoring#src-371000481_LoggingandMonitoring-Logging" data-scroll-link-target-source-id="371000481">Logging</a> section.<span class="confluence-anchor-link" id="LoggingandMonitoring-__DdeLink__1320_1230965538"></span><span class="confluence-anchor-link" id="__DdeLink__1320_1230965538"></span></li><li>Report state: See states in the&nbsp;<a href="Logging_and_Monitoring.html#LoggingandMonitoring-Logging" data-scroll-target-source-id="371000481" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000481/Logging+and+Monitoring#src-371000481_LoggingandMonitoring-Logging" data-scroll-link-target-source-id="371000481">Logging</a> section.</li><li>Leap state: See states in the <a href="Logging_and_Monitoring.html#LoggingandMonitoring-Logging" data-scroll-target-source-id="371000481" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000481/Logging+and+Monitoring#src-371000481_LoggingandMonitoring-Logging" data-scroll-link-target-source-id="371000481">Logging</a> section.</li><li>Config version: Identifier for the last configuration received.</li><li>Time offset: The measured difference in time with the time server.</li><li>Time server query time: The time it took to query the time server.</li><li>NTP daemon query time: The time it took to query the leap state.</li><li>Report time: The time it took to report the status to SignServer.</li></ol><h2 id="LoggingandMonitoring-Rate-limiting" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">Rate-limiting</h2><p>If an NTP server responds with a rate-limiting "kiss of death" response, the time monitor will log an error and stop querying and the state will be set to UNKNOWN. The time monitor will resume querying on the next configuration update (i.e. setting another NTP server host).</p>
<nav id="ht-post-nav">
        <a href="TimeMonitor_Configuration.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>TimeMonitor Configuration</span>
        </a>

        <a href="Set_up_a_Test_Time_Server_with_a_Simulated_Time.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Set up a Test Time Server with a Simulated Time</span>
        </a>
</nav>
                    </div>
                </section>
            </article>
        </div>

        <div class="vp-article__aside-right flex-shrink-0 w-1/6 article__toc hidden xl:block no-print">
            <div class="vp-scrollable-container vp-scrollable-container--hidden-scrollbars">
                <div class="js-tocBot">
                                    </div>
            </div>
        </div>

    </div>
</div>
        </main>


        <div id="vp-js-mobile__navigation">
            <div tabindex="-1" class="vp-mobile-navigation__trigger fixed outline-none z-mobile-menu-trigger">
                <button type="button" class="vp-button vp-button--variant-floating-action vp-mobile-navigation__button flex items-center justify-center" aria-label="navigation.open.label">
                    <div class="vp-mobile-navigation__button__icon relative">
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                    </div>
                </button>
            </div>
        </div>

        <script src="js/app.js"></script>
    </body>
</html>