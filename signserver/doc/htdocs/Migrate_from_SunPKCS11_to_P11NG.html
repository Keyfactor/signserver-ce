<!doctype html>

<html class="no-js" lang="en" data-vp-page-id="370999425">


    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="_scroll_external/attachments/e415105eb31a/ssdocs">

    <!-- Primary Meta Tags -->
    <meta name="exp-export-timestamp" content="2025-02-07T06:59:53.329+0000">
    <meta name="exp-page-id" content="370999425">
    <meta name="exp-page-title" content="Migrate from SunPKCS11 to P11NG">
    <meta name="exp-page-version" content="3">
    <meta name="exp-page-scroll-page-id" content="111aa4608329587dc7eb4d5021421060">
    <meta name="exp-page-created" content="2023-04-25T11:51:48.000+0000">
    <meta name="exp-page-last-modified" content="2024-05-28T16:44:58.431+0000">
    <meta name="exp-page-labels" content="">
    <meta name="exp-page-context-keys" content="">
    <meta name="exp-space-key" content="SSDOCS">
    <meta name="exp-space-title" content="SignServer Documentation">

    <!-- Additional Meta Tags -->
    <meta name="exp-document-id" content="371111034">
    <meta name="exp-document-title" content="SignServer Documentation">
    <meta name="exp-version-status" content="in-progress">
    <meta name="exp-version-id" content="8a3e757d15e64586aa644eaf0980f27a">
    <meta name="exp-version-name" content="Working version">
    <meta name="exp-version-description" content="">
    <meta name="exp-version-date" content="2024-02-17T13:18:25Z">
    <meta name="exp-variant-id" content="">
    <meta name="exp-variant-name" content="">
    <meta name="exp-variant-description" content="">
    <meta name="exp-language-code" content="">
    <meta name="exp-language-name" content="">

    <link rel="stylesheet" href="css/app.css">



<script id="search-worker" type="javascript/worker">
    onmessage = function(event) {
        // dispatch events to handling functions
        var message = event.data;

        if ((message.type === 'setup') && message.baseUrl) {
            setup(message.baseUrl);
        }

        if (message.type === 'search-request') {
            search(message.query);
        }
    }

    var searchIndex;

    function setup(baseUrl) {
        importScripts(
            baseUrl + 'js/lunr.js',
            baseUrl + 'js/lunr-index.js',
            baseUrl + 'js/lunr-data.js'
        );
        try {
            // load lunr-extras if it exists, which contains language-specific files for languages other than english
            importScripts(baseUrl + 'js/lunr-extras.js');
        } catch (e) {}
        searchIndex = lunr.Index.load(lunrIndex);
    }

    function search(query) {
        var searchHits = searchIndex.search(query);
        var results = searchHits.map(function (result) {
            return lunrData.filter(function (d) {
                return d.id === result.ref;
            })[0]
        });
        postMessage({ type: 'search-results', results: results, query: query });
    }
</script>
    <title>Migrate from SunPKCS11 to P11NG</title>

<meta name="generator" content="Scroll HTML Exporter / K15t GmbH"></head>
    <!-- pageid attribute is deprecated - please use data-vp-page-id on html element instead -->
    <body id="MigratefromSunPKCS11toP11NG-top" pageid="370999425" class="flex flex-col" data-confluence-editor-version="v1">
        <div id="vp-js-desktop__navigation__skip-to-navigation-link"></div>




<header class="home-icon-container flex justify-between header hc-header-background-color hc-header-background-color ">
    <div class="header__navigation--logo">
        <a href="SignServer_Documentation.html">
            <img src="_scroll_external/attachments/e415105eb31a/ssdocs" alt="SignServer Documentation" title="SignServer Documentation">
        </a>
    </div>
        <div class="top-bar-right no-print header__navigation--large__menu hc-header-background-color">
    

    <div data-vp-id="search-bar-placeholder" data-vp-component="search-bar" class="vp-search-bar" aria-hidden="true">
        <form action="/search.html" method="GET" class="vp-search-bar__input-container">
            <div data-vp-component="search-input" data-vp-variant="border" class="vp-search-input vp-search-input--border">
                <input type="search" id="search-texbox" autocomplete="off" class="vp-search-input__input" style="margin-right: 0;">
                <div class="vp-search-input__icon" aria-hidden="true">
                    <span class="vp-icon material-icons mdi-magnify w-6 h-6 text-icon-md"></span>
                </div>
            </div>
        </form>
        <div id="search-suggestion-container" class="vp-search-suggestion-panel" data-vp-component="search-suggestion"></div>
        <template id="search-suggestion-option-template">
            <div class="vp-search-suggestion-option-container vp-search-form__suggestion">
                <a class="vp-search-suggestion-option vp-search-form__suggestion" href=""></a>
            </div>
        </template>
    </div>

        </div>
</header>

        <main>



<div class="vp-article vp-container vp-container--with-content-padding article vp-container--full full vp-article--wide">
    <div class="flex">

        <div id="exp-navigation-wrapper" class="hidden lg:block">
            <iframe src="toc.html?pageId=370999425" class="border-0"></iframe>
        </div>


        <div class="vp-article__content-panel flex-auto grid-container full js-loading" id="article-content">
            <article role="article">
                <header>
<nav aria-label="Breadcrumb" role="navigation">
    <div class="breadcrumbs-wrapper">
        <ol class="breadcrumbs breadcrumbs--fit-content js-loading js-loading__stacked js-loading__stacked--breadcrumb">
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Documentation.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Documentation</a>
                </li>
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Installation.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Installation</a>
                </li>
                <li class="js-hide-until-loaded">
                    <a href="Upgrade_SignServer.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">Upgrade SignServer</a>
                </li>
            <li class="breadcrumbs--active js-hide-until-loaded">
                <a href="Migrate_from_SunPKCS11_to_P11NG.html" target="_self" aria-current="page">Migrate from SunPKCS11 to P11NG</a>
            </li>
        </ol>
        <div class="breadcrumbs-wrapper__scroll-mask"></div>
    </div>
</nav>
                    <!-- CSS class article__heading is deprecated and will be removed in the future -->
                    <h1 class="cell vp-article__heading article__heading js-loading js-loading__stacked js-loading__stacked--heading scroll-h1 scroll-original-h1 scroll-relative-h1 scroll-custom-section-heading scroll-document-section-heading" role="heading" data-scroll-heading-rank="1" data-scroll-original-heading-rank="1" data-scroll-relative-heading-rank="1" id="no-src_generated-id-0945319b4dcf1a8e6df39f1af64a9494b8d5ee601980c2d9eb5cdb79cd92378e"><span class="js-hide-until-loaded">Migrate from SunPKCS11 to P11NG</span></h1>
                </header>
                <section class="page" id="content" role="main">
                    <div id="vp-js-desktop__navigation__skip-to-navigation-target"></div>
                    <div id="main-content" class="wiki-content article__content js-tocBot-content js-hide-until-loaded">
                        <p><style>[data-colorid=r3xd4le0tu]{color:#0e101a} html[data-color-mode=dark] [data-colorid=r3xd4le0tu]{color:#e5e7f1}[data-colorid=bkhqsxbhe9]{color:#0e101a} html[data-color-mode=dark] [data-colorid=bkhqsxbhe9]{color:#e5e7f1}[data-colorid=iedjm0g8as]{color:#0e101a} html[data-color-mode=dark] [data-colorid=iedjm0g8as]{color:#e5e7f1}[data-colorid=jn1w3k2k6z]{color:#0e101a} html[data-color-mode=dark] [data-colorid=jn1w3k2k6z]{color:#e5e7f1}[data-colorid=fj72pn0as7]{color:#0e101a} html[data-color-mode=dark] [data-colorid=fj72pn0as7]{color:#e5e7f1}[data-colorid=lny5xu47k3]{color:#0e101a} html[data-color-mode=dark] [data-colorid=lny5xu47k3]{color:#e5e7f1}[data-colorid=q14ux0yl47]{color:#0e101a} html[data-color-mode=dark] [data-colorid=q14ux0yl47]{color:#e5e7f1}[data-colorid=hvqqggivsn]{color:#0e101a} html[data-color-mode=dark] [data-colorid=hvqqggivsn]{color:#e5e7f1}[data-colorid=heuj6hxdea]{color:#0e101a} html[data-color-mode=dark] [data-colorid=heuj6hxdea]{color:#e5e7f1}[data-colorid=ip1ezarzxf]{color:#0e101a} html[data-color-mode=dark] [data-colorid=ip1ezarzxf]{color:#e5e7f1}[data-colorid=gqda6gehvy]{color:#0e101a} html[data-color-mode=dark] [data-colorid=gqda6gehvy]{color:#e5e7f1}[data-colorid=t71dfwoyco]{color:#0e101a} html[data-color-mode=dark] [data-colorid=t71dfwoyco]{color:#e5e7f1}</style><span class="status-macro aui-lozenge aui-lozenge-complete">enterprise</span></p><p><span style="color: rgb(0,0,0);">This covers the steps needed to migrate from the PKCS#11 implementation Java SunPKCS11 provider to the newer P11NG provider and includes reconfiguring existing crypto tokens using PKCS#11 to instead use the new P11NG provider. The P11NG crypto token was first introduced in SignServer 4.3 to provide certain functionality not supported by the Java SunPKCS11 provider. As the P11NG provider has evolved over time, it now includes key wrapping functionaliteis, support for EdDSA algorithms, and various Cloud HSM options. As of SignServer 5.11, P11NG is the recommended crypto token for new deployments of all use cases.</span></p><h2 id="MigratefromSunPKCS11toP11NG-Background" data-scroll-heading-rank="2" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="2" class="scroll-original-h3 scroll-custom-section-heading scroll-document-section-heading scroll-h2 scroll-relative-h2">Background</h2><p><span style="color: rgb(0,0,0);">The PKCS#11 standard has been around since 1995 and is a platform-independent API to access and use cryptographic functions in hardware security modules (HSMs), smart cards, and the like. PKCS#11 is standardized in the&nbsp;<a shape="rect" href="https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=pkcs11" class="external-link scroll-external-link" rel="nofollow" data-scroll-link-type="default" data-scroll-link-target="https://www.oasis-open.org/committees/tc_home.php?wg_abbrev=pkcs11" data-scroll-link-local="false">Oasis standardization organization</a>.</span></p><p><span style="color: rgb(0,0,0);">SignServer has traditionally used PKCS#11 through the <a href="PKCS11CryptoToken.html" data-linked-resource-id="371000127" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="371000127" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000127/PKCS11CryptoToken" data-scroll-link-target-source-id="371000127">PKCS11CryptoToken</a> that utilizes the Java provider SunPKCS11. In addition, we have implemented our own P11NG provider with additional features and improved performance, which allows us to further control and improve future HSM interactions. The new P11NG provider is used through the SignServer <a href="P11NGCryptoToken.html" data-linked-resource-id="371000135" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="371000135" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000135/P11NGCryptoToken" data-scroll-link-target-source-id="371000135">P11NGCryptoToken</a>.</span></p><p><span style="color: rgb(0,0,0);">Both implementations should not be used simultaneously in a SignServer instance. There are a number of reasons for this, including:</span></p><ul class="list-disc px-8"><li><p><span style="color: rgb(0,0,0);">Both implementations would load and potentially initialize the PKCS#11 driver.</span></p></li><li><p><span style="color: rgb(0,0,0);">Both implementations could be opening and holding PKCS#11 sessions which could lead to sessions running out for one or both of the implementations.</span></p></li><li><p><span style="color: rgb(0,0,0);">SignServer is tested with either of the implementations, not both at the same time.</span></p></li></ul><p><span style="color: rgb(0,0,0);">Not using the different PKCS#11 implementations simultaneously means that the crypto tokens in SignServer using PKCS#11 must use the same PKCS#11 provider implementation. The same type of PKCS#11 provider implementation should also be set in databaseprotection.properties if audit log signing is enabled.</span></p><h2 id="MigratefromSunPKCS11toP11NG-MigratetoP11NGProvider" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Migrate to P11NG Provider</span></h2><p><span style="color: rgb(0,0,0);">To migrate from the legacy Java provider SunPKCS11 to the P11NG provider, you need to reconfigure all crypto tokens that previously used the PKCS11CryptoToken to instead use the corresponding P11NG*CryptoToken, and then restart the instance in order to not load the old implementation.</span></p><p><span style="color: rgb(0,0,0);">It is recommended to perform the migration by exporting and setting up a new crypto token, thus leaving the old crypto token disabled. For database log signing, a new "keyid" is set up and verified to be working before switching the old "keyid" to use the P11NG implementation.</span></p><h3 id="MigratefromSunPKCS11toP11NG-SetupCryptoWorkersusingP11NGforeachPKCS11CryptoWorker" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Set up Crypto Workers using P11NG for each PKCS11 Crypto Worker</span></h3><p><span style="color: rgb(0,0,0);">To set up new crypto workers using P11NG for each existing crypto worker that is using the legacy Java provider SunPKCS11, perform the following steps.</span></p><h4 id="MigratefromSunPKCS11toP11NG-Step1-Exportcryptoworkerconfiguration" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Step 1&nbsp; - Export crypto worker configuration</span></h4><p><span style="color: rgb(0,0,0);">To export the crypto worker configuration, do the following:</span></p><ol><li><span style="color: rgb(0,0,0);">Go to the SignServer Administration Web <strong>Workers</strong> page.</span></li><li><span style="color: rgb(0,0,0);">Note down the worker ID of the P11 crypto worker.</span></li><li><span style="color: rgb(0,0,0);">To export the crypto worker configuration</span><span style="color: rgb(0,0,0);">, select the crypto worker and click&nbsp;<strong>Export</strong>.</span></li><li><span style="color: rgb(0,0,0);">Click&nbsp;<strong>Download</strong>&nbsp;and save the file locally on your workstation.</span></li></ol><h4 id="MigratefromSunPKCS11toP11NG-Step2-Updatecryptoworkerconfiguration" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Step 2&nbsp; - Update crypto worker configuration</span></h4><p><span style="color: rgb(0,0,0);">To edit the crypto worker configuration, do the following:</span></p><ol><li><span data-colorid="jn1w3k2k6z">Copy the downloaded crypto worker configuration file to a new file, such as dump-&lt;timestamp&gt;.properties â†’ dump-&lt;timestamp&gt;-p11ng.properties.</span></li><li><span data-colorid="fj72pn0as7">Open the newly created P11NG copy file in a text editor and edit the configuration according to the following:</span><ul><li><span data-colorid="q14ux0yl47">To update the worker ID:</span><ul><li><span data-colorid="lny5xu47k3">Change the <code>WORKER&lt;ID&gt;.</code> (of the crypto worker as noted in Step 1) to the generic <code>WORKERGENID1.</code> at the beginning of every (non-comment) line.</span></li><li><span data-colorid="heuj6hxdea"> Alternatively, use a static unused ID instead of <code>GENID1.</code></span></li></ul></li><li><span data-colorid="t71dfwoyco">To update the crypto token implementation class, update the line:</span><span data-colorid="ip1ezarzxf"><br clear="none"></span><ul><li><span data-colorid="bkhqsxbhe9"><code>WORKERGENID1.CRYPTOTOKEN_IMPLEMENTATION_CLASS=org.signserver.server.cryptotokens.PKCS11CryptoToken</code><br clear="none">to<br clear="none"></span></li><li><code><span data-colorid="gqda6gehvy">WORKERGEN1.CRYPTOTOKEN_IMPLEMENTATION_CLASS=org.signserver.p11ng.common.cryptotoken.P11NGCryptoToken</span></code></li></ul></li><li><span data-colorid="iedjm0g8as">To specify a name for the new P11NG crypto token, edit the line starting with <code>WORKERGEN1.NAME=</code> to use a new name such as <code>CryptoTokenP11NG.</code></span></li><li><span data-colorid="r3xd4le0tu">If the old PKCS11 crypto worker was configured using the ATTRIBUTES property (to specify PKCS11 attributes according to the SunP11), these attribute settings need to be converted to separate ATTRIBUTE.x.y.z-style properties. For more information, see <a href="P11NGCryptoToken.html" data-linked-resource-id="371000135" data-linked-resource-version="2" data-linked-resource-type="page" data-scroll-target-source-id="371000135" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/371000135/P11NGCryptoToken" data-scroll-link-target-source-id="371000135">P11NGCryptoToken</a></span>.</li></ul></li><li><span data-colorid="hvqqggivsn">Save the file.</span></li></ol><h4 id="MigratefromSunPKCS11toP11NG-Step3-ImportP11NGcryptoworkerconfiguration" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Step 3&nbsp; - Import P11NG crypto worker configuration</span></h4><p><span style="color: rgb(0,0,0);">To import the new P11NG crypto worker configuration, do the following:</span></p><ol><li><span style="color: rgb(0,0,0);">On the SignServer Administration Web <strong>Workers</strong> page, click <strong>Add.</strong><br clear="none"></span></li><li><span style="color: rgb(0,0,0);">Click <strong>From file</strong> and then click <strong>Browse</strong> and select the updated worker configuration file from the file system.</span></li><li><span style="color: rgb(0,0,0);">Click <strong>Apply</strong>.</span></li><li><span style="color: rgb(0,0,0);">Select the new</span><span style="color: rgb(0,0,0);"> crypto worker from the Workers list, and if not auto-activated (no PIN is set), activate the token using the PIN.</span></li><li><span style="color: rgb(0,0,0);">Click the <strong>Crypto Token</strong> tab and verify that the existing keys are shown, thus the same keys as for the old crypto worker.</span></li></ol><h4 id="MigratefromSunPKCS11toP11NG-Step4-UpdateworkersusingtheP11cryptotoken" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Step 4&nbsp; - </span><span style="color: rgb(0,0,0);">Update workers using the P11 crypto token</span></h4><p><span style="color: rgb(0,0,0);">Next, to update the workers using the P11 crypto token, do the following:</span></p><ol><li><span style="color: rgb(0,0,0);">For each worker using the old PKCS11CryptoToken type of crypto token, change the CRYPTOTOKEN worker property to point to the new crypto worker.</span></li><li><span style="color: rgb(0,0,0);">Ensure that the worker status is shown as ACTIVE after changing the CRYPTOTOKEN property.</span></li></ol><h4 id="MigratefromSunPKCS11toP11NG-Step5-Disableoldcryptoworker" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Step 5&nbsp; - Disable old crypto worker</span></h4><p><span style="color: rgb(0,0,0);">To disable the old crypto worker, do the following:</span></p><ol><li><span style="color: rgb(0,0,0);">Select the old crypto worker and click <strong>Disable.</strong></span></li><li><span style="color: rgb(0,0,0);">On the disable worker page, click <strong>Disable.</strong></span></li><li><span style="color: rgb(0,0,0);">The old crypto worker should now be displayed in the workers list as "Disabled".</span></li></ol><p><span style="color: rgb(0,0,0);">The migration is now completed and the old crypto token is left disabled.</span></p><h2 id="MigratefromSunPKCS11toP11NG-ReconfigureAuditLogSigning" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Reconfigure Audit Log Signing</span></h2><p><span style="color: rgb(0,0,0);">If you are using signed audit log using PKCS11, perform the following steps to reconfigure Audit Log signing:</span></p><ol><li><span style="color: rgb(0,0,0);">Update databaseprotection.properties to use P11NG:</span></li><li><span style="color: rgb(0,0,0);">Edit $SIGNSERVER_HOME/conf/databaseprotection.properties</span></li><li><p><span style="color: rgb(0,0,0);">Copy the section containing the configuration for the PKCS11 crypto token, for example:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain"> # Definition of a third Crypto Token using a PKCS#</code><code class="value">11</code><code class="plain"> HSM, suitable </code><code class="keyword">for</code><code class="plain"> digital signature</code></div>
<div class="line"><code class="plain"> # Do not forget to generate keys on the HSM though, keys usable by Java PKCS#</code><code class="value">11</code><code class="plain">.</code></div>
<div class="line"><code class="plain"> # The PKCS11CryptoToken in CESeCore is very good at that.</code></div>
<div class="line"><code class="plain"> databaseprotection.keyid.</code><code class="value">1</code><code class="plain"> = </code><code class="value">401</code></div>
<div class="line"><code class="plain"> databaseprotection.keylabel.</code><code class="value">1</code><code class="plain"> = dbProtKey</code></div>
<div class="line"><code class="plain"> databaseprotection.classname.</code><code class="value">1</code><code class="plain"> = org.cesecore.keys.token.PKCS11CryptoToken</code></div>
<div class="line"><code class="plain"> databaseprotection.properties.</code><code class="value">1</code><code class="plain"> = sharedLibrary=/usr/lib/softhsm/libsofthsm2.so, slotLabelType=SLOT_INDEX, slotLabelValue=</code><code class="value">0</code></div>
<div class="line"><code class="plain"> databaseprotection.data.</code><code class="value">1</code><code class="plain"> = </code></div>
<div class="line"><code class="plain"> databaseprotection.tokenpin.</code><code class="value">1</code><code class="plain"> = foo123</code></div>
<div class="line"><code class="plain"> databaseprotection.version.</code><code class="value">1</code><code class="plain"> = </code><code class="value">2</code><code class="plain"> </code></div>
</div>
</div></li><li><p><span style="color: rgb(0,0,0);">Change the index of the properties, for example from 1 to 2, edit the keyid and token classname, and also change the slot properties to all caps. This would result in a crypto token configuration for P11NG that looks like the following:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">databaseprotection.keyid.</code><code class="value">2</code><code class="plain"> = </code><code class="value">402</code></div>
<div class="line"><code class="plain">databaseprotection.keylabel.</code><code class="value">2</code><code class="plain"> = dbProtKey</code></div>
<div class="line"><code class="plain">databaseprotection.classname.</code><code class="value">2</code><code class="plain"> = org.signserver.p11ng.common.cryptotoken.P11NGDatabaseProtectionCryptoToken</code></div>
<div class="line"><code class="plain">databaseprotection.properties.</code><code class="value">2</code><code class="plain"> = sharedLibrary=/usr/lib/softhsm/libsofthsm2.so, SLOTLABELTYPE=SLOT_INDEX, SLOTLABELVALUE=</code><code class="value">0</code></div>
<div class="line"><code class="plain">databaseprotection.data.</code><code class="value">2</code><code class="plain"> = </code></div>
<div class="line"><code class="plain">databaseprotection.tokenpin.</code><code class="value">2</code><code class="plain"> = foo123</code></div>
<div class="line"><code class="plain">databaseprotection.version.</code><code class="value">2</code><code class="plain"> = </code><code class="value">2</code></div>
</div>
</div></li><li><p><span style="color: rgb(0,0,0);">To change the keyid used to sign new and updated rows, update the row according to the following example:</span><br clear="none"><span style="color: rgb(0,0,0);">From:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">databaseprotection.keyid = </code><code class="value">401</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">&nbsp;To:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">databaseprotection.keyid = </code><code class="value">402</code></div>
</div>
</div></li><li><p><span style="color: rgb(0,0,0);">Next, redeploy:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">$ ./bin/ant deploy</code></div>
</div>
</div></li><li><p><span style="color: rgb(0,0,0);">Finally, verify that the startup event is logged and that there are no audit log failures (thus ensure that both the new and the old signing tokens are still working).</span></p></li><li><p><span style="color: rgb(0,0,0);">Once verified, either:</span></p><ul><li><p><span style="color: rgb(0,0,0);">Edit the old token to also use the P11NGDatabaseProtectionCryptoToken and the redeploy.</span></p></li><li><p><span style="color: rgb(0,0,0);">Or, instead of re-using the same signing key, generate a new key for the new rows after the migration.</span></p></li></ul></li></ol><p><span style="color: rgb(0,0,0);">The database log signing is now set up to use the P11NG implementation.</span></p>
<nav id="ht-post-nav">
        <a href="Upgrade_SignServer.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Upgrade SignServer</span>
        </a>

        <a href="Upgrade_Notes.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Upgrade Notes</span>
        </a>
</nav>
                    </div>
                </section>
            </article>
        </div>

        <div class="vp-article__aside-right flex-shrink-0 w-1/6 article__toc hidden xl:block no-print">
            <div class="vp-scrollable-container vp-scrollable-container--hidden-scrollbars">
                <div class="js-tocBot">
                                    </div>
            </div>
        </div>

    </div>
</div>
        </main>


        <div id="vp-js-mobile__navigation">
            <div tabindex="-1" class="vp-mobile-navigation__trigger fixed outline-none z-mobile-menu-trigger">
                <button type="button" class="vp-button vp-button--variant-floating-action vp-mobile-navigation__button flex items-center justify-center" aria-label="navigation.open.label">
                    <div class="vp-mobile-navigation__button__icon relative">
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                    </div>
                </button>
            </div>
        </div>

        <script src="js/app.js"></script>
    </body>
</html>