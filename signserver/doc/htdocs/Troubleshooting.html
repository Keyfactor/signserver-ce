<!doctype html>

<html class="no-js" lang="en" data-vp-page-id="370999556">


    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="_scroll_external/attachments/e415105eb31a/ssdocs">

    <!-- Primary Meta Tags -->
    <meta name="exp-export-timestamp" content="2024-11-07T13:04:49.425+0000">
    <meta name="exp-page-id" content="370999556">
    <meta name="exp-page-title" content="Troubleshooting">
    <meta name="exp-page-version" content="1">
    <meta name="exp-page-scroll-page-id" content="cf8d26868670236552d62da81877b439">
    <meta name="exp-page-created" content="2023-08-30T12:46:12.000+0000">
    <meta name="exp-page-last-modified" content="2023-09-12T11:55:46.000+0000">
    <meta name="exp-page-labels" content="">
    <meta name="exp-page-context-keys" content="">
    <meta name="exp-space-key" content="SSDOCS">
    <meta name="exp-space-title" content="SignServer Documentation">

    <!-- Additional Meta Tags -->
    <meta name="exp-document-id" content="371111034">
    <meta name="exp-document-title" content="SignServer Documentation">
    <meta name="exp-version-status" content="in-progress">
    <meta name="exp-version-id" content="8a3e757d15e64586aa644eaf0980f27a">
    <meta name="exp-version-name" content="Working version">
    <meta name="exp-version-description" content="">
    <meta name="exp-version-date" content="2024-02-17T13:18:25Z">
    <meta name="exp-variant-id" content="">
    <meta name="exp-variant-name" content="">
    <meta name="exp-variant-description" content="">
    <meta name="exp-language-code" content="">
    <meta name="exp-language-name" content="">

    <link rel="stylesheet" href="css/app.css">



<script id="search-worker" type="javascript/worker">
    onmessage = function(event) {
        // dispatch events to handling functions
        var message = event.data;

        if ((message.type === 'setup') && message.baseUrl) {
            setup(message.baseUrl);
        }

        if (message.type === 'search-request') {
            search(message.query);
        }
    }

    var searchIndex;

    function setup(baseUrl) {
        importScripts(
            baseUrl + 'js/lunr.js',
            baseUrl + 'js/lunr-index.js',
            baseUrl + 'js/lunr-data.js'
        );
        try {
            // load lunr-extras if it exists, which contains language-specific files for languages other than english
            importScripts(baseUrl + 'js/lunr-extras.js');
        } catch (e) {}
        searchIndex = lunr.Index.load(lunrIndex);
    }

    function search(query) {
        var searchHits = searchIndex.search(query);
        var results = searchHits.map(function (result) {
            return lunrData.filter(function (d) {
                return d.id === result.ref;
            })[0]
        });
        postMessage({ type: 'search-results', results: results, query: query });
    }
</script>
    <title>Troubleshooting</title>

<meta name="generator" content="Scroll HTML Exporter / K15t GmbH"></head>
    <!-- pageid attribute is deprecated - please use data-vp-page-id on html element instead -->
    <body id="Troubleshooting-top" pageid="370999556" class="flex flex-col" data-confluence-editor-version="v1">
        <div id="vp-js-desktop__navigation__skip-to-navigation-link"></div>




<header class="home-icon-container flex justify-between header hc-header-background-color hc-header-background-color ">
    <div class="header__navigation--logo">
        <a href="SignServer_Documentation.html">
            <img src="_scroll_external/attachments/e415105eb31a/ssdocs" alt="SignServer Documentation" title="SignServer Documentation">
        </a>
    </div>
        <div class="top-bar-right no-print header__navigation--large__menu hc-header-background-color">
    

    <div data-vp-id="search-bar-placeholder" data-vp-component="search-bar" class="vp-search-bar" aria-hidden="true">
        <form action="/search.html" method="GET" class="vp-search-bar__input-container">
            <div data-vp-component="search-input" data-vp-variant="border" class="vp-search-input vp-search-input--border">
                <input type="search" id="search-texbox" autocomplete="off" class="vp-search-input__input" style="margin-right: 0;">
                <div class="vp-search-input__icon" aria-hidden="true">
                    <span class="vp-icon material-icons mdi-magnify w-6 h-6 text-icon-md"></span>
                </div>
            </div>
        </form>
        <div id="search-suggestion-container" class="vp-search-suggestion-panel" data-vp-component="search-suggestion"></div>
        <template id="search-suggestion-option-template">
            <div class="vp-search-suggestion-option-container vp-search-form__suggestion">
                <a class="vp-search-suggestion-option vp-search-form__suggestion" href=""></a>
            </div>
        </template>
    </div>

        </div>
</header>

        <main>



<div class="vp-article vp-container vp-container--with-content-padding article vp-container--full full vp-article--wide">
    <div class="flex">

        <div id="exp-navigation-wrapper" class="hidden lg:block">
            <iframe src="toc.html?pageId=370999556" class="border-0"></iframe>
        </div>


        <div class="vp-article__content-panel flex-auto grid-container full js-loading" id="article-content">
            <article role="article">
                <header>
<nav aria-label="Breadcrumb" role="navigation">
    <div class="breadcrumbs-wrapper">
        <ol class="breadcrumbs breadcrumbs--fit-content js-loading js-loading__stacked js-loading__stacked--breadcrumb">
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Documentation.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Documentation</a>
                </li>
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Operations.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Operations</a>
                </li>
            <li class="breadcrumbs--active js-hide-until-loaded">
                <a href="Troubleshooting.html" target="_self" aria-current="page">Troubleshooting</a>
            </li>
        </ol>
        <div class="breadcrumbs-wrapper__scroll-mask"></div>
    </div>
</nav>
                    <!-- CSS class article__heading is deprecated and will be removed in the future -->
                    <h1 class="cell vp-article__heading article__heading js-loading js-loading__stacked js-loading__stacked--heading scroll-h1 scroll-original-h1 scroll-relative-h1 scroll-custom-section-heading scroll-document-section-heading" role="heading" data-scroll-heading-rank="1" data-scroll-original-heading-rank="1" data-scroll-relative-heading-rank="1" id="no-src_generated-id-edcc8b0357756f4f09d8fa43f62d520c52bc31e1580095e25fca2aaeb3039b12"><span class="js-hide-until-loaded">Troubleshooting</span></h1>
                </header>
                <section class="page" id="content" role="main">
                    <div id="vp-js-desktop__navigation__skip-to-navigation-target"></div>
                    <div id="main-content" class="wiki-content article__content js-tocBot-content js-hide-until-loaded">
                        <p><span style="color: rgb(0,0,0);text-decoration: none;">The following provides troubleshooting tips to help you get back on track and includes solutions or workarounds for </span><span style="color: rgb(0,0,0);text-decoration: none;">common errors.<br clear="none"></span></p><p></p><h2 id="Troubleshooting-DebugLogging" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">Debug Logging</h2><p>To troubleshoot unexpected behavior in SignServer, enable more detailed (debug) logging by running the following command in the JBoss CLI:</p><ol><li><p class="auto-cursor-target">Start JBoss CLI:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">APPSRV_HOME/bin/jboss-cli.sh -c</code></div>
</div>
</div></li><li><p class="auto-cursor-target">Run the following commands to enable DEBUG logging:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/subsystem=logging/logger=org.ejbca:write-attribute(name=level, value=DEBUG)</code></div>
<div class="line"><code class="plain">/subsystem=logging/logger=org.cesecore:write-attribute(name=level, value=DEBUG)</code></div>
<div class="line"><code class="plain">/subsystem=logging/logger=org.signserver:write-attribute(name=level, value=DEBUG)</code></div>
</div>
</div></li></ol><h2 id="Troubleshooting-GeneralIssues" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">General Issues</h2><h3 id="Troubleshooting-Transactionrolledbackerror" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Transaction rolled back error</h3><p>A transaction timeout can occur for requests that are taking longer time to finish than what is configured for database transactions in the application server.</p><p>Example of errors displayed in the log:</p><div class="scroll-code scroll-highlighted-code-block" data-language="text" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">13:21:17,483 ERROR [org.jboss.as.ejb3.invocation] (http-/0.0.0.0:8443-1) JBAS014134: EJB Invocation failed on component ProcessSessionBean for method public abstract org.signserver.common.data.Response org.signserver.ejb.interfaces.ProcessSessionLocal.process(org.signserver.server.log.AdminInfo,org.signserver.common.WorkerIdentifier,org.signserver.common.data.Request,org.signserver.common.RequestContext) throws org.signserver.common.IllegalRequestException,org.signserver.common.CryptoTokenOfflineException,org.signserver.common.SignServerException: javax.ejb.EJBTransactionRolledbackException: Transaction rolled back</code></div>
<div class="line"><code class="plain">...</code></div>
<div class="line"><code class="plain">Caused by: javax.transaction.RollbackException: JBAS014585: Transaction 'TransactionImple &lt; ac, BasicAction: 0:ffff7f000001:672b819:5911a12e:f8 status: ActionStatus.ABORTED &gt;' was already rolled back</code></div>
<div class="line"><code class="plain">    at org.jboss.as.ejb3.tx.CMTTxInterceptor.endTransaction(CMTTxInterceptor.java:99) [jboss-as-ejb3-7.5.0.Final-redhat-21.jar:7.5.0.Final-redhat-21]</code></div>
<div class="line"><code class="plain">    ... 100 more</code></div>
</div>
</div><p>Possible reasons include large file uploads and/or downloads, and/or slow network connections, slow HSM connection or HSM, or that contacting external servers takes a long time (CRL/OCSP fetching or time-stamping etc).</p><h4 id="Troubleshooting-Solutions" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading">Solutions</h4><ul><li>Since database transactions are not required if the worker is not configured to access the database, disabling the <span class="confluence-link">key usage counter</span>, and not using any <span class="confluence-link">archiver</span>s will resolve this issue. For more information, see <a href="Limiting_the_number_of_signatures.html" data-linked-resource-id="370999751" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999751" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999751/Limiting+the+number+of+signatures" data-scroll-link-target-source-id="370999751">Limiting the number of signatures</a> and <a href="Archiving.html" data-linked-resource-id="370999739" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999739" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999739/Archiving" data-scroll-link-target-source-id="370999739">Archiving</a>.</li><li>Alternatively, if the <span class="confluence-link">key usage counter</span> or an <span class="confluence-link">Archiver</span> must be used, reconfigure the application server with a higher value for the transaction timeout. For more information, see <a href="Limiting_the_number_of_signatures.html" data-linked-resource-id="370999751" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999751" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999751/Limiting+the+number+of+signatures" data-scroll-link-target-source-id="370999751">Limiting the number of signatures</a> and <a href="Archiving.html" data-linked-resource-id="370999739" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999739" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999739/Archiving" data-scroll-link-target-source-id="370999739">Archiving</a>.</li></ul><h3 id="Troubleshooting-CKR_PIN_INCORRECT(LunaHSM)" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">CKR_PIN_INCORRECT (Luna HSM)</h3><p>When attempting to log into a Luna HSM, the HSM may require a PIN code from an external PIN pad. If you subsequently try to log in via an application, you might encounter a misleading exception.</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">ERROR [org.signserver.server.cryptotokens.PKCS11CryptoToken] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">2</code><code class="plain">) Activate failed: Failed to initialize PKCS11 provider slot </code><code class="string">'CAAUTHDEV'</code><code class="plain">.: load failed: CKR_PIN_INCORRECT</code></div>
</div>
</div><p>A workaround we've seen could be to set<strong> ProtectedAuthenticationPathFlagStatus = 1</strong> in the config file of the HSM</p><h3 class="editable-field inactive scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading" title="Click to edit" id="Troubleshooting-SQLFeatureNotSupportedExceptionwithPostgreSQL" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3">SQLFeatureNotSupportedException with PostgreSQL</h3><p>When running SignServer with certain versions of PostgreSQL, an SQLFeatureNotSupportedException can occur on any database insert. By disabling the L2 and query cache you can forgo this issue. See <a href="Deploy-time_Configuration.html" data-linked-resource-id="370999711" data-linked-resource-version="1" data-linked-resource-type="page" data-scroll-target-source-id="370999711" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999711/Deploy-time+Configuration" data-scroll-link-target-source-id="370999711">Deploy-time Configuration</a>.</p><h2 id="Troubleshooting-P11NG/JackNJI11" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">P11NG / JackNJI11</h2><h3 id="Troubleshooting-UnsatisfiedLinkError" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">UnsatisfiedLinkError</h3><p>There can be a conflict between the JNA implementation in SignServer and the one installed in the system. This can be seen as errors similar to the following:</p><ul style="list-style-type: square;"><li>java.lang.UnsatisfiedLinkError: com.sun.jna.Native.malloc(J)J</li><li>java.lang.UnsatisfiedLinkError: Can't obtain static newInstance method for class com.sun.jna.Structure</li></ul><p>The solution is to remove JNA from the system (i.e. apt-get remove libjna-java) or to run Java with:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">-Djava.library.path=</code></div>
</div>
</div><h3 id="Troubleshooting-USER_NOT_LOGGED_INError" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">USER_NOT_LOGGED_IN Error</h3><p>If a <strong>USER_NOT_LOGGED_IN</strong> error is encountered while using the Utimaco HSM, the solution is to enable the <strong>KeepAlive</strong> setting in the Utimaco configuration<span style="color: rgb(0,0,0);"> file <code>cs_pkcs11_R2.cfg</code>:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain"># Prevents expiring session after inactivity of </code><code class="value">15</code><code class="plain"> minutes</code></div>
<div class="line"><code class="plain">KeepAlive = </code><code class="keyword">true</code></div>
</div>
</div><h2 id="Troubleshooting-SunPKCS11/PKCS11CryptoTokenandJava17" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">SunPKCS11 / PKCS11CryptoToken and Java 17</h2><p>The PKCS11CryptoToken does not work on Java 17 unless the Java process that runs the application server is passed the JAVA_OPTS parameter &nbsp;"--add-exports=jdk.crypto.cryptoki/sun.security.pkcs11.wrapper=ALL-UNNAMED".</p><p>When using the PKCS11CryptoToken an error similar to the following may be logged:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="value">19</code><code class="plain">:</code><code class="value">54</code><code class="plain">:</code><code class="value">50</code><code class="plain">,</code><code class="value">047</code><code class="plain"> ERROR [com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapper] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">1</code><code class="plain">) Method sun.security.pkcs11.wrapper.PKCS11.CK_C_INITIALIZE_ARGS.getInstance was not accessible, </code><code class="keyword">this</code><code class="plain"> may be due to a change in the underlying library.: java.lang.IllegalAccessException: </code><code class="keyword">class</code><code class="plain"> com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapper cannot access </code><code class="keyword">class</code><code class="plain"> sun.security.pkcs11.wrapper.PKCS11 (in module jdk.crypto.cryptoki) because module jdk.crypto.cryptoki does not export sun.security.pkcs11.wrapper to unnamed module </code><code class="color1">@64dbc7bd</code></div>
</div>
</div><h2 id="Troubleshooting-SunPKCS11/PKCS11CryptoTokenandcertainJava17versions" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">SunPKCS11 / PKCS11CryptoToken and certain Java 17 versions</h2><p>Certain Java 17 versions/builds attempt to call C_GetInfo before the call C_Initialize, resulting in many HSM drivers responding with CKR_CRYPTOKI_NOT_INITIALIZED.The issue has been observed with OpenJDK 17 version Red_Hat-17.0.6.0.10-1.fc36 and switching to a different Java version/build is the only known solution.</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain"> </code><code class="value">12</code><code class="plain">:</code><code class="value">30</code><code class="plain">:</code><code class="value">33</code><code class="plain">,</code><code class="value">581</code><code class="plain"> ERROR [stderr] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">1</code><code class="plain">) sunpkcs11: Initializing PKCS#</code><code class="value">11</code><code class="plain"> library /opt/ETcpsdk/lib/linux-x86_64/libctsw.so</code></div>
<div class="line"><code class="value">12</code><code class="plain">:</code><code class="value">30</code><code class="plain">:</code><code class="value">33</code><code class="plain">,</code><code class="value">582</code><code class="plain"> ERROR [stderr] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">1</code><code class="plain">) sunpkcs11: Multi-threaded initialization failed: sun.security.pkcs11.wrapper.PKCS11Exception: CKR_CRYPTOKI_NOT_INITIALIZED</code></div>
<div class="line"><code class="value">12</code><code class="plain">:</code><code class="value">30</code><code class="plain">:</code><code class="value">33</code><code class="plain">,</code><code class="value">582</code><code class="plain"> ERROR [com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapper] (</code><code class="keyword">default</code><code class="plain"> task-</code><code class="value">1</code><code class="plain">) Wrong arguments were passed to sun.security.pkcs11.wrapper.PKCS11.CK_C_INITIALIZE_ARGS.getInstance threw an exception </code><code class="keyword">for</code><code class="plain"> log.error(msg, e): java.lang.reflect.InvocationTargetException</code></div>
<div class="line"><code class="plain">    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</code></div>
<div class="line"><code class="plain">    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:</code><code class="value">77</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:</code><code class="value">43</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at java.base/java.lang.reflect.Method.invoke(Method.java:</code><code class="value">568</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapper.&lt;init&gt;(SunP11SlotListWrapper.java:144)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapperFactory.getInstance(SunP11SlotListWrapperFactory.java:74)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.SunP11SlotListWrapperFactory.getInstance(SunP11SlotListWrapperFactory.java:35)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.Pkcs11SlotLabel.getSlotListWrapper(Pkcs11SlotLabel.java:566)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.Pkcs11SlotLabel.getProvider(Pkcs11SlotLabel.java:120)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.Pkcs11SlotLabel.getP11Provider(Pkcs11SlotLabel.java:551)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.Pkcs11SlotLabel.getP11Provider(Pkcs11SlotLabel.java:516)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.P11Slot.&lt;init&gt;(P11Slot.java:57)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.P11Slot.getInstance(P11Slot.java:246)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.P11Slot.getInstance(P11Slot.java:203)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.pkcs11.P11Slot.getInstance(P11Slot.java:181)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.cesecore.keys.token.PKCS11CryptoToken.delayedInit(PKCS11CryptoToken.java:130)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.cesecore.keys.token.PKCS11CryptoToken.getP11slotWithDelayedInit(PKCS11CryptoToken.java:296)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.cesecore.keys.token.PKCS11CryptoToken.activate(PKCS11CryptoToken.java:153)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.BaseCryptoToken.autoActivate(BaseCryptoToken.java:115)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.BaseCryptoToken.getKeyStore(BaseCryptoToken.java:97)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//com.keyfactor.util.keys.token.BaseCryptoToken.getTokenStatus(BaseCryptoToken.java:655)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.signserver.server.cryptotokens.PKCS11CryptoToken.getCryptoTokenStatus(PKCS11CryptoToken.java:308)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.signserver.server.signers.BaseSigner.isCryptoTokenActive(BaseSigner.java:376)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.signserver.server.signers.BaseSigner.getStatus(BaseSigner.java:103)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear</code><code class="comments">//org.signserver.server.signers.CryptoWorker.getStatus(CryptoWorker.java:37)</code></div>
<div class="line"><code class="plain">    at deployment.signserver.ear.SignServer-ejb.jar</code><code class="comments">//org.signserver.ejb.WorkerSessionBean.getStatus(WorkerSessionBean.java:287)</code></div>
<div class="line"><code class="plain">&lt;...&gt;</code></div>
<div class="line"><code class="plain">    at org.jboss.xnio</code><code class="color1">@3</code><code class="plain">.8.</code><code class="value">7</code><code class="plain">.Final</code><code class="comments">//org.xnio.XnioWorker$WorkerThreadFactory$1$1.run(XnioWorker.java:1282)</code></div>
<div class="line"><code class="plain">    at java.base/java.lang.Thread.run(Thread.java:</code><code class="value">833</code><code class="plain">)</code></div>
<div class="line"><code class="plain">Caused by: sun.security.pkcs11.wrapper.PKCS11Exception: CKR_CRYPTOKI_NOT_INITIALIZED</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11.C_GetInfo(Native Method)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11$SynchronizedPKCS11.C_GetInfo(PKCS11.java:</code><code class="value">1681</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11.&lt;init&gt;(PKCS11.java:</code><code class="value">156</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11$SynchronizedPKCS11.&lt;init&gt;(PKCS11.java:</code><code class="value">1668</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11.getInstance(PKCS11.java:</code><code class="value">194</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    at jdk.crypto.cryptoki/sun.security.pkcs11.wrapper.PKCS11.getInstance(PKCS11.java:</code><code class="value">166</code><code class="plain">)</code></div>
<div class="line"><code class="plain">    ... </code><code class="value">248</code><code class="plain"> more</code></div>
<div class="line"><code class="plain">  </code></div>
</div>
</div><h2 id="Troubleshooting-SignClient" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">SignClient</h2><h3 id="Troubleshooting-CannotProduceCertificateVerifySignature" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Cannot Produce CertificateVerify Signature</h3><p>When using SignClient using a PKCS 11 token (e.g. a smart-card reader) for authenticating in some cases (e.g. both server and client running on Java 11) a cipher-suit-related error can occur:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">ERROR [HTTPDocumentSigner] Failed sending request: Cannot produce CertificateVerify signature</code></div>
</div>
</div><p>As a workaround, SignClient can be forced to fall back to using TLS version 1.2 (as shown in the commented-out sample in script bin/signclient, a similar example is also present in the Windows batch file bin/signclient.cmd)</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain"># In some cases, running SignClient authenticating with a P11 token</code></div>
<div class="line"><code class="plain"># (e.g. a smartcard reader) could give cipher-suit errors,</code></div>
<div class="line"><code class="plain"># In these cases, a workaround is to force the use of TLS version </code><code class="value">1.2</code></div>
<div class="line"><code class="plain">JAVA_OPTS=</code><code class="string">"$JAVA_OPTS  -Djdk.tls.client.protocols=TLSv1.2 -Dhttps.protocols=TLSv1.2"</code></div>
</div>
</div>
<nav id="ht-post-nav">
        <a href="Setting_up_Request_Prioritization.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Setting up Request Prioritization</span>
        </a>

        <a href="SignServer_Integration.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>SignServer Integration</span>
        </a>
</nav>
                    </div>
                </section>
            </article>
        </div>

        <div class="vp-article__aside-right flex-shrink-0 w-1/6 article__toc hidden xl:block no-print">
            <div class="vp-scrollable-container vp-scrollable-container--hidden-scrollbars">
                <div class="js-tocBot">
                                    </div>
            </div>
        </div>

    </div>
</div>
        </main>


        <div id="vp-js-mobile__navigation">
            <div tabindex="-1" class="vp-mobile-navigation__trigger fixed outline-none z-mobile-menu-trigger">
                <button type="button" class="vp-button vp-button--variant-floating-action vp-mobile-navigation__button flex items-center justify-center" aria-label="navigation.open.label">
                    <div class="vp-mobile-navigation__button__icon relative">
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                    </div>
                </button>
            </div>
        </div>

        <script src="js/app.js"></script>
    </body>
</html>