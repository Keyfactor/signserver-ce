<!doctype html>

<html class="no-js" lang="en" data-vp-page-id="370999400">


    
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="shortcut icon" href="_scroll_external/attachments/e415105eb31a/ssdocs">

    <!-- Primary Meta Tags -->
    <meta name="exp-export-timestamp" content="2025-05-15T08:53:56.345+0000">
    <meta name="exp-page-id" content="370999400">
    <meta name="exp-page-title" content="WildFly 32+ and JBoss EAP 8">
    <meta name="exp-page-version" content="20">
    <meta name="exp-page-scroll-page-id" content="04809b6d0896c674ba8eca69a6cf37c3">
    <meta name="exp-page-created" content="2024-01-22T13:22:00.000+0000">
    <meta name="exp-page-last-modified" content="2025-03-06T14:52:19.023+0000">
    <meta name="exp-page-labels" content="installation,review,signserver-software-only,wildfly">
    <meta name="exp-page-context-keys" content="">
    <meta name="exp-space-key" content="SSDOCS">
    <meta name="exp-space-title" content="SignServer Documentation">

    <!-- Additional Meta Tags -->
    <meta name="exp-document-id" content="371111034">
    <meta name="exp-document-title" content="SignServer Documentation">
    <meta name="exp-version-status" content="in-progress">
    <meta name="exp-version-id" content="8a3e757d15e64586aa644eaf0980f27a">
    <meta name="exp-version-name" content="Working version">
    <meta name="exp-version-description" content="">
    <meta name="exp-version-date" content="2024-02-17T13:18:25Z">
    <meta name="exp-variant-id" content="">
    <meta name="exp-variant-name" content="">
    <meta name="exp-variant-description" content="">
    <meta name="exp-language-code" content="">
    <meta name="exp-language-name" content="">

    <link rel="stylesheet" href="css/app.css">



<script id="search-worker" type="javascript/worker">
    onmessage = function(event) {
        // dispatch events to handling functions
        var message = event.data;

        if ((message.type === 'setup') && message.baseUrl) {
            setup(message.baseUrl);
        }

        if (message.type === 'search-request') {
            search(message.query);
        }
    }

    var searchIndex;

    function setup(baseUrl) {
        importScripts(
            baseUrl + 'js/lunr.js',
            baseUrl + 'js/lunr-index.js',
            baseUrl + 'js/lunr-data.js'
        );
        try {
            // load lunr-extras if it exists, which contains language-specific files for languages other than english
            importScripts(baseUrl + 'js/lunr-extras.js');
        } catch (e) {}
        searchIndex = lunr.Index.load(lunrIndex);
    }

    function search(query) {
        var searchHits = searchIndex.search(query);
        var results = searchHits.map(function (result) {
            return lunrData.filter(function (d) {
                return d.id === result.ref;
            })[0]
        });
        postMessage({ type: 'search-results', results: results, query: query });
    }
</script>
    <title>WildFly 32+ and JBoss EAP 8</title>

<meta name="generator" content="Scroll HTML Exporter / K15t GmbH"></head>
    <!-- pageid attribute is deprecated - please use data-vp-page-id on html element instead -->
    <body id="WildFly32+andJBossEAP8-top" pageid="370999400" class="flex flex-col" data-confluence-editor-version="v2">
        <div id="vp-js-desktop__navigation__skip-to-navigation-link"></div>




<header class="home-icon-container flex justify-between header hc-header-background-color hc-header-background-color ">
    <div class="header__navigation--logo">
        <a href="SignServer_Documentation.html">
            <img src="_scroll_external/attachments/e415105eb31a/ssdocs" alt="SignServer Documentation" title="SignServer Documentation">
        </a>
    </div>
        <div class="top-bar-right no-print header__navigation--large__menu hc-header-background-color">
    

    <div data-vp-id="search-bar-placeholder" data-vp-component="search-bar" class="vp-search-bar" aria-hidden="true">
        <form action="/search.html" method="GET" class="vp-search-bar__input-container">
            <div data-vp-component="search-input" data-vp-variant="border" class="vp-search-input vp-search-input--border">
                <input type="search" id="search-texbox" autocomplete="off" class="vp-search-input__input" style="margin-right: 0;">
                <div class="vp-search-input__icon" aria-hidden="true">
                    <span class="vp-icon material-icons mdi-magnify w-6 h-6 text-icon-md"></span>
                </div>
            </div>
        </form>
        <div id="search-suggestion-container" class="vp-search-suggestion-panel" data-vp-component="search-suggestion"></div>
        <template id="search-suggestion-option-template">
            <div class="vp-search-suggestion-option-container vp-search-form__suggestion">
                <a class="vp-search-suggestion-option vp-search-form__suggestion" href=""></a>
            </div>
        </template>
    </div>

        </div>
</header>

        <main>



<div class="vp-article vp-container vp-container--with-content-padding article vp-container--full full vp-article--wide">
    <div class="flex">

        <div id="exp-navigation-wrapper" class="hidden lg:block">
            <iframe src="toc.html?pageId=370999400" class="border-0"></iframe>
        </div>


        <div class="vp-article__content-panel flex-auto grid-container full js-loading" id="article-content">
            <article role="article">
                <header>
<nav aria-label="Breadcrumb" role="navigation">
    <div class="breadcrumbs-wrapper">
        <ol class="breadcrumbs breadcrumbs--fit-content js-loading js-loading__stacked js-loading__stacked--breadcrumb">
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Documentation.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Documentation</a>
                </li>
                <li class="js-hide-until-loaded">
                    <a href="SignServer_Installation.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">SignServer Installation</a>
                </li>
                <li class="js-hide-until-loaded">
                    <a href="Application_Server_Setup.html" rel="prev" target="_self" class="js-breadcrumbs-truncate">Application Server Setup</a>
                </li>
            <li class="breadcrumbs--active js-hide-until-loaded">
                <a href="WildFly_32+_and_JBoss_EAP_8.html" target="_self" aria-current="page">WildFly 32+ and JBoss EAP 8</a>
            </li>
        </ol>
        <div class="breadcrumbs-wrapper__scroll-mask"></div>
    </div>
</nav>
                    <!-- CSS class article__heading is deprecated and will be removed in the future -->
                    <h1 class="cell vp-article__heading article__heading js-loading js-loading__stacked js-loading__stacked--heading scroll-h1 scroll-original-h1 scroll-relative-h1 scroll-custom-section-heading scroll-document-section-heading" role="heading" data-scroll-heading-rank="1" data-scroll-original-heading-rank="1" data-scroll-relative-heading-rank="1" id="no-src_generated-id-6b752d5f1b6b2f36b527fb4c42d955bbfb09ea6d2ffd8037e179407701fe6a21"><span class="js-hide-until-loaded">WildFly 32+ and JBoss EAP 8</span></h1>
                </header>
                <section class="page" id="content" role="main">
                    <div id="vp-js-desktop__navigation__skip-to-navigation-target"></div>
                    <div id="main-content" class="wiki-content article__content js-tocBot-content js-hide-until-loaded">
                        <p>The following sections provide information on configuring your application server.</p><p>&nbsp;</p><div class="confluence-information-macro confluence-information-macro-information"><span class="aui-icon aui-icon-small aui-iconfont-info confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>The application server specific information for <span class="inline-comment-marker" data-ref="3e18117a-d2a1-4672-8db9-199896855d01">WildFly 32+ is also applicable for JBoss EAP 8</span>.</p></div></div><h2 id="WildFly32+andJBossEAP8-DownloadWildFly" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">Download WildFly<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-WildFly"></span></h2><p>WildFly can either be downloaded as a zip package or customized using Galleon. We recommend you to use Galleon, since it only downloads the components you need, as opposed to using the zip package, which bundles all configurations and JBoss modules (SignServer is only using a subset of all functionality in WildFly).</p><p>WildFly is usually put in the <code>/opt</code> folder on Linux systems, and using a symlink to the WildFly folder makes it easy to switch to a new version of WildFly by simply overriding the symlink.</p><h3 id="WildFly32+andJBossEAP8-UsingtheZipPackage" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Using the Zip Package<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Using-the-Zip-Package"></span></h3><p>You need to use the <em>Jakarta EE Full &amp; Web Distribution</em> package of WildFly when downloading the zip package. If you have not downloaded WildFly already, you can use the following command to do so:</p><h4 id="WildFly32+andJBossEAP8-DownloadandunpacktheWildFlyzippackage" data-scroll-heading-rank="4" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="4" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h4 scroll-relative-h4"><strong>Download and unpack the WildFly zip package</strong><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-and-unpack-the-WildFly-zip-package"></span></h4><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">wget https:</code><code class="plain">//download</code><code class="plain">.jboss.org</code><code class="plain">/wildfly/35</code><code class="plain">.0.1.Final</code><code class="plain">/wildfly-35</code><code class="plain">.0.1.Final.zip -O </code><code class="plain">/tmp/wildfly-35</code><code class="plain">.0.1.Final.zip</code></div>
<div class="line"><code class="plain">unzip -q </code><code class="plain">/tmp/wildfly-35</code><code class="plain">.0.1.Final.zip -d </code><code class="plain">/opt/</code></div>
<div class="line"><code class="functions">ln</code><code class="plain"> -snf </code><code class="plain">/opt/wildfly-35</code><code class="plain">.0.1.Final </code><code class="plain">/opt/wildfly</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-UsingGalleon" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Using Galleon<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Using-Galleon"></span></h3><p>Instead of downloading the WildFly zip package containing everything (all default server configurations and all JBoss modules), using Galleon tooling you can choose to only install the components needed by SignServer.</p><h4 id="WildFly32+andJBossEAP8-DownloadGalleon" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading">Download Galleon<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-Galleon"></span></h4><p>Galleon is provided as a zip package from GitHub which you can download and run without any installation.</p><h5 id="WildFly32+andJBossEAP8-DownloadGalleon.1" data-scroll-heading-rank="5" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="5" class="scroll-h5 scroll-original-h5 scroll-relative-h5 scroll-custom-section-heading scroll-document-section-heading"><strong>Download Galleon</strong><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-Galleon.1"></span></h5><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">wget https:</code><code class="plain">//github</code><code class="plain">.com</code><code class="plain">/wildfly/galleon/releases/download/4</code><code class="plain">.2.8.Final</code><code class="plain">/galleon-4</code><code class="plain">.2.8.Final.zip -O </code><code class="plain">/tmp/galleon-4</code><code class="plain">.2.8.Final.zip</code></div>
<div class="line"><code class="plain">unzip -q </code><code class="plain">/tmp/galleon-4</code><code class="plain">.2.8.Final.zip -d </code><code class="plain">/tmp/</code></div>
<div class="line"><code class="functions">cd</code><code class="plain"> </code><code class="plain">/tmp/galleon-4</code><code class="plain">.2.8.Final</code><code class="plain">/bin</code></div>
</div>
</div><h4 id="WildFly32+andJBossEAP8-LayersUsedBySignServer" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading">Layers Used By SignServer<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Layers-Used-By-SignServer"></span></h4><p>The table below lists the Galleon layers used by SignServer. </p><p>The<code> core-tools</code> layer will include the JBoss and Elytron CLI which comes in handy if the Elytron credential store or the&nbsp;<code>standalone.xml</code> configuration file need to be tweaked later. If you don't need this, exclude the&nbsp;<code>core-tools</code> and <code>management</code> layers and add&nbsp;<code>elytron</code>&nbsp;separately. <code>bean-validation</code> can be excluded as well, but is good to have, at least in staging environments. Picketbox-based web security is required for SignServer to detect authentication using client certificates.</p><div class="table-wrap"><table data-table-width="1800" data-layout="default" data-local-id="70290498-6fc1-4502-b0c6-bd41e11937e2" class="confluenceTable"><colgroup span="1"><col span="1" style="width: 255.0px;"><col span="1" style="width: 945.0px;"><col span="1" style="width: 600.0px;"></colgroup><thead><tr><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Name</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Description</strong></p></th><th colspan="1" rowspan="1" class="confluenceTh"><p><strong>Dependencies</strong></p></th></tr></thead><tbody><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>cdi</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for Jakarta Contexts and Dependency Injection.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>base-server<br clear="none">bean-validation (optional)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>core-tools</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for <em>jboss-cli</em>, <em>add-user</em> and <em>elytron-tool</em> launch scripts and configuration files.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>management&nbsp;(optional)</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>datasources</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for datasources.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>transactions</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>deployment-scanner</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for deployment directory scanning.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>base-server</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>discovery</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for discovery.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>base-server</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>ee</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for common functionality in the Jakarta EE platform.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>jsonb&nbsp;(optional)<br clear="none">naming</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>ejb</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for Jakarta Enterprise Beans, excluding the IIOP protocol.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>ejb-lite<br clear="none">messaging-activemq<br clear="none">remoting<br clear="none">resource-adapters<br clear="none">undertow</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>io</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for XNIO workers and buffer pools.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>base-server</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>jaxrs</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for JAXRS.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>web-server</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>jpa</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for JPA (using the latest WildFly supported Hibernate release).<br clear="none"><em>Alternative:</em>&nbsp;jpa-distributed</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>bean-validation&nbsp;(optional)<br clear="none">datasources</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>jsf</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for Jakarta Server Faces.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>bean-validation&nbsp;(optional)<br clear="none">cdi&nbsp;(optional)<br clear="none">web-server</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>logging</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for the logging subsystem.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>base-server</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>mail</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for Jakarta Mail.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>base-server<br clear="none">naming</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>management</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for remote access to management interfaces secured using Elytron.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>elytron</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>webservices</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for Jakarta XML Web Services</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>ejb-lite&nbsp;(optional)<br clear="none">messaging-activemq&nbsp;(optional)<br clear="none">web-server</p></td></tr><tr><td colspan="1" rowspan="1" class="confluenceTd"><p>legacy-security</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>Support for legacy Picketbox-based web security.</p></td><td colspan="1" rowspan="1" class="confluenceTd"><p>naming<br clear="none">vault</p></td></tr></tbody></table></div><h4 id="WildFly32+andJBossEAP8-DownloadandConfigureWildFlyUsingGalleon" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Download and Configure WildFly Using Galleon</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-and-Configure-WildFly-Using-Galleon"></span></h4><p><span style="color: rgb(0,0,0);">Galleon can download and extract WildFly to the directory specified using the </span><code>install</code><span style="color: rgb(0,0,0);"> command. SignServer is running on a standalone server, and only this server configuration is needed. For a typical installation, use the following CLI recipe:</span></p><h5 id="WildFly32+andJBossEAP8-DownloadandbuildWildFlyusingGalleon" data-scroll-heading-rank="5" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="5" class="scroll-h5 scroll-original-h5 scroll-relative-h5 scroll-custom-section-heading scroll-document-section-heading">Download and build WildFly using Galleon<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-and-build-WildFly-using-Galleon"></span></h5><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">.</code><code class="plain">/galleon</code><code class="plain">.sh </code><code class="functions">install</code><code class="plain"> wildfly:current</code><code class="comments">#35.0.1.Final --dir=/opt/wildfly-35.0.1.Final --default-configs=standalone/standalone.xml --layers=cdi,core-tools,datasources,deployment-scanner,discovery,ee,-jsonb,ejb,io,jaxrs,jpa,jsf,logging,mail,management,webservices</code></div>
<div class="line"><code class="functions">ln</code><code class="plain"> -snf </code><code class="plain">/opt/wildfly-35</code><code class="plain">.0.1.Final </code><code class="plain">/opt/wildfly</code><code class="plain">  </code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-RemoveRESTEasy-Crypto" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Remove RESTEasy-Crypto</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Remove-RESTEasy-Crypto"></span></h2><p><span style="color: rgb(0,0,0);">The application server can sometimes load its own version of Bouncy Castle, resulting in incompatibility and/or conflict issues.</span></p><p><span style="color: rgb(0,0,0);">A typical error occurring as a consequence of the wrong Bouncy Castle being loaded in SignServer is:</span></p><blockquote><p><span style="color: rgb(0,0,0);">ClassCastException setting BagAttributes, can not set friendly name: : java.lang.ClassCastException: org.bouncycastle.jcajce.provider.asymmetric.x509.X509CertificateObject cannot be cast to org.bouncycastle.jce.interfaces.PKCS12BagAttributeCarrier</span></p></blockquote><p><span style="color: rgb(0,0,0);">To avoid issues and prevent WildFly from loading the Bouncy Castle library included in the RESTEasy-Crypto module, rather than the library included in SignServer, run the following:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">sed -i </code><code class="string">'/.*org.jboss.resteasy.resteasy-crypto.*/d'</code><code class="plain"> /opt/wildfly/modules/system/layers/base/org/jboss/as/jaxrs/main/module.xml</code></div>
<div class="line"><code class="plain">rm -rf /opt/wildfly/modules/system/layers/base/org/jboss/resteasy/resteasy-crypto/</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-CreateaCustomConfiguration" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Create a Custom Configuration</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Create-a-Custom-Configuration"></span></h2><p><span style="color: rgb(0,0,0);">Replace </span><code>/opt/wildfly/bin/standalone.conf</code><span style="color: rgb(0,0,0);"> with the following Jinja2 template.</span></p><h3 id="WildFly32+andJBossEAP8-/opt/wildfly/bin/standalone.conf" data-scroll-heading-rank="3" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="3" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3"><strong>/opt/wildfly/bin/standalone.conf</strong><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-/opt/wildfly/bin/standalone.conf"></span></h3><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="keyword">if</code><code class="plain"> [ </code><code class="string">"x$JBOSS_MODULES_SYSTEM_PKGS"</code><code class="plain"> = </code><code class="string">"x"</code><code class="plain"> ]; </code><code class="keyword">then</code></div>
<div class="line"><code class="plain">     JBOSS_MODULES_SYSTEM_PKGS=</code><code class="string">"org.jboss.byteman"</code></div>
<div class="line"><code class="keyword">fi</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="keyword">if</code><code class="plain"> [ </code><code class="string">"x$JAVA_OPTS"</code><code class="plain"> = </code><code class="string">"x"</code><code class="plain"> ]; </code><code class="keyword">then</code></div>
<div class="line"><code class="plain">     JAVA_OPTS=</code><code class="string">"-Xms{{ HEAP_SIZE }}m -Xmx{{ HEAP_SIZE }}m -XX:MetaspaceSize=96M -XX:MaxMetaspaceSize=256m"</code></div>
<div class="line"><code class="plain">     JAVA_OPTS=</code><code class="string">"$JAVA_OPTS -Dhttps.protocols=TLSv1.2,TLSv1.3"</code></div>
<div class="line"><code class="plain">     JAVA_OPTS=</code><code class="string">"$JAVA_OPTS -Djdk.tls.client.protocols=TLSv1.2,TLSv1.3"</code></div>
<div class="line"><code class="plain">     JAVA_OPTS=</code><code class="string">"$JAVA_OPTS -Djava.net.preferIPv4Stack=true"</code></div>
<div class="line"><code class="plain">     JAVA_OPTS=</code><code class="string">"$JAVA_OPTS -Djboss.modules.system.pkgs=$JBOSS_MODULES_SYSTEM_PKGS"</code></div>
<div class="line"><code class="plain">     JAVA_OPTS=</code><code class="string">"$JAVA_OPTS -Djava.awt.headless=true"</code></div>
<div class="line"><code class="plain">     JAVA_OPTS=</code><code class="string">"$JAVA_OPTS -Djboss.tx.node.id={{ TX_NODE_ID }}"</code></div>
<div class="line"><code class="plain">     JAVA_OPTS=</code><code class="string">"$JAVA_OPTS -XX:+HeapDumpOnOutOfMemoryError"</code></div>
<div class="line"><code class="plain">     JAVA_OPTS=</code><code class="string">"$JAVA_OPTS -Djdk.tls.ephemeralDHKeySize=2048"</code></div>
<div class="line"><code class="keyword">else</code></div>
<div class="line"><code class="plain">     </code><code class="functions">echo</code><code class="plain"> </code><code class="string">"JAVA_OPTS already set in environment; overriding default settings with values: $JAVA_OPTS"</code></div>
<div class="line"><code class="keyword">fi</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-SetAllowedMemoryUsage" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Set Allowed Memory Usage</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Set-Allowed-Memory-Usage"></span></h3><p><span style="color: rgb(0,0,0);">By default, 512 MB of heap (RAM) is allowed to be used by the application server. This is not sufficient to run SignServer. We recommend to allocate at least 2048 MB of RAM. To increase the default value, run the following command:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="functions">sed</code><code class="plain"> -i -e </code><code class="string">'s/{{ HEAP_SIZE }}/2048/g'</code><code class="plain"> </code><code class="plain">/opt/wildfly/bin/standalone</code><code class="plain">.conf</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-SettheTransactionNodeID" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Set the Transaction Node ID</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Set-the-Transaction-Node-ID"></span></h3><p><span style="color: rgb(0,0,0);">Set the transaction node ID to a unique number. The node ID is used by the </span><code>transactions</code><span style="color: rgb(0,0,0);"> subsystem and ensures that the transaction manager only recovers branches which match the specified identifier. It is imperative that this identifier is unique between WildFly instances sharing either an object store or access common resource managers (i.e. when multiple SignServer instances access the same database).</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="functions">sed</code><code class="plain"> -i -e </code><code class="string">"s/{{ TX_NODE_ID }}/$(od -A n -t d -N 1 /dev/urandom | tr -d ' ')/g"</code><code class="plain"> </code><code class="plain">/opt/wildfly/bin/standalone</code><code class="plain">.conf</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-Optional:ConfigureWildFlyasaService" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Optional: Configure WildFly as a Service </span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Optional:-Configure-WildFly-as-a-Service"></span></h2><p><span style="color: rgb(0,0,0);">Modern Linux systems use systemd to start and stop services. The WildFly zip package already contains the necessary files to run as a service, but they need to be installed manually. Once started as a service, WildFly will run as the </span><code>wildfly</code><span style="color: rgb(0,0,0);"> user, and you need to add this user as well.</span></p><p><span style="color: rgb(0,0,0);">The following provides a suggestion for setting up WildFly as a systemd service. Note that the example may need to be adapted according to the system you are using.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="functions">cp</code><code class="plain"> </code><code class="plain">/opt/wildfly/docs/contrib/scripts/systemd/launch</code><code class="plain">.sh </code><code class="plain">/opt/wildfly/bin</code></div>
<div class="line"><code class="functions">cp</code><code class="plain"> </code><code class="plain">/opt/wildfly/docs/contrib/scripts/systemd/wildfly</code><code class="plain">.service </code><code class="plain">/etc/systemd/system</code></div>
<div class="line"><code class="functions">mkdir</code><code class="plain"> </code><code class="plain">/etc/wildfly</code></div>
<div class="line"><code class="functions">cp</code><code class="plain"> </code><code class="plain">/opt/wildfly/docs/contrib/scripts/systemd/wildfly</code><code class="plain">.conf </code><code class="plain">/etc/wildfly</code></div>
<div class="line"><code class="plain">systemctl daemon-reload</code></div>
<div class="line"><code class="functions">useradd</code><code class="plain"> -r -s </code><code class="plain">/bin/false</code><code class="plain"> wildfly</code></div>
<div class="line"><code class="functions">chown</code><code class="plain"> -R wildfly:wildfly </code><code class="plain">/opt/wildfly-35</code><code class="plain">.0.1.Final/</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">The </span><code>docs</code><span style="color: rgb(0,0,0);"> directory does not exist when using Galleon. For reference, this is what the missing files look like:</span></p><h3 id="WildFly32+andJBossEAP8-/opt/wildfly/docs/contrib/scripts/systemd/launch.sh" data-scroll-heading-rank="3" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="3" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">/opt/wildfly/docs/contrib/scripts/systemd/launch.sh<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-/opt/wildfly/docs/contrib/scripts/systemd/launch.sh"></span></h3><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="comments">#!/bin/bash</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> [ </code><code class="string">"x$WILDFLY_HOME"</code><code class="plain"> = </code><code class="string">"x"</code><code class="plain"> ]; </code><code class="keyword">then</code></div>
<div class="line"><code class="plain">    WILDFLY_HOME=</code><code class="string">"/opt/wildfly"</code></div>
<div class="line"><code class="keyword">fi</code></div>
<div class="line"><code class="keyword">if</code><code class="plain"> [[ </code><code class="string">"$1"</code><code class="plain"> == </code><code class="string">"domain"</code><code class="plain"> ]]; </code><code class="keyword">then</code></div>
<div class="line"><code class="plain">    $WILDFLY_HOME</code><code class="plain">/bin/domain</code><code class="plain">.sh -c $2 -b $3</code></div>
<div class="line"><code class="keyword">else</code></div>
<div class="line"><code class="plain">    $WILDFLY_HOME</code><code class="plain">/bin/standalone</code><code class="plain">.sh -c $2 -b $3</code></div>
<div class="line"><code class="keyword">fi</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-/opt/wildfly/docs/contrib/scripts/systemd/wildfly.service" data-scroll-heading-rank="3" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="3" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">/opt/wildfly/docs/contrib/scripts/systemd/wildfly.service<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-/opt/wildfly/docs/contrib/scripts/systemd/wildfly.service"></span></h3><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">[Unit]</code></div>
<div class="line"><code class="plain">Description=The WildFly Application Server</code></div>
<div class="line"><code class="plain">After=syslog.target network.target</code></div>
<div class="line"><code class="plain">Before=httpd.service</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">[Service]</code></div>
<div class="line"><code class="plain">Environment=LAUNCH_JBOSS_IN_BACKGROUND=1</code></div>
<div class="line"><code class="plain">EnvironmentFile=-</code><code class="plain">/etc/wildfly/wildfly</code><code class="plain">.conf</code></div>
<div class="line"><code class="plain">User=wildfly</code></div>
<div class="line"><code class="plain">LimitNOFILE=102642</code></div>
<div class="line"><code class="plain">PIDFile=</code><code class="plain">/var/run/wildfly/wildfly</code><code class="plain">.pid</code></div>
<div class="line"><code class="plain">ExecStart=</code><code class="plain">/opt/wildfly/bin/launch</code><code class="plain">.sh $WILDFLY_MODE $WILDFLY_CONFIG $WILDFLY_BIND</code></div>
<div class="line"><code class="plain">StandardOutput=null</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="plain">[Install]</code></div>
<div class="line"><code class="plain">WantedBy=multi-user.target</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-/opt/wildfly/docs/contrib/scripts/systemd/wildfly.conf" data-scroll-heading-rank="3" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="3" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h3 scroll-relative-h3">/opt/wildfly/docs/contrib/scripts/systemd/wildfly.conf<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-/opt/wildfly/docs/contrib/scripts/systemd/wildfly.conf"></span></h3><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="comments"># The configuration you want to run</code></div>
<div class="line"><code class="plain">WILDFLY_CONFIG=standalone.xml</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments"># The mode you want to run</code></div>
<div class="line"><code class="plain">WILDFLY_MODE=standalone</code></div>
<div class="line">&nbsp;</div>
<div class="line"><code class="comments"># The address to bind to</code></div>
<div class="line"><code class="plain">WILDFLY_BIND=0.0.0.0</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-StartWildFly" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Start WildFly </span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Start-WildFly"></span></h2><p><span style="color: rgb(0,0,0);">The following provides two examples for starting WildFly, one if you are using a systemd service in the background and alternatively for starting WildFly in a separate terminal for testing.</span></p><h3 id="WildFly32+andJBossEAP8-StartWildFlyinstalledasasystemdservice" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Start WildFly installed as a systemd service</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Start-WildFly-installed-as-a-systemd-service"></span></h3><p><span style="color: rgb(0,0,0);">To start WildFly installed as a systemd service:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">systemctl start wildfly</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-StartWildFlyinaseparateterminalfortesting" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Start WildFly in a separate terminal for testing</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Start-WildFly-in-a-separate-terminal-for-testing"></span></h3><p><span style="color: rgb(0,0,0);">Alternatively, start WildFly in a separate terminal for quick testing:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/standalone.sh</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-CreateanElytronCredentialStore" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Create an Elytron Credential Store</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Create-an-Elytron-Credential-Store"></span></h2><p><span style="color: rgb(0,0,0);">You can protect passwords by storing them in a credential store. The credential is encrypted with a master password which is fetched by WildFly on startup.</span></p><h3 id="WildFly32+andJBossEAP8-CreateaMasterPassword" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Create a Master Password</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Create-a-Master-Password"></span></h3><p><span style="color: rgb(0,0,0);">Create a script which outputs the master password to </span><code>stdout</code><span style="color: rgb(0,0,0);"> and ensure the script can only be executed by the </span><code>wildfly</code><span style="color: rgb(0,0,0);"> user.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="functions">echo</code><code class="plain"> </code><code class="string">'#!/bin/sh'</code><code class="plain"> &gt; </code><code class="plain">/usr/bin/wildfly_pass</code></div>
<div class="line"><code class="functions">echo</code><code class="plain"> </code><code class="string">"echo '$(openssl rand -base64 24)'"</code><code class="plain"> &gt;&gt; </code><code class="plain">/usr/bin/wildfly_pass</code></div>
<div class="line"><code class="functions">chown</code><code class="plain"> wildfly:wildfly </code><code class="plain">/usr/bin/wildfly_pass</code></div>
<div class="line"><code class="functions">chmod</code><code class="plain"> 700 </code><code class="plain">/usr/bin/wildfly_pass</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-CreatetheCredentialStore" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Create the Credential Store</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Create-the-Credential-Store"></span></h3><p><span style="color: rgb(0,0,0);">Create a credential store in</span><code> /opt/wildfly/standalone/configuration</code><span style="color: rgb(0,0,0);"> encrypted with the password echoed by the</span><code> wildfly_pass</code><span style="color: rgb(0,0,0);"> script.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="functions">mkdir</code><code class="plain"> </code><code class="plain">/opt/wildfly/standalone/configuration/keystore</code></div>
<div class="line"><code class="functions">chown</code><code class="plain"> wildfly:wildfly </code><code class="plain">/opt/wildfly/standalone/configuration/keystore</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/credential-store=defaultCS:add(location=keystore/credentials, relative-to=jboss.server.config.dir, credential-reference={clear-text="{EXT}/usr/bin/wildfly_pass", type="COMMAND"}, create=true)'</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-AddDatabaseDriver" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Add Database Driver</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Add-Database-Driver"></span></h2><p><span style="color: rgb(0,0,0);">For most database management systems, the JDBC driver can be added by hot-deploying it into the deployment directory. This will be picked up by WildFly and deployed so we can create a data source straight away. You can use a generic name, without version number, in order to get a generic </span><code>driver-name</code><span style="color: rgb(0,0,0);"> for the data source command.</span></p><h3 id="WildFly32+andJBossEAP8-MariaDB" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">MariaDB</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-MariaDB"></span></h3><h4 id="WildFly32+andJBossEAP8-DownloadanddeployMariaDBJDBCdriver" data-scroll-heading-rank="4" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="4" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h4 scroll-relative-h4">Download and deploy MariaDB JDBC driver<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-and-deploy-MariaDB-JDBC-driver"></span></h4><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">wget https:</code><code class="plain">//dlm</code><code class="plain">.mariadb.com</code><code class="plain">/3852266/Connectors/java/connector-java-3</code><code class="plain">.4.1</code><code class="plain">/mariadb-java-client-3</code><code class="plain">.4.1.jar -O </code><code class="plain">/opt/wildfly/standalone/deployments/mariadb-java-client</code><code class="plain">.jar</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-PostgreSQL" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">PostgreSQL</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-PostgreSQL"></span></h3><h4 id="WildFly32+andJBossEAP8-DownloadanddeployPostgreSQLJDBCdriver" data-scroll-heading-rank="4" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="4" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h4 scroll-relative-h4">Download and deploy PostgreSQL JDBC driver<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-and-deploy-PostgreSQL-JDBC-driver"></span></h4><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">wget https:</code><code class="plain">//jdbc</code><code class="plain">.postgresql.org</code><code class="plain">/download/postgresql-42</code><code class="plain">.7.4.jar -O </code><code class="plain">/opt/wildfly/standalone/deployments/postgresql-jdbc4</code><code class="plain">.jar</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-MicrosoftSQLServer" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Microsoft SQL Server<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Microsoft-SQL-Server"></span></h3><h4 id="WildFly32+andJBossEAP8-DownloadanddeployMicrosoftSQLServerdriver" data-scroll-heading-rank="4" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="4" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h4 scroll-relative-h4">Download and deploy Microsoft SQL Server driver<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-and-deploy-Microsoft-SQL-Server-driver"></span></h4><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">wget https:</code><code class="plain">//github</code><code class="plain">.com</code><code class="plain">/microsoft/mssql-jdbc/releases/download/v12</code><code class="plain">.4.2</code><code class="plain">/mssql-jdbc-12</code><code class="plain">.4.2.jre11.jar -O </code><code class="plain">/opt/wildfly/standalone/deployments/mssql-jdbc</code><code class="plain">.jre11.jar</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-OracleDB" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Oracle DB<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Oracle-DB"></span></h3><h4 id="WildFly32+andJBossEAP8-DownloadanddeployOracleDBdriver" data-scroll-heading-rank="4" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="4" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h4 scroll-relative-h4">Download and deploy Oracle DB driver<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Download-and-deploy-Oracle-DB-driver"></span></h4><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">wget https:</code><code class="plain">//download</code><code class="plain">.oracle.com</code><code class="plain">/otn-pub/otn_software/jdbc/235/ojdbc11</code><code class="plain">.jar -O </code><code class="plain">/opt/wildfly/standalone/deployments/oracledb-jdbc11</code><code class="plain">.jar</code></div>
</div>
</div><p></p><h2 id="WildFly32+andJBossEAP8-AddaDatasource" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Add a Datasource</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Add-a-Datasource"></span></h2><p><span style="color: rgb(0,0,0);">To add a datasource for SignServer to use, run the commands in JBoss CLI according to the examples below.</span></p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><span style="color: rgb(0,0,0);">Note that </span><code>--driver-name</code><span style="color: rgb(0,0,0);"> is should be the same as the filename of the JAR file you copied in the step&nbsp;above. </span></p><p><span style="color: rgb(0,0,0);">The&nbsp;</span><code>--jndi-name</code><span style="color: rgb(0,0,0);">&nbsp;is is defined by the property </span><code>datasource.jndi-name</code><span style="color: rgb(0,0,0);"> in </span><code>database.properties</code><span style="color: rgb(0,0,0);">, and the default value is used in the following example.</span></p><p><span style="color: rgb(0,0,0);">The </span><code>--user-name</code><span style="color: rgb(0,0,0);"> and </span><code>--password</code><span style="color: rgb(0,0,0);"> defines the username and password of the SignServer database user.</span></p></div></div><h3 id="WildFly32+andJBossEAP8-MariaDB.1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">MariaDB</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-MariaDB.1"></span></h3><p><span style="color: rgb(0,0,0);">For MariaDB, run the following:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="xml" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect '/subsystem=elytron/credential-store=defaultCS:add-alias(alias=dbPassword, secret-value="signserver")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect 'data-source add --name=signserverds --connection-url="jdbc:</code><code class="comments">mysql://127.0.0.1:3306/signserver</code><code class="plain">" --jndi-name="java:/SignServerDS" --use-ccm=true --driver-name="mariadb-java-client.jar" --driver-class="org.mariadb.jdbc.Driver" --user-name="signserver" --credential-reference={store=defaultCS, alias=dbPassword} --validate-on-match=true --background-validation=false --prepared-statements-cache-size=50 --share-prepared-statements=true --min-pool-size=5 --max-pool-size=150 --pool-prefill=true --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql="select 1;"'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect ':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-PostgreSQL.1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">PostgreSQL</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-PostgreSQL.1"></span></h3><p><span style="color: rgb(0,0,0);">For PostgreSQL, run the following:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=elytron/credential-store=defaultCS:add-alias(alias=dbPassword, secret-value="signserver")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'data-source add --name=signserverds --connection-url="jdbc:postgresql://127.0.0.1/signserver" --jndi-name="java:/SignServerDS" --use-ccm=true --driver-name="postgresql-jdbc4.jar" --driver-class="org.postgresql.Driver" --user-name="signserver" --credential-reference={store=defaultCS, alias=dbPassword} --validate-on-match=true --background-validation=false --prepared-statements-cache-size=50 --share-prepared-statements=true --min-pool-size=5 --max-pool-size=150 --pool-prefill=true --transaction-isolation=TRANSACTION_READ_COMMITTED --check-valid-connection-sql="select 1;"'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-MicrosoftSQLServer.1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Microsoft SQL Server<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Microsoft-SQL-Server.1"></span></h3><p>For Microsoft SQL Server, run the following:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=elytron/credential-store=defaultCS:add-alias(alias=dbPassword, secret-value="signserver")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=datasources/data-source=signserverds:add(connection-url="jdbc:sqlserver://foobar.YOUR.DOMAIN:1433;DatabaseName=signserver;encrypt=true;trustServerCertificate=false;hostNameInCertificate=*.database.windows.net;loginTimeout=30;sendStringParametersAsUnicode=false", min-pool-size=5, max-pool-size=150, jndi-name="java:/SignServerDS", driver-name=mssql-jdbc.jre11.jar, user-name="signserver", credential-reference={store=defaultCS, alias=dbPassword}, pool-prefill=false, pool-use-strict-min=false, idle-timeout-minutes=2)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-OracleDB.1" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading">Oracle DB<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Oracle-DB.1"></span></h3><p>For Oracle DB, run the following:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=elytron/credential-store=defaultCS:add-alias(alias=dbPassword, secret-value="signserver")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=datasources/data-source=signserverds:add(connection-url="jdbc:oracle:thin:@//YOUR.DOMAIN:1521/signserver", min-pool-size=5, max-pool-size=150, jndi-name="java:/SignServerDS", driver-name=oracle-jdbc11.jar, user-name="signserver", credential-reference={store=defaultCS, alias=dbPassword}, pool-prefill=false, pool-use-strict-min=false, idle-timeout-minutes=2)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"> Wait for the reload to complete by checking the server log or the result of <code>:read-attribute(name=server-state)</code> before continuing.</p><h2 id="WildFly32+andJBossEAP8-ConfigureWildFlyRemoting" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Configure WildFly Remoting</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Configure-WildFly-Remoting"></span></h2><p><span style="color: rgb(0,0,0);">SignServer needs to use JBoss Remoting for the SignServer Admin CLI to work. Configure it to use a separate port 4447 and remove any other dependency on remoting except for what SignServer needs.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=remoting/http-connector=http-remoting-connector:write-attribute(name=connector-ref,value=remoting)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/socket-binding-group=standard-sockets/socket-binding=remoting:add(port=4447,interface=management)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/http-listener=remoting:add(socket-binding=remoting,enable-http2=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h2 id="WildFly32+andJBossEAP8-ConfigureLogging" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Configure Logging</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Configure-Logging"></span></h2><p><span style="color: rgb(0,0,0);">Configure logging in WildFly to be able to dynamically change logging while the application server is running.</span></p><h3 id="WildFly32+andJBossEAP8-LoggingConfigurations" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Logging Configurations</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Logging-Configurations"></span></h3><p><span style="color: rgb(0,0,0);">Choose one of the logging configurations below.</span></p><h4 id="WildFly32+andJBossEAP8-Option1-RecommendedLogging" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Option 1 - Recommended Logging</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Option-1---Recommended-Logging"></span></h4><p><span style="color: rgb(0,0,0);">INFO log level for </span><code>org.signserver</code><span style="color: rgb(0,0,0);"> and </span><code>org.cesecore</code><span style="color: rgb(0,0,0);"> etc. is recommended for production systems.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.signserver:add(level=INFO)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.cesecore:add(level=INFO)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.ejbca:add(level=INFO)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=com.keyfactor:add(level=INFO)'</code></div>
</div>
</div><h4 id="WildFly32+andJBossEAP8-Option2-QuietLogging" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Option 2 - Quiet Logging</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Option-2---Quiet-Logging"></span></h4><p><span style="color: rgb(0,0,0);">If you prefer more quiet logging, configure WildFly to only log audit log messages, warnings and errors.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.cesecore.audit.impl.log4j.Log4jDevice:add(level=INFO)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.signserver:add(level=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.cesecore:add(level=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.ejbca:add(level=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=com.keyfactor:add(level=WARN)'</code></div>
</div>
</div><h4 id="WildFly32+andJBossEAP8-AdditionalLoggingConfiguration" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Additional Logging Configuration</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Additional-Logging-Configuration"></span></h4><p><span style="color: rgb(0,0,0);">You may additionally want to add the following configuration:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.jboss.as.config:write-attribute(name=level, value=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.jboss.as:add(level=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.wildfly:add(level=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.xnio:add(level=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.hibernate:add(level=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.apache.cxf:add(level=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.cesecore.config.ConfigurationHolder:add(level=WARN)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.infinispan:add(level=WARN)'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-AddAccessLogging" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Add Access Logging</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Add-Access-Logging"></span></h3><p><span style="color: rgb(0,0,0);">To log all requests processed by the server, similar to the Apache access log, add the following configuration:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/host=default-host/setting=access-log:add(pattern="%h %t \"%r\" %s \"%{i,User-Agent}\"", relative-to=jboss.server.log.dir, directory=access-logs)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/logger=io.undertow.accesslog:add(level=INFO)'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-RemovetheConsoleHandler" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Remove the Console Handler</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Remove-the-Console-Handler"></span></h3><p><span style="color: rgb(0,0,0);">Console logging is not used when running WildFly with systemd, and removing it can increase logging performance.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/root-logger=ROOT:remove-handler(name=CONSOLE)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/console-handler=CONSOLE:remove()'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-RemoveOldLogFiles" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Remove Old Log Files</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Remove-Old-Log-Files"></span></h3><p><span style="color: rgb(0,0,0);">Log files are rotated on a daily basis by default, but old log files are not deleted automatically. You can delete old log files using a cronjob:</span></p><h4 id="WildFly32+andJBossEAP8-/etc/cron.daily/remove-old-wildfly-logs.sh" data-scroll-heading-rank="4" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="4" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h4 scroll-relative-h4">/etc/cron.daily/remove-old-wildfly-logs.sh<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-/etc/cron.daily/remove-old-wildfly-logs.sh"></span></h4><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="comments">#!/bin/sh</code></div>
<div class="line"><code class="comments"># Remove log files older than 7 days</code></div>
<div class="line"><code class="functions">find</code><code class="plain"> </code><code class="plain">/opt/wildfly/standalone/log/</code><code class="plain"> -</code><code class="functions">type</code><code class="plain"> f -mtime +7 -name </code><code class="string">'server.log*'</code><code class="plain"> -execdir </code><code class="functions">rm</code><code class="plain"> -- </code><code class="string">'{}'</code><code class="plain"> \;</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">Make the file executable:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">chmod +x /etc/cron.daily/remove-old-wildfly-logs.sh</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-EnableSyslogShipping" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Enable Syslog Shipping</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Enable-Syslog-Shipping"></span></h3><p><span style="color: rgb(0,0,0);">To additionally send the server log over UDP to a syslog server such as Graylog or Logstash, configure a syslog handler in WildFly. Set the hostname and port of the syslog server, as well as the desired log level according to the following example:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/json-formatter=logstash:add(exception-output-type=formatted, key-overrides=[timestamp="@timestamp"],meta-data=[@version=1])'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">"/subsystem=logging/syslog-handler=syslog-shipping:add(app-name=SignServer,enabled=true,facility=local-use-0,hostname=$(hostname -f),level=INFO,named-formatter=logstash,port=514,server-address=syslog.server,syslog-format=RFC5424)"</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/root-logger=ROOT:add-handler(name=syslog-shipping)'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-EnableAuditLoggingToFile" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Enable Audit Logging To File</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Enable-Audit-Logging-To-File"></span></h3><p><span style="color: rgb(0,0,0);">You can write the SignServer audit log to a separate file. E.g. to log to </span><code>/opt/wildfly/standalone/log/cesecore-audit.log</code><span style="color: rgb(0,0,0);">, rotate every 128 MB and keep one rotated file:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/size-rotating-file-handler=cesecore-audit-log:add(file={path=cesecore-audit.log, relative-to=jboss.server.log.dir}, max-backup-index=1, rotate-size=128m)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/logger=org.cesecore.audit.impl.log4j.Log4jDevice:add'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/logger=org.cesecore.audit.impl.log4j.Log4jDevice:add-handler(name=cesecore-audit-log)'</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-HTTP(S)Configuration" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">HTTP(S) Configuration</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-HTTP(S)-Configuration"></span></h2><p><span style="color: rgb(0,0,0);">The following section explains how to configure HTTP(S) using Undertow.</span></p><h3 id="WildFly32+andJBossEAP8-RemoveExistingTLSandHTTPConfiguration" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Remove Existing TLS and HTTP Configuration</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Remove-Existing-TLS-and-HTTP-Configuration"></span></h3><p><span style="color: rgb(0,0,0);">Run the following commands in JBoss CLI to remove existing TLS and HTTP configuration:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/http-listener=default:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/https-listener=https:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/socket-binding-group=standard-sockets/socket-binding=http:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/socket-binding-group=standard-sockets/socket-binding=https:remove()'</code></div>
<div class="line"><code class="plain"># These two lines are not needed </code><code class="keyword">if</code><code class="plain"> Galleon was used</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/core-service=management/security-realm=ApplicationRealm/server-identity=ssl:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-Use3-PortSeparation" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Use 3-Port Separation</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Use-3-Port-Separation"></span></h3><p><span style="color: rgb(0,0,0);">The following section explains how to set up Undertow with 3-port separation. Port 8080 is used for HTTP (unencrypted traffic), port 8442 for HTTPS (encrypted) traffic with only server authentication and port 8443 for HTTPS (encrypted) traffic with both server and client authentication.</span></p><h4 id="WildFly32+andJBossEAP8-AddNewInterfacesandSockets" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Add New Interfaces and Sockets</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Add-New-Interfaces-and-Sockets"></span></h4><p><span style="color: rgb(0,0,0);">To add new interfaces and sockets, use the following:</span></p><div class="confluence-information-macro confluence-information-macro-warning"><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><span style="color: rgb(0,0,0);">Consider binding to a specific interface instead of binding to all interfaces using </span><code>0.0.0.0</code><span style="color: rgb(0,0,0);">.</span></p></div></div><p></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/interface=http:add(inet-address="0.0.0.0")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/interface=httpspub:add(inet-address="0.0.0.0")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/interface=httpspriv:add(inet-address="0.0.0.0")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/socket-binding-group=standard-sockets/socket-binding=http:add(port="8080",interface="http")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/socket-binding-group=standard-sockets/socket-binding=httpspub:add(port="8442",interface="httpspub")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/socket-binding-group=standard-sockets/socket-binding=httpspriv:add(port="8443",interface="httpspriv")'</code></div>
</div>
</div><h4 id="WildFly32+andJBossEAP8-ConfigureTLS" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Configure TLS</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Configure-TLS"></span></h4><p><span style="color: rgb(0,0,0);">Configure TLS according to the following instructions.</span></p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><span style="color: rgb(0,0,0);">Make sure the password of the keystore and truststore in this section are correct, in order for the deployment not to fail. In production the passwords should be changed to "real" passwords.</span></p><p><span style="color: rgb(0,0,0);">Note that TLS v1.3 is only available when running JDK 11 or greater.</span></p></div></div><p></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/credential-store=defaultCS:add-alias(alias=httpsKeystorePassword, secret-value="serverpwd")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/credential-store=defaultCS:add-alias(alias=httpsTruststorePassword, secret-value="changeit")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/key-store=httpsKS:add(path="keystore/keystore.jks",relative-to=jboss.server.config.dir,credential-reference={store=defaultCS, alias=httpsKeystorePassword},type=JKS)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/key-store=httpsTS:add(path="keystore/truststore.jks",relative-to=jboss.server.config.dir,credential-reference={store=defaultCS, alias=httpsTruststorePassword},type=JKS)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/key-manager=httpsKM:add(key-store=httpsKS,algorithm="SunX509",credential-reference={store=defaultCS, alias=httpsKeystorePassword})'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/trust-manager=httpsTM:add(key-store=httpsTS)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/server-ssl-context=httpspub:add(key-manager=httpsKM,protocols=["TLSv1.3","TLSv1.2"],use-cipher-suites-order=false,cipher-suite-filter="TLS_DHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256",cipher-suite-names="TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/server-ssl-context=httpspriv:add(key-manager=httpsKM,protocols=["TLSv1.3","TLSv1.2"],use-cipher-suites-order=false,cipher-suite-filter="TLS_DHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256",cipher-suite-names="TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256",trust-manager=httpsTM,need-client-auth=true)'</code></div>
</div>
</div><h4 id="WildFly32+andJBossEAP8-AddHTTP(S)Listeners" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Add HTTP(S) Listeners</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Add-HTTP(S)-Listeners"></span></h4><p><span style="color: rgb(0,0,0);">To add HTTP(S) listeners:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/http-listener=http:add(socket-binding="http", redirect-socket="httpspriv")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/https-listener=httpspub:add(socket-binding="httpspub", ssl-context="httpspub", max-parameters=2048)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/https-listener=httpspriv:add(socket-binding="httpspriv", ssl-context="httpspriv", max-parameters=2048)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of&nbsp;</span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);">&nbsp;before continuing.</span></p><h4 id="WildFly32+andJBossEAP8-ConfiguretheFirewall" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Configure the Firewall</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Configure-the-Firewall"></span></h4><p><span style="color: rgb(0,0,0);">Open port 8080, 8442 and 8443 for incoming TCP traffic.</span></p><h5 id="WildFly32+andJBossEAP8-OpenportsinRHEL/CentOS" data-scroll-heading-rank="5" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="5" class="scroll-h5 scroll-original-h5 scroll-relative-h5 scroll-custom-section-heading scroll-document-section-heading">Open ports in RHEL / CentOS<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Open-ports-in-RHEL-/-CentOS"></span></h5><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">systemctl enable firewalld --now</code></div>
<div class="line"><code class="plain">firewall-cmd --set-</code><code class="keyword">default</code><code class="plain">-zone=dmz</code></div>
<div class="line"><code class="plain">firewall-cmd --zone=dmz --permanent --add-port </code><code class="value">8080</code><code class="plain">/tcp</code></div>
<div class="line"><code class="plain">firewall-cmd --zone=dmz --permanent --add-port </code><code class="value">8442</code><code class="plain">/tcp</code></div>
<div class="line"><code class="plain">firewall-cmd --zone=dmz --permanent --add-port </code><code class="value">8443</code><code class="plain">/tcp</code></div>
<div class="line"><code class="plain">firewall-cmd --reload</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-Use2-PortSeparation2portseparation" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Use 2-Port Separation </span><span class="confluence-anchor-link" id="WildFly32+andJBossEAP8-2portseparation"></span><span class="confluence-anchor-link" id="2portseparation"></span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Use-2-Port-Separation"></span></h3><p><span style="color: rgb(0,0,0);">The following section explains how to set up Undertow with 2-port separation. Port 8080 is used for HTTP (unencrypted traffic) and port 8443 is used for HTTPS (encrypted) traffic with optional client authentication.</span></p><h4 id="WildFly32+andJBossEAP8-AddNewInterfacesandSockets.1" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Add New Interfaces and Sockets</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Add-New-Interfaces-and-Sockets.1"></span></h4><p><span style="color: rgb(0,0,0);">To add new interfaces and sockets, use the following:</span></p><div class="confluence-information-macro confluence-information-macro-warning"><span class="aui-icon aui-icon-small aui-iconfont-error confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><span style="color: rgb(0,0,0);">Consider binding to a specific IP instead of binding to all interfaces using </span><code>0.0.0.0</code><span style="color: rgb(0,0,0);">.</span></p></div></div><p></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/interface=http:add(inet-address="0.0.0.0")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/interface=https:add(inet-address="0.0.0.0")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/socket-binding-group=standard-sockets/socket-binding=http:add(port="8080",interface="http")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/socket-binding-group=standard-sockets/socket-binding=https:add(port="8443",interface="https")'</code></div>
</div>
</div><h4 id="WildFly32+andJBossEAP8-ConfigureTLS.1" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Configure TLS</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Configure-TLS.1"></span></h4><p><span style="color: rgb(0,0,0);">Configure TLS according to the following instructions.</span></p><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p><span style="color: rgb(0,0,0);">Make sure the password of the keystore and truststore in this section are correct, in order for the commands not to fail. In production the passwords should be changed to "real" passwords.</span></p><p><span style="color: rgb(0,0,0);">Note that TLS v1.3 is only available when running JDK 11 or greater.</span></p></div></div><p></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/credential-store=defaultCS:add-alias(alias=httpsKeystorePassword, secret-value="serverpwd")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/credential-store=defaultCS:add-alias(alias=httpsTruststorePassword, secret-value="changeit")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/key-store=httpsKS:add(path="keystore/keystore.p12",relative-to=jboss.server.config.dir,credential-reference={store=defaultCS, alias=httpsKeystorePassword},type=PKCS12)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/key-store=httpsTS:add(path="keystore/truststore.p12",relative-to=jboss.server.config.dir,credential-reference={store=defaultCS, alias=httpsTruststorePassword},type=PKCS12)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/key-manager=httpsKM:add(key-store=httpsKS,algorithm="SunX509",credential-reference={store=defaultCS, alias=httpsKeystorePassword})'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/trust-manager=httpsTM:add(key-store=httpsTS)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/server-ssl-context=https:add(key-manager=httpsKM,protocols=["TLSv1.3","TLSv1.2"],use-cipher-suites-order=false,cipher-suite-filter="TLS_DHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_CHACHA20_POLY1305_SHA256,TLS_ECDHE_ECDSA_WITH_CHACHA20_POLY1305_SHA256",cipher-suite-names="TLS_AES_256_GCM_SHA384:TLS_AES_128_GCM_SHA256:TLS_CHACHA20_POLY1305_SHA256",trust-manager=httpsTM,want-client-auth=true,authentication-optional=true)'</code></div>
</div>
</div><h4 id="WildFly32+andJBossEAP8-AddHTTP(S)Listeners.1" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><br clear="none"><span style="color: rgb(0,0,0);">Add HTTP(S) Listeners</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Add-HTTP(S)-Listeners.1"></span></h4><p><span style="color: rgb(0,0,0);">To add HTTP(S) listeners:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/http-listener=http:add(socket-binding="http", redirect-socket="https")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/https-listener=https:add(socket-binding="https", ssl-context="https", max-parameters=2048)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h4 id="WildFly32+andJBossEAP8-ConfiguretheFirewall.1" data-scroll-heading-rank="4" data-scroll-original-heading-rank="4" data-scroll-relative-heading-rank="4" class="scroll-h4 scroll-original-h4 scroll-relative-h4 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Configure the Firewall</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Configure-the-Firewall.1"></span></h4><p><span style="color: rgb(0,0,0);">Open port 8080 and 8443 for incoming TCP traffic.</span></p><h5 id="WildFly32+andJBossEAP8-OpenportsinRHEL/CentOS.1" data-scroll-heading-rank="5" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="5" class="scroll-h5 scroll-original-h5 scroll-relative-h5 scroll-custom-section-heading scroll-document-section-heading">Open ports in RHEL / CentOS<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Open-ports-in-RHEL-/-CentOS.1"></span></h5><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">systemctl enable firewalld --now</code></div>
<div class="line"><code class="plain">firewall-cmd --set-</code><code class="keyword">default</code><code class="plain">-zone=dmz</code></div>
<div class="line"><code class="plain">firewall-cmd --zone=dmz --permanent --add-port </code><code class="value">8080</code><code class="plain">/tcp</code></div>
<div class="line"><code class="plain">firewall-cmd --zone=dmz --permanent --add-port </code><code class="value">8443</code><code class="plain">/tcp</code></div>
<div class="line"><code class="plain">firewall-cmd --reload</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">Alternatively, you may open port 80 and port 443 and redirect traffic to 8080 and 8443 respectively.</span></p><h5 id="WildFly32+andJBossEAP8-SetupNATinRHEL/CentOS" data-scroll-heading-rank="5" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="5" class="scroll-h5 scroll-original-h5 scroll-relative-h5 scroll-custom-section-heading scroll-document-section-heading">Set up NAT in RHEL / CentOS<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Set-up-NAT-in-RHEL-/-CentOS"></span></h5><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">systemctl enable firewalld --now</code></div>
<div class="line"><code class="plain">firewall-cmd --set-</code><code class="keyword">default</code><code class="plain">-zone=dmz</code></div>
<div class="line"><code class="plain">firewall-cmd --zone=dmz --permanent --add-port </code><code class="value">80</code><code class="plain">/tcp</code></div>
<div class="line"><code class="plain">firewall-cmd --zone=dmz --permanent --add-port </code><code class="value">443</code><code class="plain">/tcp</code></div>
<div class="line"><code class="plain">firewall-cmd --permanent --add-forward-port=port=</code><code class="value">80</code><code class="plain">:proto=tcp:toport=</code><code class="value">8080</code></div>
<div class="line"><code class="plain">firewall-cmd --permanent --add-forward-port=port=</code><code class="value">443</code><code class="plain">:proto=tcp:toport=</code><code class="value">8443</code></div>
<div class="line"><code class="plain">firewall-cmd --reload</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-UseanHSM" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Use an HSM</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Use-an-HSM"></span></h3><p><span style="color: rgb(0,0,0);">You can store the private key for the TLS client certificate in an HSM instead for improved security and performance. WildFly contains the Sun PKCS11 provider which can be used to talk to the HSM using PKCS#11.</span></p><p><span style="color: rgb(0,0,0);">First, create a Sun PKCS11 configuration file according to the following Jinja2 template. Consult your HSM vendor for details on how to set PKCS#11 attributes.</span></p><h4 id="WildFly32+andJBossEAP8-/opt/wildfly/standalone/configuration/pkcs11.cfg" data-scroll-heading-rank="4" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="4" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h4 scroll-relative-h4">/opt/wildfly/standalone/configuration/pkcs11.cfg<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-/opt/wildfly/standalone/configuration/pkcs11.cfg"></span></h4><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">name = HSM</code></div>
<div class="line"><code class="plain">library = {{ PKCS11_LIBRARY }}</code></div>
<div class="line"><code class="plain">slot = {{ SLOT_NUMBER }}</code></div>
<div class="line"><code class="plain">attributes(*, CKO_PUBLIC_KEY, *) = {</code></div>
<div class="line"><code class="plain">  CKA_TOKEN = </code><code class="keyword">false</code></div>
<div class="line"><code class="plain">  CKA_ENCRYPT = </code><code class="keyword">false</code></div>
<div class="line"><code class="plain">  CKA_VERIFY = </code><code class="keyword">true</code></div>
<div class="line"><code class="plain">  CKA_WRAP = </code><code class="keyword">false</code></div>
<div class="line"><code class="plain">}</code></div>
<div class="line"><code class="plain">attributes(*, CKO_PRIVATE_KEY, *) = {</code></div>
<div class="line"><code class="plain">  CKA_TOKEN = </code><code class="keyword">true</code></div>
<div class="line"><code class="plain">  CKA_PRIVATE = </code><code class="keyword">true</code></div>
<div class="line"><code class="plain">  CKA_SENSITIVE = </code><code class="keyword">true</code></div>
<div class="line"><code class="plain">  CKA_EXTRACTABLE = </code><code class="keyword">false</code></div>
<div class="line"><code class="plain">  CKA_DECRYPT = </code><code class="keyword">false</code></div>
<div class="line"><code class="plain">  CKA_SIGN = </code><code class="keyword">true</code></div>
<div class="line"><code class="plain">  CKA_UNWRAP = </code><code class="keyword">false</code></div>
<div class="line"><code class="plain">  CKA_DERIVE = </code><code class="keyword">false</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">Make the file readable by WildFly.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">chown wildfly:wildfly /opt/wildfly/standalone/configuration/pkcs11.cfg</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">Store the token PIN in your credential store.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=elytron/credential-store=defaultCS:add-alias(alias=hsm,secret-value=123456)'</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">Create a provider loader and keystore for the Sun PKCS11 provider.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=elytron/provider-loader=pkcs11:add(class-names=[sun.security.pkcs11.SunPKCS11],path=pkcs11.cfg,relative-to=jboss.server.config.dir,module=sun.jdk)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=elytron/key-store=httpsKSInHSM:add(credential-reference={store=defaultCS, alias=hsm},type=PKCS11,providers=pkcs11)'</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">Generate a keypair and create a CSR using JBoss CLI. The CSR is stored in </span><code>/opt/wildfly/standalone/configuration/keystore</code><span style="color: rgb(0,0,0);">.</span></p><h4 id="WildFly32+andJBossEAP8-RSAkey" data-scroll-heading-rank="4" data-scroll-original-heading-rank="5" data-scroll-relative-heading-rank="4" class="scroll-original-h5 scroll-custom-section-heading scroll-document-section-heading scroll-h4 scroll-relative-h4">RSA key<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-RSA-key"></span></h4><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=elytron/key-store=httpsKSInHSM:generate-key-pair(alias=tlsKey0001, distinguished-name="CN=hostname", algorithm=RSA, key-size=2048)'</code><code class="plain"> </code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect '/subsystem=elytron/key-store=httpsKSInHSM:generate-certificate-signing-request(alias=tlsKey0001, path=keystore/csr.pem, relative-to=jboss.server.config.dir, signature-algorithm=SHA256withRSA)</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">Issue the certificate from your favourite CA and put the certificate chain next to the CSR. Then install it on the token:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=elytron/key-store=httpsKSInHSM:import-certificate(alias=tlsKey0001, path=keystore/chain.pem, relative-to=jboss.server.config.dir)'</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">Switch to the HSM keystore.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/subsystem=elytron/key-manager=httpsKM:write-attribute(name=key-store,value=httpsKSInHSM)</code></div>
<div class="line"><code class="plain">/subsystem=elytron/key-manager=httpsKM:write-attribute(name=credential-reference,value={store=defaultCS, alias=hsm})</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-ConfigureWebServicesWSDLLocationRewrite" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading">Configure Web Services WSDL Location Rewrite<span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Configure-Web-Services-WSDL-Location-Rewrite"></span></h2><p>In order for the web services to work correctly in cases when the client reads the endpoint address from the Web Services Description Language (WSDL) and uses client certificate or a different port, you need to configure the WSDL web-host rewriting to use the request host.</p><p>To configure the WSDL location, run:</p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=webservices:write-attribute(name=wsdl-host, value=jbossws.undefined.host)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=webservices:write-attribute(name=modify-wsdl-address, value=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-OptionalConfiguration" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Optional Configuration</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Optional-Configuration"></span></h2><p><span style="color: rgb(0,0,0);">The following sections cover optional configurations.</span></p><h3 id="WildFly32+andJBossEAP8-RemoveWelcomeContent" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Remove Welcome Content</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Remove-Welcome-Content"></span></h3><p><span style="color: rgb(0,0,0);">Removes the hardcoded welcome page in WildFly. This is not needed if Galleon was used.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/host=default-host/location="\/":remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/configuration=handler/file=welcome-content:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><p><span style="color: rgb(0,0,0);">You can also remove the actual files and save some disk space with:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">rm -rf /opt/wildfly/welcome-content/</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-RedirecttoApplicationforUnknownURLs" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Redirect to Application for Unknown URLs</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Redirect-to-Application-for-Unknown-URLs"></span></h3><p><span style="color: rgb(0,0,0);">Known URLs for SignServer starts with </span><code>/signserver</code><span style="color: rgb(0,0,0);"> according to the following example:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/configuration=filter/rewrite=redirect-to-app:add(redirect=true,target="/signserver/")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/host=default-host/filter-ref=redirect-to-app:add(priority=1,predicate="method(GET) and not path-prefix(/signserver) and not equals({\%{LOCAL_PORT}, 4447})")'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-EnableHTTPStrictTransportLayerSecurity" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Enable HTTP Strict Transport Layer Security</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Enable-HTTP-Strict-Transport-Layer-Security"></span></h3><p><span style="color: rgb(0,0,0);">The </span><code>HTTP</code><span style="color: rgb(0,0,0);"> </span><code>Strict-Transport-Security</code><span style="color: rgb(0,0,0);">&nbsp;response header (HSTS) defined in RFC 6797 tells the browser to only access the server using HTTPS. If you are not serving any resources on the domain over HTTP,&nbsp; you can enable this to improve security. Start off with a small </span><code>max-age</code><span style="color: rgb(0,0,0);"> value (such as 60 seconds) and then gradually increase.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/configuration=filter/response-header=hsts:add(header-name="Strict-Transport-Security",header-value="max-age=31536000")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/host=default-host/filter-ref=hsts:add()'</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">You should also redirect any HTTP traffic to HTTPS. The example assumes port 80 is used for HTTP,&nbsp; port 443 for HTTPS and that the server can be accessed using the domain name&nbsp;</span><code>example.com</code><span style="color: rgb(0,0,0);">.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/configuration=filter/rewrite=http-to-https:add(redirect="true",target="https://example.com:443%U")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/host=default-host/filter-ref=http-to-https:add(predicate="equals(%p,80)")'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-EnableOCSPRevocationChecking" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Enable OCSP Revocation Checking</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Enable-OCSP-Revocation-Checking"></span></h3><p><span style="color: rgb(0,0,0);">WildFly can check the validity of client certificates against the OCSP responder defined by the certificate's AIA extension:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=elytron/trust-manager=httpsTM:write-attribute(name=ocsp, value={})'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);">&nbsp;before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-RemovetheExampleDSDatasource" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Remove the ExampleDS Datasource</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Remove-the-ExampleDS-Datasource"></span></h3><p><span style="color: rgb(0,0,0);">You can remove the ExampleDS datasource as it is not being used. This is not needed if Galleon was used.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=ee/service=default-bindings:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'data-source remove --name=ExampleDS'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-RemoveUnusedSubsystemsandExtensions" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Remove Unused Subsystems and Extensions</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Remove-Unused-Subsystems-and-Extensions"></span></h3><p><span style="color: rgb(0,0,0);">Optionally remove the unused subsystems and extensions. This is not needed if Galleon was used.</span></p><p><span style="color: rgb(0,0,0);">If you used the </span><em><span style="color: rgb(0,0,0);">Jakarta EE Full &amp; Web Distribution</span></em><span style="color: rgb(0,0,0);"> zip package:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=jdr:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=sar:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=jmx:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=pojo:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=microprofile-metrics-smallrye:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=microprofile-jwt-smallrye:remove()'</code><code class="plain"> </code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=ee-security:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=microprofile-health-smallrye:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=microprofile-opentracing-smallrye:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=distributable-web:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=security/security-domain=jaspitest:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=datasources/jdbc-driver=h2:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=microprofile-config-smallrye:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=request-controller:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=security-manager:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.wildfly.extension.microprofile.config-smallrye:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.wildfly.extension.microprofile.metrics-smallrye:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.wildfly.extension.microprofile.jwt-smallrye:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.wildfly.extension.clustering.web:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.wildfly.extension.microprofile.health-smallrye:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.wildfly.extension.microprofile.opentracing-smallrye:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.jboss.as.jdr:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.jboss.as.jmx:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.jboss.as.sar:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.jboss.as.pojo:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.wildfly.extension.ee-security:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.wildfly.extension.request-controller:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/extension=org.wildfly.extension.security.manager:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-RemoveAJP" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Remove AJP</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Remove-AJP"></span></h3><p><span style="color: rgb(0,0,0);">Clean up all AJP related configuration if you are not using it.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/socket-binding-group=standard-sockets/socket-binding=ajp:remove()'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-EnableAJPConnector" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Enable AJP Connector</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Enable-AJP-Connector"></span></h3><p><span style="color: rgb(0,0,0);">Enabling the AJP connector is only needed if you terminate the TLS connection at a proxy (such as Apache or nginx) running in front of WildFly:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/ajp-listener=ajp-listener:add(socket-binding=ajp, scheme=https, enabled=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);"> before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-AddaRequestLimiter" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Add a Request Limiter</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Add-a-Request-Limiter"></span></h3><p><span style="color: rgb(0,0,0);">You can limit the number of concurrent connections by adding a request limiter in Undertow. For example, to allow 100 connections to be processed at the same time, and allow up to 300 connections to be queued before new connections are rejected:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/configuration=filter/request-limit=signserver-request-limiter:add(max-concurrent-requests=100,queue-size=300)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/host=default-host/filter-ref=signserver-request-limiter:add(predicate=path-prefix(/signserver)'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-RestrictAccesstoServices" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Restrict Access to Services</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Restrict-Access-to-Services"></span></h3><p><span style="color: rgb(0,0,0);">You can whitelist IP addresses or block access to some services completely using predicates and handlers in Undertow.</span></p><p><span style="color: rgb(0,0,0);">For example, to only allow access to the administration web from localhost:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/configuration=filter/expression-filter=local-only:add(expression="ip-access-control(acl={127.0.0.0/8 allow})")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/host=default-host/filter-ref=local-only:add(predicate="path-prefix(/signserver/adminweb)")'</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">To block access to the public web pages and the SignServer documentation:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/configuration=filter/expression-filter=not-found:add(expression="response-code(404)")'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/host=default-host/filter-ref=not-found:add(predicate="path-prefix(/signserver/doc) or path(/signserver)")'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-OnlyDeployatStartup" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Only Deploy at Startup</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Only-Deploy-at-Startup"></span></h3><p><span style="color: rgb(0,0,0);">Historically application servers are really bad at cleaning up memory from previous deployments and hot (re-)deploy is discouraged in production. To avoid manual deployment with the management interface, we can specify that the deployment directory should be scanned once at application server startup by setting the scan-interval to 0. This also prevents an attacker from loading a malicious JAR file by dropping it in the </span><code>deployments</code><span style="color: rgb(0,0,0);"> directory.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=deployment-scanner/scanner=default:write-attribute(name=scan-interval,value=0)'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-IncreasetheDeploymentTimeout" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Increase the Deployment Timeout</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Increase-the-Deployment-Timeout"></span></h3><p><span style="color: rgb(0,0,0);">If you are using HSMs with smart card authentication or if the database needs to reindex when WildFly boots, you may have to increase the deployment timeout to be able to deploy SignServer correctly. The deployment timeout is specified in seconds, the command below sets it to 5 minutes.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=deployment-scanner/scanner=default:write-attribute(name=deployment-timeout,value=300)'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-DisableManagementWebConsole" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Disable Management Web Console</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Disable-Management-Web-Console"></span></h3><p><span style="color: rgb(0,0,0);">If you only plan on using the JBoss CLI anyway there is little reason to keep this around.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/core-service=management/management-interface=http-interface:write-attribute(name=console-enabled,value=false)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);">&nbsp;Wait for the reload to complete by checking the server log or the result of&nbsp;</span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);">&nbsp;before continuing.</span></p><h3 id="WildFly32+andJBossEAP8-IncreasetheMaximumUploadSize" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Increase the Maximum Upload Size</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Increase-the-Maximum-Upload-Size"></span></h3><div class="confluence-information-macro confluence-information-macro-note"><span class="aui-icon aui-icon-small aui-iconfont-warning confluence-information-macro-icon"></span><div class="confluence-information-macro-body"><p>Note that WildFly defaults to an HTTP post size limit of 10 MB. To allow signing larger files, increase the limits on the HTTP/HTTPS listeners using the <code>max-post-size</code> attribute in the following code examples.</p></div></div><p><span style="color: rgb(0,0,0);">Increase the maximum size of POST requests to for instance 25 MB. This may be needed if you like to sign larger files.</span></p><p><span style="color: rgb(0,0,0);">If 3-port separation is used, increase the maximum upload size for the 3 listeners.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/http-listener=http:write-attribute(name=max-post-size,value=25485760)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/https-listener=httpspriv:write-attribute(name=max-post-size,value=25485760)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/https-listener=httpspub:write-attribute(name=max-post-size,value=25485760)'</code><code class="plain"> </code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">If 2-port separation is used, increase the maximum upload size for the 2 listeners instead.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/http-listener=http:write-attribute(name=max-post-size,value=25485760)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=undertow/server=default-server/https-listener=https:write-attribute(name=max-post-size,value=25485760)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-EnableWildFlyAuditLogging" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Enable WildFly Audit Logging</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Enable-WildFly-Audit-Logging"></span></h3><p><span style="color: rgb(0,0,0);">WildFly can audit log changes made to the management model and output audit log events in JSON format to the file </span><code>/opt/wildfly/standalone/data/audit-log.log</code><span style="color: rgb(0,0,0);">. Audit logging is disabled by default. To enable it, run:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/core-service=management/access=audit/logger=audit-log:write-attribute(name=enabled,value=true)'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-RemoveWildFlyAuditLogging" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Remove WildFly Audit Logging</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Remove-WildFly-Audit-Logging"></span></h3><p><span style="color: rgb(0,0,0);">You may remove the WildFly audit logging configuration completely if you are not using it.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/core-service=management/access=audit:remove()'</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-StartWildFlyonSystemBoot" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Start WildFly on System Boot</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Start-WildFly-on-System-Boot"></span></h3><p><span style="color: rgb(0,0,0);">To make SignServer available automatically after a system restart, use systemd.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">systemctl enable wildfly</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-PerformanceTuning" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Performance Tuning</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Performance-Tuning"></span></h2><p><span style="color: rgb(0,0,0);">The following section covers WildFly configuration for maximizing SignServer performance. The best setup could vary from installation to installation and should be manually fine-tuned. However, the "default" configuration would typically be a good starting point. You should also consider increasing the heap (RAM) for SignServer instances under high load to at least 4 GB.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=io/worker=default/:write-attribute(name=task-core-threads,value=25)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=io/worker=default/:write-attribute(name=task-max-threads,value=100)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=io/worker=default/:write-attribute(name=io-threads,value=100)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=ejb3/strict-max-bean-instance-pool=slsb-strict-max-pool:undefine-attribute(name=derive-size)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=ejb3/strict-max-bean-instance-pool=slsb-strict-max-pool:write-attribute(name=max-pool-size, value=32)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=datasources/data-source=signserverds/:write-attribute(name=max-pool-size,value=150)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">':reload'</code></div>
</div>
</div><p><img class="emoticon emoticon-warning scroll-document-image" src="_scroll_external/icons/7bb080c29b97/warning.png" width="16" height="16" alt="(varning)"><span style="color: rgb(0,0,0);"> Wait for the reload to complete by checking the server log or the result of </span><code>:read-attribute(name=server-state)</code><span style="color: rgb(0,0,0);">&nbsp;before continuing.</span></p><h2 id="WildFly32+andJBossEAP8-CreateaSnapshotoftheConfiguration" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Create a Snapshot of the Configuration</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Create-a-Snapshot-of-the-Configuration"></span></h2><p><span style="color: rgb(0,0,0);">Create a snapshot of the current configuration to make sure you can revert back to a working state.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">':take-snapshot(name="Initial configuration")'</code></div>
<div class="line"><code class="functions">cp</code><code class="plain"> </code><code class="plain">/opt/wildfly/standalone/configuration/standalone</code><code class="plain">.xml </code><code class="plain">/opt/wildfly/standalone/configuration/standalone</code><code class="plain">.xml.backup</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-CreateaTerminalAliasforReadingtheLogFile" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Create a Terminal Alias for Reading the Log File</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Create-a-Terminal-Alias-for-Reading-the-Log-File"></span></h2><p><span style="color: rgb(0,0,0);">SignServer is logging all actions to the WildFly log file located in </span><code>/opt/wildfly/standalone/log/server.log</code><span style="color: rgb(0,0,0);">. It is often useful to be able to quickly filter and inspect the latest log lines. If you are using Fish you can add the following function to your </span><code>config.fish</code><span style="color: rgb(0,0,0);">:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="keyword">function</code><code class="plain"> wflog --description </code><code class="string">'Tail and optionally filter the WildFly log file'</code></div>
<div class="line"><code class="plain">    </code><code class="functions">tail</code><code class="plain"> -f </code><code class="plain">/opt/wildfly/standalone/log/server</code><code class="plain">.log | \</code></div>
<div class="line"><code class="plain">        </code><code class="functions">awk</code><code class="plain"> '</code><code class="plain">/TRACE/</code><code class="plain"> {print </code><code class="string">"\033[93m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/DEBUG/</code><code class="plain"> {print </code><code class="string">"\033[0;32m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/INFO/</code><code class="plain"> {print </code><code class="string">"\033[0;34m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/WARN/</code><code class="plain"> {print </code><code class="string">"\033[0;33m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/ERROR/</code><code class="plain"> {print </code><code class="string">"\033[0;31m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/SEVERE/</code><code class="plain"> {print </code><code class="string">"\033[1;31m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             !/(TRACE|DEBUG|INFO|WARN|ERROR|SEVERE)/ {print </code><code class="string">"\033[93m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}' | \</code></div>
<div class="line"><code class="plain">        </code><code class="functions">grep</code><code class="plain"> --line-buffered --color=never -E </code><code class="string">"$argv[1]"</code></div>
<div class="line"><code class="plain">end</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">Or if you are using Bash, add this to your </span><code>.bashrc</code><span style="color: rgb(0,0,0);">:</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">wflog() { </code></div>
<div class="line"><code class="plain">    </code><code class="functions">tail</code><code class="plain"> -f </code><code class="plain">/opt/wildfly/standalone/log/server</code><code class="plain">.log | \</code></div>
<div class="line"><code class="plain">        </code><code class="functions">awk</code><code class="plain"> '</code><code class="plain">/TRACE/</code><code class="plain"> {print </code><code class="string">"\033[93m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/DEBUG/</code><code class="plain"> {print </code><code class="string">"\033[0;32m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/INFO/</code><code class="plain"> {print </code><code class="string">"\033[0;34m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/WARN/</code><code class="plain"> {print </code><code class="string">"\033[0;33m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/ERROR/</code><code class="plain"> {print </code><code class="string">"\033[0;31m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             </code><code class="plain">/SEVERE/</code><code class="plain"> {print </code><code class="string">"\033[1;31m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}</code></div>
<div class="line"><code class="plain">             !/(TRACE|DEBUG|INFO|WARN|ERROR|SEVERE)/ {print </code><code class="string">"\033[93m"</code><code class="plain"> $0 </code><code class="string">"\033[39m"</code><code class="plain">}' | \</code></div>
<div class="line"><code class="plain">        </code><code class="functions">grep</code><code class="plain"> --line-buffered --color=never -E </code><code class="string">"$argv[1]"</code></div>
<div class="line"><code class="plain">}</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-ClearCommandLineHistory" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Clear Command Line History</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Clear-Command-Line-History"></span></h2><p><span style="color: rgb(0,0,0);">Clear the command line history to prevent accidental viewing of passwords put into the credential store.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="functions">history</code><code class="plain"> -c</code></div>
</div>
</div><h2 id="WildFly32+andJBossEAP8-NextStep:InstallSignServer" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Next Step: Install SignServer</span><br clear="none"><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Next-Step:-Install-SignServer"></span></h2><p><span style="color: rgb(0,0,0);">For instructions on how to install SignServer, see</span><span style="color: rgb(0,51,102);"> </span><a href="Install_SignServer.html" data-linked-resource-id="370999413" data-linked-resource-version="15" data-linked-resource-type="page" data-scroll-target-source-id="370999413" class=" scroll-document-link" data-scroll-link-type="document" data-scroll-link-target="https://keyfactor.atlassian.net/wiki/spaces/SSDOCS/pages/370999413/Install+SignServer" data-scroll-link-target-source-id="370999413">Install SignServer</a><span style="color: rgb(0,51,102);">.</span></p><h2 id="WildFly32+andJBossEAP8-DebugSignServer" data-scroll-heading-rank="2" data-scroll-original-heading-rank="2" data-scroll-relative-heading-rank="2" class="scroll-h2 scroll-original-h2 scroll-relative-h2 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Debug SignServer</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Debug-SignServer"></span></h2><p><span style="color: rgb(0,0,0);">The following explains the configuration options in WildFly for troubleshooting SignServer.</span></p><h3 id="WildFly32+andJBossEAP8-SwitchtoDebugLoggingGlobally" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Switch to Debug Logging Globally</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Switch-to-Debug-Logging-Globally"></span></h3><p><span style="color: rgb(0,0,0);">To enable debug logging globally, if you need to troubleshoot, follow these steps.</span></p><ol start="1"><li><p><span style="color: rgb(0,0,0);">Make a note of the current log level for the packages</span><code> org.cesecore</code><span style="color: rgb(0,0,0);"> and </span><code>org.signserver</code><span style="color: rgb(0,0,0);">.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/logger=org.cesecore:read-attribute(name=level)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/logger=org.signserver:read-attribute(name=level)'</code></div>
</div>
</div></li><li><p><span style="color: rgb(0,0,0);">Switch to debug logging.</span></p><div class="scroll-code scroll-highlighted-code-block" data-language="bash" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.signserver:write-attribute(name=level, value=DEBUG)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli</code><code class="plain">.sh --connect </code><code class="string">'/subsystem=logging/logger=org.cesecore:write-attribute(name=level, value=DEBUG)'</code></div>
</div>
</div><p></p></li></ol><p><span style="color: rgb(0,0,0);">Once you are done troubelshooting, switch back to the log level you used previously. Note that having debug logging enabled globally will produce a lot of output, avoid using this configuration in production and consider enabling debugging for individual packages instead.</span></p><h3 id="WildFly32+andJBossEAP8-LogRequestsandResponsesfortheWebServiceAPI" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Log Requests and Responses for the WebService API</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Log-Requests-and-Responses-for-the-WebService-API"></span></h3><p><span style="color: rgb(0,0,0);">To log the SOAP messages received by and sent from SignServer:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=org.apache.cxf.logging.enabled:add(value=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/logger=org.apache.cxf.services:add(level=INFO)'</code></div>
<div class="line"><code class="plain">systemctl restart wildfly</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">To remove the configuration when you are done:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=org.apache.cxf.logging.enabled:remove'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/logger=org.apache.cxf.services:remove'</code></div>
<div class="line"><code class="plain">systemctl restart wildfly</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-EnableHibernateStatistics" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Enable Hibernate Statistics</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Enable-Hibernate-Statistics"></span></h3><p><span style="color: rgb(0,0,0);">Hibernate is the ORM library used by SignServer to create SQL queries. You can enable Hibernate statistics to get the SQL query, as well as the time it takes to execute it, written in the server log.</span></p><p><span style="color: rgb(0,0,0);">Hibernate statistics are quite verbose and there may be database-specific tools better suited to troubleshoot database performance, however if you want to enable it:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=datasources/data-source=signserverds/statistics=pool:write-attribute(name=statistics-enabled,value=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=datasources/data-source=signserverds/statistics=jdbc:write-attribute(name=statistics-enabled,value=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=hibernate.generate_statistics:add(value=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=hibernate.show_sql:add(value=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=hibernate.format_sql:add(value=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=hibernate.use_sql_comments:add(value=true)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/logger=org.hibernate.stat:add(level=DEBUG)'</code></div>
<div class="line"><code class="plain">systemctl restart wildfly</code></div>
</div>
</div><p><span style="color: rgb(0,0,0);">To remove the configuration:</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=logging/logger=org.hibernate.stat:remove'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=hibernate.use_sql_comments:remove'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=hibernate.format_sql:remove'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=hibernate.show_sql:remove'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/system-property=hibernate.generate_statistics:remove'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=datasources/data-source=signserverds/statistics=jdbc:write-attribute(name=statistics-enabled,value=false)'</code></div>
<div class="line"><code class="plain">/opt/wildfly/bin/jboss-cli.sh --connect </code><code class="string">'/subsystem=datasources/data-source=signserverds/statistics=pool:write-attribute(name=statistics-enabled,value=false)'</code></div>
<div class="line"><code class="plain">systemctl restart wildfly</code></div>
</div>
</div><h3 id="WildFly32+andJBossEAP8-EnableProfilingUsingGlowroot" data-scroll-heading-rank="3" data-scroll-original-heading-rank="3" data-scroll-relative-heading-rank="3" class="scroll-h3 scroll-original-h3 scroll-relative-h3 scroll-custom-section-heading scroll-document-section-heading"><span style="color: rgb(0,0,0);">Enable Profiling Using Glowroot</span><span class="confluence-anchor-link" id="src-370999400_WildFly32+andJBossEAP8-Enable-Profiling-Using-Glowroot"></span></h3><ol start="1"><li><p><span style="color: rgb(0,0,0);">Download</span><span style="color: rgb(0,51,102);"> </span><a shape="rect" href="https://glowroot.org/" class="external-link scroll-external-link" rel="nofollow" data-scroll-link-type="default" data-scroll-link-target="https://glowroot.org/" data-scroll-link-local="false"><span style="color: rgb(0,51,102);">Glowroot</span></a><span style="color: rgb(0,51,102);"> </span><span style="color: rgb(0,0,0);">and put it in your WildFly directory.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">wget https:</code><code class="comments">//github.com/glowroot/glowroot/releases/download/v0.13.6/glowroot-0.13.6-dist.zip -O /tmp/glowroot.zip</code></div>
<div class="line"><code class="plain">unzip -q /tmp/glowroot.zip -d /opt/wildfly</code></div>
<div class="line"><code class="plain">chown -R wildfly:wildfly /opt/wildfly/glowroot</code></div>
</div>
</div><p></p></li><li><p><span style="color: rgb(0,0,0);">Register Glowroot as a Java agent and restart WildFly.</span></p><div class="scroll-code scroll-highlighted-code-block" data-title-type="code" data-theme="defaultnew" style="  counter-reset: scroll-code-numbering 0;"><div class="defaultnew content">
<div class="line"><code class="plain">sed -i </code><code class="string">'/-Djdk.tls.ephemeralDHKeySize=2048/ a \ \ \ JAVA_OPTS=\"$JAVA_OPTS -javaagent:/opt/wildfly/glowroot/glowroot.jar"'</code><code class="plain"> /opt/wildfly/bin/standalone.conf</code></div>
<div class="line"><code class="plain">systemctl restart wildfly</code></div>
</div>
</div><p></p></li><li><p><span style="color: rgb(0,0,0);">Glowroot should now be&nbsp;available on</span> <a shape="rect" href="http://localhost:4000" class="external-link scroll-external-link" rel="nofollow" data-scroll-link-type="default" data-scroll-link-target="http://localhost:4000" data-scroll-link-local="false">http://localhost:4000</a>.</p></li></ol>
<nav id="ht-post-nav">
        <a href="Application_Server_Setup.html" class="ht-post-nav-prev">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-prev" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-45.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Application Server Setup</span>
        </a>

        <a href="Install_SignServer.html" class="ht-post-nav-next">
            <svg width="22px" height="22px" viewbox="0 0 22 22" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                <g id="ht-icon-next" sketch:type="MSArtboardGroup">
                    <path fill="#000000" d="M16,8 L16,6 L6,6 L6,16 L8,16 L8,8 L16,8 Z" id="Rectangle-2" sketch:type="MSShapeGroup" transform="translate(11.000000, 11.000000) rotate(-225.000000) translate(-11.000000, -11.000000) "></path>
                </g>
            </svg>
            <span>Install SignServer</span>
        </a>
</nav>
                    </div>
                </section>
            </article>
        </div>

        <div class="vp-article__aside-right flex-shrink-0 w-1/6 article__toc hidden xl:block no-print">
            <div class="vp-scrollable-container vp-scrollable-container--hidden-scrollbars">
                <div class="js-tocBot">
                                    </div>
            </div>
        </div>

    </div>
</div>
        </main>


        <div id="vp-js-mobile__navigation">
            <div tabindex="-1" class="vp-mobile-navigation__trigger fixed outline-none z-mobile-menu-trigger">
                <button type="button" class="vp-button vp-button--variant-floating-action vp-mobile-navigation__button flex items-center justify-center" aria-label="navigation.open.label">
                    <div class="vp-mobile-navigation__button__icon relative">
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                        <div class="absolute w-full"></div>
                    </div>
                </button>
            </div>
        </div>

        <script src="js/app.js"></script>
    </body>
</html>