<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=windows-1252">
	<TITLE></TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 2.0  (Win32)">
	<META NAME="CREATED" CONTENT="20060126;8484600">
	<META NAME="CHANGED" CONTENT="20070810;21471204">
	<META NAME="SDFOOTNOTE" CONTENT=";;;;P">
	<META NAME="SDENDNOTE" CONTENT="ARABIC">
	<STYLE>
	<!--
		@page { size: 21cm 29.7cm; margin: 2cm }
		P { margin-bottom: 0cm; background: transparent; color: #000000; text-align: left; widows: 2; orphans: 2 }
		P.western { font-family: "Times New Roman", serif; font-size: 12pt; so-language: en-GB }
		P.cjk { font-family: "MS Mincho", "MS ??", monospace; font-size: 14pt; so-language: ja-JP }
		H1 { margin-bottom: 0.21cm; background: transparent; color: #000000; text-align: left; widows: 2; orphans: 2; page-break-after: auto }
		H1.western { font-family: "Times New Roman", serif; font-size: 14pt; so-language: en-GB }
		H1.cjk { font-family: "MS Mincho", "MS ??", monospace; font-size: 14pt; so-language: ja-JP }
		H1.ctl { font-family: "Arial Unicode MS"; font-size: 12pt; font-weight: medium }
		H2 { margin-top: 0.21cm; margin-bottom: 0cm; background: transparent; color: #000000; text-align: left; widows: 2; orphans: 2 }
		H2.western { font-size: 14pt; so-language: en-GB; font-style: italic; font-weight: medium }
		H2.cjk { font-family: "MS Mincho", "MS ??", monospace; font-size: 12pt; so-language: ja-JP; font-weight: medium }
		H2.ctl { font-family: "Arial Unicode MS"; font-size: 12pt; font-weight: medium }
		H3 { margin-top: 0cm; margin-bottom: 0cm; background: transparent; color: #000000; text-align: left; widows: 2; orphans: 2 }
		H3.western { font-family: "Times", serif; so-language: en-GB; font-style: italic; font-weight: medium }
		H3.cjk { font-family: "MS Mincho", "MS ??", monospace; font-size: 10pt; so-language: ja-JP; font-weight: medium }
		H3.ctl { font-family: "Arial Unicode MS"; font-size: 12pt; font-weight: medium }
		TD P { margin-bottom: 0cm; background: transparent; color: #000000; text-align: left; widows: 2; orphans: 2 }
		TD P.western { font-family: "Times New Roman", serif; font-size: 12pt; so-language: en-GB }
		TD P.cjk { font-family: "MS Mincho", "MS ??", monospace; font-size: 14pt; so-language: ja-JP }
		TH P { margin-bottom: 0cm; background: transparent; color: #000000; widows: 2; orphans: 2 }
		TH P.western { font-family: "Times New Roman", serif; font-size: 12pt; so-language: en-GB; font-style: italic }
		TH P.cjk { font-family: "MS Mincho", "MS ??", monospace; font-size: 14pt; so-language: ja-JP; font-style: italic }
		TH P.ctl { font-style: italic }
		A:link { color: #0000ff }
		A:visited { color: #800080 }
	-->
	</STYLE>
</HEAD>
<BODY LANG="en-US" TEXT="#000000" LINK="#0000ff" VLINK="#800080" DIR="LTR">
<DIV TYPE=HEADER>
	<P LANG="en-GB"><BR>
	</P>
	<TABLE WIDTH=611 BORDER=1 BORDERCOLOR="#000000" CELLPADDING=5 CELLSPACING=0 RULES=NONE>
		<COL WIDTH=152>
		<COL WIDTH=229>
		<COL WIDTH=115>
		<COL WIDTH=73>
		<TR VALIGN=TOP>
			<TD ROWSPAN=2 WIDTH=152>
				<P LANG="en-GB"><BR>
				</P>
			</TD>
			<TD ROWSPAN=2 COLSPAN=2 WIDTH=354>
				<P LANG="en-GB" ALIGN=CENTER STYLE="margin-top: 0.21cm">
				<FONT FACE="Verdana, sans-serif"><FONT SIZE=2><FONT SIZE=2><SPAN LANG="en-US">SignServer,
				Manual</SPAN> <SDFIELD TYPE=DOCINFO SUBTYPE=TITLE></SDFIELD></FONT></FONT></FONT></P>
			</TD>
			<TD WIDTH=73 HEIGHT=5>
				<P LANG="" ALIGN=LEFT STYLE="margin-top: 0.04cm; background: transparent">
				<FONT COLOR="#800000"><FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 6pt"><B>Sidnr
				/ <I>Page no</I></B></FONT></FONT></FONT></P>
			</TD>
		</TR>
		<TR>
			<TD WIDTH=73 HEIGHT=6 VALIGN=TOP>
				<P LANG="en-GB"><SPAN STYLE="text-decoration: none"><SDFIELD TYPE=PAGE SUBTYPE=RANDOM FORMAT=PAGE>23</SDFIELD>
				<FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="Verdana, sans-serif">(<SDFIELD TYPE=DOCSTAT SUBTYPE=PAGE FORMAT=ARABIC>23</SDFIELD>)</FONT></SPAN></FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD COLSPAN=2 WIDTH=391 HEIGHT=1>
				<P LANG="" ALIGN=LEFT STYLE="margin-top: 0.04cm; background: transparent">
				<FONT COLOR="#800000"><FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 6pt"><B>Uppgjort
				/ <I>Auhtor	</I></B></FONT></FONT></FONT></P>
			</TD>
			<TD COLSPAN=2 WIDTH=197>
				<P LANG="" ALIGN=LEFT STYLE="margin-top: 0.04cm; background: transparent">
				<FONT COLOR="#800000"><FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 6pt"><B>Sekretess
				/ <I>Confidentiality</I></B></FONT></FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD COLSPAN=2 WIDTH=391 HEIGHT=5>
				<P LANG="en-GB"><FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 8pt"><B>Philip
				Vendil</B></FONT></FONT></P>
				<P LANG="en-GB"><BR>
				</P>
			</TD>
			<TD COLSPAN=2 WIDTH=197>
				<P LANG="" ALIGN=LEFT STYLE="background: transparent"><FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 8pt"><B>UNRESTRICTED</B></FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD COLSPAN=2 WIDTH=391 HEIGHT=1>
				<P LANG="" ALIGN=LEFT STYLE="margin-top: 0.04cm; background: transparent">
				<FONT COLOR="#800000"><FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 6pt"><B><SPAN LANG="">Godk&auml;nd
				/ </SPAN><I>Authorized</I></B></FONT></FONT></FONT></P>
			</TD>
			<TD WIDTH=115>
				<P LANG="" ALIGN=LEFT STYLE="margin-top: 0.04cm; background: transparent">
				<FONT COLOR="#800000"><FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 6pt"><B><SPAN LANG="">Datum
				  <I>Date</I></SPAN></B></FONT></FONT></FONT></P>
			</TD>
			<TD WIDTH=73>
				<P LANG="" ALIGN=LEFT STYLE="margin-top: 0.04cm; background: transparent">
				<FONT COLOR="#800000"><FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 6pt"><B>Version</B></FONT></FONT></FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD COLSPAN=2 WIDTH=391 HEIGHT=4>
				<P LANG="en-GB"><BR>
				</P>
			</TD>
			<TD WIDTH=115>
				<P LANG="en-GB" ALIGN=LEFT><SDFIELD TYPE=DATETIME SDNUM="1053;2057;DD/MM/YY">10/08/07</SDFIELD></P>
				<P LANG="en-GB" ALIGN=LEFT><BR>
				</P>
			</TD>
			<TD WIDTH=73>
				<P LANG=""><FONT FACE="Verdana, sans-serif"><FONT SIZE=1 STYLE="font-size: 8pt"><B>2
				.0</B></FONT></FONT></P>
			</TD>
		</TR>
	</TABLE>
	<P LANG="en-GB" CLASS="western" STYLE="margin-bottom: 0.5cm"><BR>
	</P>
</DIV>
<P ALIGN=CENTER STYLE="margin-left: 1.28cm; text-indent: 0cm; margin-top: 3.18cm; margin-bottom: 0.85cm; line-height: 0.85cm; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Verdana, sans-serif"><FONT SIZE=6 STYLE="font-size: 28pt"><B><FONT FACE="Helvetica, sans-serif"><BR></FONT></B><SPAN STYLE="font-weight: medium"><FONT FACE="Helvetica, sans-serif"><I>SignServer</I></FONT></SPAN></FONT></FONT></P>
<P ALIGN=CENTER STYLE="margin-left: 1.28cm; margin-top: 3.18cm; margin-bottom: 0.85cm; font-weight: medium; line-height: 0.85cm; page-break-inside: avoid; page-break-after: avoid">
<FONT FACE="Verdana, sans-serif"><FONT SIZE=6 STYLE="font-size: 28pt">Manual</FONT></FONT></P>
<P CLASS="western" ALIGN=CENTER><I>Ver: 2_0</I></P>
<P LANG="en-GB" ALIGN=CENTER STYLE="margin-left: 1.47cm; margin-right: 1.47cm; text-indent: 0cm; background: #ffffff; line-height: 0.85cm; page-break-inside: avoid; page-break-after: avoid">
<BR>
</P>
<P LANG="en-GB" CLASS="western">								</P>
<P LANG="sv-SE" CLASS="western"><BR>
</P>
<P LANG="sv-SE" ALIGN=CENTER STYLE="margin-top: 0.35cm; font-weight: medium">
     <SDFIELD TYPE=DATETIME SDNUM="1053;1053;YY-MM-DD">07-08-10</SDFIELD></P>
<P LANG="sv-SE" ALIGN=CENTER STYLE="font-weight: medium"><BR>
</P>
<P LANG="sv-SE" ALIGN=CENTER STYLE="font-weight: medium"><BR>
</P>
<P LANG="sv-SE" ALIGN=CENTER STYLE="font-weight: medium"><BR>
</P>
<P LANG="sv-SE" ALIGN=CENTER STYLE="font-weight: medium"><BR>
</P>
<P LANG="sv-SE" ALIGN=CENTER STYLE="font-weight: medium"><BR>
</P>
<P LANG="sv-SE" ALIGN=CENTER STYLE="font-weight: medium"><BR>
</P>
<P LANG="sv-SE" ALIGN=CENTER STYLE="font-weight: medium"><BR>
</P>
<P LANG="sv-SE" ALIGN=CENTER STYLE="font-weight: medium"><BR>
</P>
<P LANG="sv-SE" ALIGN=CENTER><BR>
</P>
<H1 LANG="en-GB" CLASS="western" STYLE="page-break-before: always">1 
Introduction/Scope</H1>
<P LANG="en-GB" CLASS="western" STYLE="font-style: normal"><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>The
SignServer is an application framework performing signatures for
other applications.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>It's
intended to be used in environments where keys are supposed to be
protected in hardware but</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>there
isn't possible to connect such hardware to existing enterprise
applications. Another usage is to</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>provide
a simplified method to provide signatures in different application
managed from one</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>location
in the company.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>The
SignServer have been designed for high-availability and can be
clustered for maximum</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>reliability.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>The
SignServer comes with a RFC 3161 compliant Time-Stamp signer serving
requests through http or client-authenticated https. And a MRTD
(Machine Readable Travel Document, i.e. electronic <SPAN STYLE="font-style: normal">passport)
signer.</SPAN></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" STYLE="font-style: normal"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="font-style: normal"><BR>
</P>
<P LANG="en-GB" CLASS="western"><SPAN ID="Frame1" DIR="LTR" STYLE="float: left; width: 17cm; height: 8.7cm; border: none; padding: 0cm; background: #ffffff">
	<P LANG="en-GB" ALIGN=CENTER STYLE="margin-top: 0.21cm; margin-bottom: 0.21cm">
	<IMG SRC="SignServer_Manual_2_0_html_m6a7f442a.jpg" NAME="graphics1" ALIGN=LEFT WIDTH=100% BORDER=0><BR CLEAR=LEFT><FONT SIZE=2><I>Drawing
	1: Overview of a possible set up of a highly available SignServer
	solution</I></FONT></P>
</SPAN><BR CLEAR=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="page-break-before: always"><BR>
</P>
<H2 LANG="en-GB" CLASS="western">1.1Changes from Version 1</SPAN></H2>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT>&#9679;
<FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">signserver_server.property
file have been removed and replaced with a global configuration</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>store.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT>&#9679; <FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">It
is now possible to dynamically and and remove available signers</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT>&#9679; <FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">A
new type of component, &ldquo;Service&rdquo; that is run on a timely
basis, used to perform</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>maintenance
or report generation.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT>&#9679; <FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Improved
cluster deployment functionality.</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT>&#9679; <FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">New
CLI tools to batch configure the SignServer, and to backup a current
configuration. This</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>makes
it possible to set-up a configuration in test environment, dump the
configuration and</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>configure
it in production.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">2 Document History</H1>
<TABLE WIDTH=100% BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=29*>
	<COL WIDTH=28*>
	<COL WIDTH=39*>
	<COL WIDTH=160*>
	<THEAD>
		<TR VALIGN=TOP>
			<TH WIDTH=11%>
				<P LANG="en-GB" CLASS="western">Version</P>
			</TH>
			<TH WIDTH=11%>
				<P LANG="en-GB" CLASS="western">Date</P>
			</TH>
			<TH WIDTH=15%>
				<P LANG="en-GB" CLASS="western">Name</P>
			</TH>
			<TH WIDTH=62%>
				<P LANG="en-GB" CLASS="western">Comment</P>
			</TH>
		</TR>
	</THEAD>
	<TBODY>
		<TR VALIGN=TOP>
			<TD WIDTH=11%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>0.1</FONT></P>
			</TD>
			<TD WIDTH=11%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>2006-06-04</FONT></P>
			</TD>
			<TD WIDTH=15%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>Philip Vendil</FONT></P>
			</TD>
			<TD WIDTH=62%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>Initial version of
				this document.</FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=11%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>1.0 RC1</FONT></P>
			</TD>
			<TD WIDTH=11%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>2006-08-22</FONT></P>
			</TD>
			<TD WIDTH=15%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>Philip Vendil</FONT></P>
			</TD>
			<TD WIDTH=62%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>Prerelease version</FONT></P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=11%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>2.0</FONT></P>
			</TD>
			<TD WIDTH=11%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>2007-08-10</FONT></P>
			</TD>
			<TD WIDTH=15%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>Philip Vendil</FONT></P>
			</TD>
			<TD WIDTH=62%>
				<P LANG="en-GB" CLASS="western"><FONT SIZE=2>Update with new
				features for version 2</FONT></P>
			</TD>
		</TR>
	</TBODY>
</TABLE>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="page-break-before: always"><BR>
</P>
<DIV ID="Table of Contents1" DIR="LTR">
	<DIV ID="Table of Contents1_Head" DIR="LTR">
		<P LANG="sv-SE" STYLE="margin-top: 0.42cm; margin-bottom: 0.21cm; page-break-after: avoid">
		<FONT SIZE=4><B>Table of Contents</B></FONT></P>
	</DIV>
	<P LANG="en-GB">1  Introduction/Scope	2</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">1.1Changes
	from Version 1	3</P>
	<P LANG="en-GB">2 Document History	3</P>
	<P LANG="en-GB">3 Quick-start of a Simple Time-stamp Server	5</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">3.1Required
	Software	5</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">3.2Installation
	Steps	5</P>
	<P LANG="en-GB">4 Terms Used in This Document	7</P>
	<P LANG="en-GB">5 Overall Architecture 	8</P>
	<P LANG="en-GB">6 Available Signers	9</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">6.1Time-stamp
	Signer	9</P>
	<P LANG="en-GB" STYLE="margin-left: 0.71cm; text-indent: 0cm">6.1.1Overview	9</P>
	<P LANG="en-GB" STYLE="margin-left: 0.71cm; text-indent: 0cm">6.1.2Available
	Properties	9</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">6.2MRTD
	Signer	10</P>
	<P LANG="en-GB" STYLE="margin-left: 0.71cm; text-indent: 0cm">6.2.1Overview	10</P>
	<P LANG="en-GB" STYLE="margin-left: 0.71cm; text-indent: 0cm">6.2.2Available
	Properties	10</P>
	<P LANG="en-GB">7 Available SignTokens	11</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">7.1P12SignToken	11</P>
	<P LANG="en-GB" STYLE="margin-left: 0.71cm; text-indent: 0cm">7.1.1Overview	11</P>
	<P LANG="en-GB" STYLE="margin-left: 0.71cm; text-indent: 0cm">7.1.2Available
	Properties	11</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">7.2PrimeCardHSMSignToken	11</P>
	<P LANG="en-GB" STYLE="margin-left: 0.71cm; text-indent: 0cm">7.2.1Overview	11</P>
	<P LANG="en-GB" STYLE="margin-left: 0.71cm; text-indent: 0cm">7.2.2Available
	Properties	11</P>
	<P LANG="en-GB">8 Setting Authorization Type	12</P>
	<P LANG="en-GB">9 Disabling a Signer	12</P>
	<P LANG="en-GB">10 Archiving Responses	12</P>
	<P LANG="en-GB">11 The Global Configuration Store	12</P>
	<P LANG="en-GB">12 Services	13</P>
	<P LANG="en-GB">13 Building and Deploying the SignServer	13</P>
	<P LANG="en-GB">14 Administrating the SignServer	14</P>
	<P LANG="en-GB">15 Making the SignServer highly-available	17</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">15.1HTTP
	access requires a load balancer	17</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">15.2Setting
	up a MySQL Cluster	17</P>
	<P LANG="en-GB">16 For Developers	18</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">16.1The
	ISigner Interface	18</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">16.2The
	ISignToken Interface	18</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">16.3The
	IService Interface	20</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">16.4Using
	the Global Configuration Store	20</P>
	<P LANG="en-GB">17 Testing	22</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">17.1Automatic
	Junit Tests	22</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">17.2The
	Test Client	22</P>
	<P LANG="en-GB" STYLE="margin-left: 0.35cm; text-indent: 0cm">17.3Manual
	Tests	22</P>
	<P LANG="en-GB">18 References	23</P>
</DIV>
<H1 LANG="en-GB" CLASS="western" STYLE="page-break-before: always">3 Quick-start
of a Simple Time-stamp Server</H1>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>This
section will show how to set up a quick and simple standalone
time-stamp server, accepting</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>time-stamp
requests over plain HTTP.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<H2 LANG="en-GB" CLASS="western">3.1Required Software</SPAN></H2>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<UL>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Java
	1.5 (or 1.4) (http://java.sun.com)</FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>JBoss-4.0.5.GA
	(http://www.jboss.org)</FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Ant
	version 1.7 (http://ant.apache.org)</FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">SignServer-2.0
	(<FONT COLOR="#0000ff">http://www.signserver.org</FONT>)</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>1
	web-server key-store in Java key-store format (JKS), (make sure that
	the server certificate have the right host name in it's CN)</FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>1
	Root certificate of the web-server in DER encoding</FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT"><FONT COLOR="#000000">1
	Time-stamp key-store in PKCS12 format<BR></FONT></FONT></FONT><BR>
	</P>
</UL>
<H2 LANG="en-GB" CLASS="western">3.2Installation Steps</SPAN></H2>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>1.
First make sure that ant, Java and JBoss is installed properly.<BR></FONT></FONT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>2.
Set the JAVA_HOME, JBOSS_HOME and SIGNSERVER_HOME environment
variables.<BR></FONT></FONT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>3.
Set the SIGNSERVER_NODEID environment variable, it should be a server
unique string</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>identifying
the node in a cluster. (optional for one node installations).<BR></FONT></FONT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>4.
Unzip the SignServer package and go to it's home directory.<BR></FONT></FONT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>5.
If you are going to protect the HTTP communication with SSL, you need
a JKS SSL server</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>key
store. Rename the web server key store to tomcat.jks at put it in a
'p12' subdirectory.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Also
place the web server root certificate in DER encoding in the same
directory, call it</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>rootcert.cer</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>6.
Then copy the signserver_build.properties.sample file to
signserver_buld.properties and edit</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>the
file. At least configure the httpsserver.password property. If you
are not using https</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">uncomment
the row &ldquo;</FONT></FONT><FONT FACE="CourierNewPSMT">j2ee.web-nohttps=<FONT COLOR="#2a00ff">true&rdquo;.</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>7.
Do 'ant deploy' and then start JBoss (JBOSS_HOME\bin\run.sh) in
another console.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>8.
Edit the signserver_cli.properties and set the host name.*
properties.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>9.
Edit the qs_timestamp_configuration.properties file and set the
default policy id, the path to</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>the
timestamp p12 file and its password.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">10.
Use the signserver cli to upload the configuration file. (if it's not
executive use chmod +x bin/signserver.sh) </FONT></FONT></FONT></FONT>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT"><BR></FONT></FONT>bin\signserver.sh
setproperies qs_timestamp_configuration.properties</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>(In
the path section, use '\\' for '\' in windows environment.)</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Then
run</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=2>bin\signserver.sh
getconfig 1</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Or
you could use the signers name</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=2>bin\signserver.sh
getconfig timestampSigner</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>And
double-check the configuration. (Important, the properties are case
sensitive).</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Finally
run</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=2>bin\signserver.sh
reload 1</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>To
activate the configuration.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>11.
Run the test-client to see that everything is up.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=2>cd
dist-client</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT FACE="CourierNewPSMT">java
-jar timeStampClient.jar
&ldquo;<FONT COLOR="#0000ff">http://localhost:8080/signserver/tsa?signerId=1</FONT>&rdquo;</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>`</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>The
message &ldquo;TimeStampRequest Validated&rdquo; should appear once a
second.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Also
check JBOSS_HOME/server/default/log/server.log that successful
messages appear.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H1 LANG="en-GB" CLASS="western" STYLE="page-break-before: always">4 Terms
Used in This Document</H1>
<TABLE WIDTH=100% BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=128*>
	<COL WIDTH=128*>
	<THEAD>
		<TR VALIGN=TOP>
			<TH WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Term</P>
			</TH>
			<TH WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Explanation</P>
			</TH>
		</TR>
	</THEAD>
	<TBODY>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Signer</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">A service performing signatures
				upon requests. This could be a ready made signer or a custom
				developed one.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Sign Token</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">A Sign Token is name for the
				entity containing the private key. Every Signer have a Sign Token
				that can be a PKCS12, Smart Card or HSM connection.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Service</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">A service is a task that is run
				on a timely basis, performing maintenance tasks like changing
				active key, or it could generate a report.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Worker</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">A common name for Signer and
				Service</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Worker Configuration</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Each Worker (Signer of Service)
				can be configured with properties specific for that worker. There
				are two sets of worker configuration one &ldquo;Active&rdquo;
				that is used by the signer and one &ldquo;current&rdquo; which is
				the one configured by the administrator. The current
				configuration isn't used in production until the administrator
				issued the reload command. This makes it possible for the
				administrator to configure multiple properties and double-check
				them before they are actually used.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Global Configuration Store</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Is a dynamic store used to define
				available Signers and their Sign Tokens or Services. But other
				data that needs to be read globally could be set there as well.
				The global configuration properties are activated immediately.
				There are two different scopes for the store data, Global Scope
				and Node Scope.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Global Scope</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Data stored in the global
				configuration that can be read by all nodes in the cluster.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Node Scope</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Data that is node specific and
				can only be read within the same node.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Signer Id</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Unique identifier of a signer, an
				integer larger than 0</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Signer Name</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western">A name used as a human readable
				synonym for a Signer Id</P>
			</TD>
		</TR>
	</TBODY>
</TABLE>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">5 Overall Architecture 
</H1>
<P LANG="en-GB" CLASS="western">The SignServer is a framework
designed to perform different kind of digital signatures for
different applications. 
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">To access the SignServer there are
different options depending on the signer used. The time-stamp signer
uses HTTP for remote access and the MRDT Signer uses RMI-SSL
(requires commercial add-on from PrimeKey Solutions,
www.primekey.se).</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">There are two main concepts to the
SignServer and that is Signers (which performs the actual signature
and are identified by a name or signerId ) and SignToken which is an
entity that keeps track of the signing keys (can be either software
or hardware based).</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The applications i administrated
through a command-line interface, where the properties and access
control can be configured.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The currently exists two
authentication modes, one using client authenticated SSL where the
serial number of each signer client have to be in the signers access
list for the signature to be performed. The other is an
unauthenticated mode where there isn't any requirements on who
requests a signature.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">One SignServer can have multiple
signers for different purposes.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">New to version two of the SignServer
is the possibility to create services that does for example
maintenance (or reports) on a timely basis.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">Another new core feature is the
possibility to dynamically add and remove signers to the system using
a global configuration store. See the Global Configuration Store for
more information.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="page-break-before: always"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">6 Available Signers</H1>
<P LANG="en-GB" CLASS="western">There currently exists two types of
signers. The first one is the time stamp signer generating RFC 3161
compliant timestamps using the Bouncycastle library. The other is a
MRTD signer creating 'Machine Reader Travel Document' signatures
using the RSA algorithm from pre-padded data.</P>
<H2 LANG="en-GB" CLASS="western">6.1Time-stamp Signer</SPAN></H2>
<P LANG="en-GB" CLASS="western">The time-stamp signer have the class
path: org.signserver.server.signers.MRTDSigner</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H3 LANG="en-GB" CLASS="western">6.1.1Overview</H3>
<P LANG="en-GB" CLASS="western">The time stamp server generates time
stamp tokens and have the support for the following options:</P>
<UL>
	<LI><P LANG="en-GB" CLASS="western">Set of accepted policies</P>
	<LI><P LANG="en-GB" CLASS="western">Set of accepted algorithms</P>
	<LI><P LANG="en-GB" CLASS="western">Set of accepted extensions</P>
	<LI><P LANG="en-GB" CLASS="western">Accuracy microseconds</P>
	<LI><P LANG="en-GB" CLASS="western">Accuracy milliseconds</P>
	<LI><P LANG="en-GB" CLASS="western">Accuracy seconds</P>
	<LI><P LANG="en-GB" CLASS="western">Included certificate chain
	(currently doesn't include CRLs)</P>
	<LI><P LANG="en-GB" CLASS="western">Ordering</P>
	<LI><P LANG="en-GB" CLASS="western">TSA name</P>
</UL>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The time stamp signer currently don't
support:</P>
<UL>
	<LI><P LANG="en-GB" CLASS="western">CRL inclusion</P>
	<LI><P LANG="en-GB" CLASS="western">Signed attributes</P>
	<LI><P LANG="en-GB" CLASS="western">Unsigned attributes 
	</P>
</UL>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">Timestamps requests are served
through a http service at the URL: 
</P>
<P LANG="en-GB" CLASS="western">'http://&lt;host
name&gt;/signserver/tsa?signerId=&lt;signer Id&gt;'</P>
<P LANG="en-GB" CLASS="western">If no 'signerId' parameter is
specified then will the id of 1 be used as default.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The time-stamp signer requires a
time-stamp certificate with the extended key usage 'time-stamp' only.
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H3 LANG="en-GB" CLASS="western">6.1.2Available Properties</H3>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The following properties can be
configured with the signer:</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>TIMESOURCE</I></B>
= property containing the class path to the ITimeSource
implementation that should be used. (OPTIONAL, default
LocalComputerTimeSource)</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>ACCEPTEDALGORITHMS</I></B>
= A ';' separated string containing accepted algorithms, can be null
if it shouldn't be used. (OPTIONAL, Strongly recommended)</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 2.54cm">Supported
Algorithms are: <I>GOST3411, MD5, SHA1, SHA224, SHA256, SHA384,
SHA512, RIPEMD128, RIPEMD160, RIPEMD256</I></P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>ACCEPTEDPOLICIES</I></B>
=  A ';' separated string containing accepted policies, can be null
if it shouldn't be used. (OPTIONAL, Recommended)</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>ACCEPTEDEXTENSIONS</I></B>
= A ';' separated string containing accepted extensions, can be null
if it shouldn't be used. (OPTIONAL)</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>DEFAULTTSAPOLICYOID</I></B>
= The default policy ID of the time stamp authority (REQUIRED, if no
policy OID is specified in the request then will this value be used.)</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>ACCURACYMICROS</I></B>
= Accuracy in micro seconds, Only decimal number format, only one of
the accuracy properties should be set (OPTIONAL)</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>ACCURACYMILLIS</I></B>
= Accuracy in milliseconds, Only decimal number format, only one of
the accuracy properties should be set (OPTIONAL)</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>ACCURACYSECONDS</I></B>
= Accuracy in seconds. Only decimal number format, only one of the
accuracy properties should be set (OPTIONAL)</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>ORDERING</I></B>
= The ordering (OPTIONAL), default false.</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>TSA</I></B>
= General name of the Time Stamp Authority. (OPTIONAL)</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H2 LANG="en-GB" CLASS="western">6.2MRTD Signer</SPAN></H2>
<P LANG="en-GB" CLASS="western">The MRTD signer have the class path:
org.signserver.server.signers.MRTDSigner</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H3 LANG="en-GB" CLASS="western">6.2.1Overview</H3>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The MRTD Signer performs a RSA
signing operation on incoming data. The data should already be
padded. This signer i used to sign 'Machine Readable Travel
Documents' i.e. electronic passports.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The signatures are requested through
RMI-SSL and PrimeCard is required to build it. No load balancer is
required to make it redundant, this is done with the client libs.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H3 LANG="en-GB" CLASS="western">6.2.2Available Properties</H3>
<P LANG="en-GB" CLASS="western">No configuration properties exists.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="page-break-before: always"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">7 Available SignTokens</H1>
<P LANG="en-GB" CLASS="western">There exists two types of sign
tokens, one storing the keys in software and one on SmartCards. See
the developer section for information about developing support for
other HSMs.</P>
<H2 LANG="en-GB" CLASS="western">7.1P12SignToken</SPAN></H2>
<P LANG="en-GB" CLASS="western">The P12SignToken signer have the
class path: org.signserver.server.signertokens.P12SignToken</P>
<H3 LANG="en-GB" CLASS="western">7.1.1Overview</H3>
<P LANG="en-GB" CLASS="western">A SignToken using a PKCS 12 key-store
in the file-system. Can  only contain one signing key.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">In a clustered environment must the
key store be at the same location at all nodes.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The P12SignToken, doesn't support the
destroyKey() method</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H3 LANG="en-GB" CLASS="western">7.1.2Available Properties</H3>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm">
<B><I>KEYSTOREPATH</I></B> : The full path to the key-store to load.
(required)</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>KEYSTOREPASSWORD</I></B>
: The password that locks the key-store. Used for automatic
activation.</P>
<H2 LANG="en-GB" CLASS="western">7.2PrimeCardHSMSignToken</SPAN></H2>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H3 LANG="en-GB" CLASS="western">7.2.1Overview</H3>
<P LANG="en-GB" CLASS="western">Using PrimeCardHSM it's possible to
use a SmartCard to generate 2048-bit signatures. The SmartCard can
perform about one signature a second.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">PrimeCardHSM requires PCSCD software
and SmartCard drivers. See separate documentation about installing
PrimeCardHSM.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The PrimeCardHSMSignToken, doesn't
support the destroyKey() method</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H3 LANG="en-GB" CLASS="western">7.2.2Available Properties</H3>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><I><B>defaultKey
=  </B></I><SPAN STYLE="font-weight: medium"><SPAN STYLE="font-style: normal">
Hash value of the signing key on the card. See PrimeCardHSM
documentation for more information.(Required)</SPAN></SPAN></P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm; font-style: normal; font-weight: medium">
<BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><I><B>authCode
= </B></I><SPAN STYLE="font-weight: medium"><SPAN STYLE="font-style: normal">Authentication
code for automatic activation (Optional).</SPAN></SPAN></P>
<H1 LANG="en-GB" CLASS="western" STYLE="page-break-before: always">8 Setting
Authorization Type</H1>
<P LANG="en-GB" CLASS="western">By default is client-certificate
authentication required for a signature request to be processed. This
can be changed with the <B><I>AUTHTYPE</I></B><SPAN STYLE="font-weight: medium"><SPAN STYLE="font-style: normal">
property.</SPAN></SPAN></P>
<P LANG="en-GB" CLASS="western" STYLE="font-style: normal; font-weight: medium">
<BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm; font-style: normal; font-weight: medium">
AUTHTYPE =  NOAUTH, sets the server to not require any
authentication.</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm; font-style: normal; font-weight: medium">
<BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm; font-style: normal; font-weight: medium">
AUTHTYPE =  CLIENTCERT (default) requires a certificate of all the
clients. The certificates must be in the signers access control list
and be trusted by the Java distribution, i.e imported in
JAVA_HOME/jre/lib/security/cacerts.</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm; font-style: normal; font-weight: medium">
<BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm; font-style: normal; font-weight: medium">
<BR>
</P>
<H1 LANG="en-GB" CLASS="western">9 Disabling a Signer</H1>
<P LANG="en-GB" CLASS="western">A signer can be disabled, which means
that it won't perform any signature requests or be included in the
health check. 
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">To disable a signer set the property
&ldquo;DISABLED&rdquo; to &ldquo;TRUE&rdquo;</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">10 Archiving Responses</H1>
<P LANG="en-GB" CLASS="western">If there is a need to save all
generated responses, then set the property &ldquo;ARCHIVE&rdquo; to
&ldquo;TRUE&rdquo; and all generated responses for that signer will
be saved to database.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The archived responses can later be
extracted from data base using the CLI interface. See the CLI section
for more information.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">11 The Global Configuration Store</H1>
<P LANG="en-GB" CLASS="western">The available signers and its sign
tokens and services is configured in something called the global
configuration store that is slightly different from a worker
configuration.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">Is is dynamically configured and
activated immediately. I can contain any type of data (in string
representation) and can be of two types, either with global scope or
node scope. A Global scoped property can be read ny and is common to
all nodes in the cluster while a Node scoped property in only used
within a node and cannot be accessed by other nodes.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">Is there is no activation of the
global properties, database failure is handled differently. If a node
looses connection to the database it put itself in a state called
'unsynchronised' a will continue operation without storing the data
to database by using a cached global configuration. It is possible to
later resynchronise a nodes global configuration data  with a CLI
command called 'resync'. But it is only possible to sync one of the
nodes global configuration to the database.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">12 Services</H1>
<P LANG="en-GB" CLASS="western">A service is a task that is run on a
timely basis, performing maintenance tasks like changing active key,
or it could generate a report.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">Currently isn't the SignServer
shipped with any services out of the box, but read the developer
section about how to write custom services.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">13 Building and Deploying the
SignServer</H1>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>How
to set-up a highly available SignServer cluster is described in a
separate document called</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">SignServer_2_Installation_Guide.pdf
that can be downloaded from <FONT COLOR="#0000ff">http://www.signserver.org</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>The
document describes how to set it up in a Cent OS 4.4 environment with
two service nodes and</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>one
management node, but should be rather easy to adjust to other
platforms.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" STYLE="page-break-before: always"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">14 Administrating the SignServer</H1>
<P LANG="en-GB" CLASS="western">The sign server is administrated
using a CLI interface.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">Every signer is identified by a id
and optionally a name that can be used in all the CLI commands.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">It is possible to do configuration of
a signer or service while being in production. All configuration
commands are cached until a reload command is issued and the
configuration becomes active.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">There is a special property file for
the cli interface called signserver_cli.properties defining which
nodes that exists in the cluster. The properties are:</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><I>hostname.masternode</I></B>
= Should only contain one of the nodes, specified as the default
master node. Used by operations dealing with the database and where
not all nodes in the cluster needs to be contacted. It is possible to
override this setting by using the -host &lt;host name&gt; parameter.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="margin-left: 1.27cm"><B><SPAN STYLE="text-decoration: none"><I>hostname.allnodes</I></SPAN></B>
= Should contain all the nodes in the cluster, separated by a ';'.
Used by the commands getStatus, activateSignToken and
deactivateSignToken.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The cli lies in bin\signserver.sh/cmd</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>Get Status Command</I></B>:</P>
<P LANG="en-GB" CLASS="western">Returns the status of the given
signer, it says if it's sign token is active or not and the loaded
'active' configuration. It is possible to get a brief summary or a
complete listing for one signer or all configured signers. If all
signers are displayed will also all the global configuration
parameters be displayed.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>Get Configuration Command</I></B>:</P>
<P LANG="en-GB" CLASS="western">Returns the current worker or global
configuration depending on options.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">For worker configuration observe that
this configuration might not have been activated yet, not until a
'reload' command is issued.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>Set Property Command</I></B>:</P>
<P LANG="en-GB" CLASS="western">Sets a custom property used by the
signer or signer token, see reference for the Signer and SignToken
for available properties.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><I><B>Set Properties Command</B></I></P>
<P LANG="en-GB" CLASS="western">Command used to batch a set of
properties, both for the global and worker configuration.</P>
<P LANG="en-GB" CLASS="western">It can be used to configure a signer
in a test environment, dump all the properties and upload it into
production.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT>It reads all the
configuration properties form a property file and depending on the
contents of the key it sets the given property. All properties will
be set  according to the following defined rule set.</P>
<TABLE WIDTH=100% BORDER=1 BORDERCOLOR="#000000" CELLPADDING=4 CELLSPACING=0>
	<COL WIDTH=128*>
	<COL WIDTH=128*>
	<THEAD>
		<TR VALIGN=TOP>
			<TH WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Rule</P>
			</TH>
			<TH WIDTH=50%>
				<P LANG="en-GB" CLASS="western">Comment</P>
			</TH>
		</TR>
	</THEAD>
	<TBODY>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Properties starting
				with id&lt;num&gt;.</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Will set the property
				to the value of the given id to the worker with the given id.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Properties starting
				with name&lt;name&gt;.</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Will set the property
				to a worker with the given name. (If the name doesn't exists a
				unique id will be generated and assigned).</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Property keys
				containing GENID&lt;NUM&gt;, example WORKERGENID1 or GLOB.
				WORKERGENID1 
				</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>The SignServer will
				find a free unique id and assign substitute all GENID&lt;num&gt;
				with this id.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Properties starting
				with glob.</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Will set a global
				property with global scope.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Properties starting
				with node.</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Will set a global
				property with node scope.</P>
			</TD>
		</TR>
		<TR VALIGN=TOP>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Properties starting
				with -&lt;other prefix&gt;&lt;value&gt;</P>
			</TD>
			<TD WIDTH=50%>
				<P LANG="en-GB" CLASS="western" ALIGN=LEFT>Will remove the
				property, either worker or global.</P>
			</TD>
		</TR>
	</TBODY>
</TABLE>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT>See the file
democonfiguration.properties for examples.</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western"><I><B>Remove Property Command:</B></I></P>
<P LANG="en-GB" CLASS="western">Removes a configured property</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><I><B>Dump Properties</B></I></P>
<P LANG="en-GB" CLASS="western" STYLE="font-style: normal; font-weight: medium">
This tool will dump all configured properties for one or all workers
in the system into a property file. If the configuration for one
worker is dumped it can be used to transfer the configuration from
one installation to another. If all configurations is dumped, it can
be used as a backup tool.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>Upload Certificate Command</I></B>:</P>
<P LANG="en-GB" CLASS="western">Used when updating the certificate
used for signing, sign requests</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>Upload Certificate Chain
Command</I></B>:</P>
<P LANG="en-GB" CLASS="western">Used when updating the TSA signer
when using a Hard Signer Token. Use this one instead of 'Upload
Certificate Command' in this case.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><I><B>Generate Certificate Request
Command</B></I></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Used
to generate a certificate request for a signer to be signed by a
certificate authority. It takes</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>distinguished
name and signature algorithm as parameters and writes the request in
PEM format to</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>file.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>Add Authorized Client Command</I></B>:</P>
<P LANG="en-GB" CLASS="western">Adds a client certificate to a
signers list of acceptable clients using this signer. specify</P>
<P LANG="en-GB" CLASS="western">certificate serial number in hex and
the Issuer DN of the client certificate.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>Removes Authorized Certificate
Command</I></B>:</P>
<P LANG="en-GB" CLASS="western">Removes added client certificates.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>List Authorized Clients
Commands</I></B>:</P>
<P LANG="en-GB" CLASS="western">Displays the current list of
acceptable clients.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>Activate Sign Token Command</I></B>:</P>
<P LANG="en-GB" CLASS="western">Used to activate hard sign tokens,
authentication code is usually the PIN used to unlock the key store
on the HSM. Not used if token is set to auto-activation.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><B><I>Deactivate Sign Token Command</I></B>:</P>
<P LANG="en-GB" CLASS="western">Brings a Sign Token Off-line. Not
used if token is set to auto-activation.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><I><B>Archive Find from Archive Id
Command:</B></I></P>
<P LANG="en-GB" CLASS="western">Command used to extract archived data
from database identified by the archive Id.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The Id depends on the signer, in case
of the TSA is the TimeStampInfo serial number used.</P>
<P LANG="en-GB" CLASS="western">The data is stored with the same file
name as the archive id in the specified path.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><I><B>Archive Find from Request IP
Command:</B></I></P>
<P LANG="en-GB" CLASS="western">Used to extract all archived data
requested from a specified IP address.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">All data is stored as separate files
with the archive id as file name in the specified path.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><I><B>Archive Find from Request
Certificate Command:</B></I></P>
<P LANG="en-GB" CLASS="western">Used to extract all archived data
requested from a client by specified it's certificates serial number
and  issuer DN.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">All data is stored as separate files
with the archive id as file name in the specified path.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="page-break-before: always"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">15 Making the SignServer
highly-available</H1>
<H2 LANG="en-GB" CLASS="western">15.1HTTP access requires a load
balancer</SPAN></H2>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">HTTP based signers like the TSA can
be clustered using a health check servlet returning the state of the
signserver. The health check servlet can be configured in the file
src/web/healthcheck/WEB-INF/web.xml. With the default settings will
the servlet return the text 'ALLOK' when accessing the URL
<A HREF="http://localhost:8080/signserver/healthcheck/signserverhealth">http://localhost:8080/signserver/<FONT SIZE=2><FONT FACE="Courier New">healthcheck/signserverhealth</FONT></FONT></A><FONT SIZE=2><FONT FACE="Courier New">.
</FONT></FONT><FONT SIZE=3><FONT FACE="Times New Roman, serif">If
something is wrong with the sign server will and error message be
sent back instead.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><FONT FACE="Times New Roman, serif"><FONT SIZE=3>The
healthcheck servlet can also be used to monitor the signserver by
creating a script that monitors the URL periodically for error
messages.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">Tip, heartbeat with ldirectord is a
good solution for a load balancer and works well with the sign
server.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H2 LANG="en-GB" CLASS="western">15.2Setting up a MySQL Cluster</SPAN></H2>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">The
database backed of the SignServer can be made redundant using MySQL
Cluster. Details on how to set-up the MySQL cluster can be found in
the document SignServer_2_Installation_Guide.pdf that can be
downloaded from <FONT COLOR="#0000ff">http://www.signserver.org.</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>More
information about the MySQL Cluster can be found at</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#0000ff"><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>http://www.mysql.com/products/database/cluster/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="page-break-before: always"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">16 For Developers</H1>
<P LANG="en-GB" CLASS="western">To develop custom signers and sign
tokens the following steps have to be done</P>
<H2 LANG="en-GB" CLASS="western">16.1The ISigner Interface</SPAN></H2>
<UL>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Create
	a custom signer class implementing the
	org.signserver.server.signers.ISigner interface. There exists a
	BaseSigner that can be inherited taking care of some of the
	functionality. If the BaseSigner is inherited only one method
	signData() needs to be implemented.</FONT></FONT></FONT></FONT></P>
</UL>
<UL>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">You
	can define your own properties that the signer can use for
	configuration.</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Make
	sure the custom class is available to the application server</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Redeploy
	the signer server and it the signer is ready to be configured and
	then used.</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Register
	the signer in the application by setting a property
	</FONT></FONT><FONT FACE="CourierNewPSMT">WORKER&lt;id&gt;.CLASSPATH
	</FONT><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">with a global
	scope in the global configuration. (Also make sure to set it's sign
	tokens class-path, see next section).</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Reload
	the service with the CLI reload command.</FONT></FONT></FONT></FONT></P>
	<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3><BR></FONT></FONT><BR>
	</P>
</UL>
<H2 LANG="en-GB" CLASS="western">16.2The ISignToken Interface</SPAN></H2>
<UL>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">A
	custom sign token needs to implement the interface
	org.signserver.server.signtokens.ISignToken.  See P12SignToken for
	an example implementation.</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">You
	can define own properties for a sign token in the same way as for
	signers. The properties are sent to the sign token upon
	initialization.</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Make
	sure the custom class is available to the application server</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Redeploy
	the signer server.</FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Register
	the signer token to a signer in the application by setting a
	property <FONT SIZE=2><FONT FACE="Verdana"><FONT FACE="CourierNewPSMT">WORKER&lt;id&gt;.SIGNTOKEN.CLASSPATH
	</FONT><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">with a global
	scope in the global configuration. (Also </FONT></FONT></FONT></FONT>make
	sure to set it's sign tokens class-path, see next section).</FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Reload
	the service with the CLI reload command.</FONT></FONT></P>
</UL>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT STYLE="border-top: none; border-bottom: 1px solid #000000; border-left: none; border-right: none; padding-top: 0cm; padding-bottom: 0.07cm; padding-left: 0cm; padding-right: 0cm">
<FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>The ISignToken interface
have the following methods that needs to be implemented.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
interface </FONT></FONT></B><FONT FACE="CourierNewPSMT">ISignToken {</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
static final int </FONT></FONT></B><I><FONT FACE="CourierNewPS-ItalicMT"><FONT COLOR="#0000c1">PURPOSE_SIGN
</FONT></FONT></I><FONT FACE="CourierNewPSMT">= 1;</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
static final int </FONT></FONT></B><I><FONT FACE="CourierNewPS-ItalicMT"><FONT COLOR="#0000c1">PURPOSE_DECRYPT
</FONT></FONT></I><FONT FACE="CourierNewPSMT">= 2;</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
static final int </FONT></FONT></B><I><FONT FACE="CourierNewPS-ItalicMT"><FONT COLOR="#0000c1">PROVIDERUSAGE_SIGN
</FONT></FONT></I><FONT FACE="CourierNewPSMT">= 1;</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
static final int </FONT></FONT></B><I><FONT FACE="CourierNewPS-ItalicMT"><FONT COLOR="#0000c1">PROVIDERUSAGE_DECRYPT
</FONT></FONT></I><FONT FACE="CourierNewPSMT">= 2;</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method called after creation of instance.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
abstract void </FONT></FONT></B><FONT FACE="CourierNewPSMT">init(Properties
props);</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method that returns the current status of the sign token.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT">*
<FONT COLOR="#3f5fc0">Should return one of the
SignerStatus..STATUS_.. values</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
abstract int </FONT></FONT></B><FONT FACE="CourierNewPSMT">getSignTokenStatus();</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method used to activate SignTokens when connected after being
offline.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">authenticationcode
used to unlock catoken,i.e PIN for smartcard</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
HSMs</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@throws
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">SignTokenOfflineException
if SignToken is not available or connected.</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#3f5fc0">*
</FONT><FONT COLOR="#7fa0c0">@throws
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">SignTokenAuthenticationFailedException
with error message if authentication to</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
SignTokens fail.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
abstract void </FONT></FONT></B><FONT FACE="CourierNewPSMT">activate(String
authenticationcode) </FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">throws</FONT></FONT></B></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">SignTokenAuthenticationFailureException,
SignTokenOfflineException;</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method used to deactivate Hard CA Tokens.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Used to set a CAToken too offline status and to reset the HSMs</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
authorization code.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@return
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">true
if deactivation was successful.</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
abstract boolean </FONT></FONT></B><FONT FACE="CourierNewPSMT">deactivate();</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**
Returns the private key (if possible) of token.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">purpose
should one of the PURPOSE_... constants</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#3f5fc0">*
</FONT><FONT COLOR="#7fa0c0">@throws </FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">SignTokenOfflineException
if SignToken is not available or</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
connected.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@return
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">PrivateKey
object</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
abstract </FONT></FONT></B><FONT FACE="CourierNewPSMT">PrivateKey
getPrivateKey(</FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">int
</FONT></FONT></B><FONT FACE="CourierNewPSMT">purpose) </FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">throws
</FONT></FONT></B><FONT FACE="CourierNewPSMT">SignTokenOfflineException;</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**
Returns the public key (if possible) of token.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">purpose
should one of the PURPOSE_... constants</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#3f5fc0">*
</FONT><FONT COLOR="#7fa0c0">@throws </FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">SignTokenOfflineException
if SignToken is not available or</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
connected.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@return
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">PublicKey
object</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
abstract </FONT></FONT></B><FONT FACE="CourierNewPSMT">PublicKey
getPublicKey(</FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">int
</FONT></FONT></B><FONT FACE="CourierNewPSMT">purpose) </FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">throws
</FONT></FONT></B><FONT FACE="CourierNewPSMT">SignTokenOfflineException;</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**
Returns the signature Provider that should be used to sign things
with</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
the PrivateKey object returned by this signingdevice implementation.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">providerUsage
should be one if the ISignToken.PROVIDERUSAGE_ constants</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
specifying the usage of the privatekey.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@return
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">String
the name of the Provider</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
abstract </FONT></FONT></B><FONT FACE="CourierNewPSMT">String
getProvider(</FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">int
</FONT></FONT></B><FONT FACE="CourierNewPSMT">providerUsage);</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method returning the signertokens certificate if it's included in the
token.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
This method should only be implemented by soft signtokens which have
the certificate</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
included in the keystore.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
All other signtokens should return 'null' and let the signer fetch
the certificate from</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
database.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
abstract </FONT></FONT></B><FONT FACE="CourierNewPSMT">Certificate
getCertificate(</FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">int
</FONT></FONT></B><FONT FACE="CourierNewPSMT">purpose) </FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">throws
</FONT></FONT></B><FONT FACE="CourierNewPSMT">SignTokenOfflineException;</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method returning the signertokens certificatechain if it's included
in the token.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
This method should only be implemented by soft signtokens which have
the certificates</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
included in the keystore.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
All other signtokens should return 'null' and let the signer fetch
the certificate from</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT">*
<FONT COLOR="#3f5fc0">database.</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
abstract </FONT></FONT></B><FONT FACE="CourierNewPSMT">Collection
getCertificateChain(</FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">int
</FONT></FONT></B><FONT FACE="CourierNewPSMT">purpose) </FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">throws
</FONT></FONT></B><FONT FACE="CourierNewPSMT">SignTokenOfflineException;</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method used to tell the signer to create a certificate request using
its sign token.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
</FONT></FONT></B><FONT FACE="CourierNewPSMT">ISignerCertReqData
genCertificateRequest(ISignerCertReqInfo info) </FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">throws</FONT></FONT></B></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">SignTokenOfflineException;</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method used to remove a key in the signer that shouldn't be used any
more</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">purpose
on of ISignToken.PURPOSE_ constants</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@return
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">true
if removal was successfull.</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
boolean </FONT></FONT></B><FONT FACE="CourierNewPSMT">destroyKey(</FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">int
</FONT></FONT></B><FONT FACE="CourierNewPSMT">purpose);</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT STYLE="border-top: none; border-bottom: 1px solid #000000; border-left: none; border-right: none; padding-top: 0cm; padding-bottom: 0.07cm; padding-left: 0cm; padding-right: 0cm">
<FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">}</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<H2 LANG="en-GB" CLASS="western">16.3The IService Interface</SPAN></H2>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>There
are two kinds of services, singleton or non-singleton. A singleton
service is only run at one of</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>the
nodes at the time while non-singleton services are run at all nodes
simultaneously. If a singleton</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>service
fails to run on one of the nodes will one of the other nodes take
over the service</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>automatically.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">If
a service should be singleton or not is determined by a standard
property </FONT><B><I><FONT FACE="TimesNewRomanPS-BoldItalicMT">SINGLETON
</FONT></I></B><FONT FACE="TimesNewRomanPSMT">defined</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>in
the ServiceConfig class.</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>Other
basic properties used to configure all services are:</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><B><I><FONT FACE="CourierNewPS-BoldItalicMT">ACTIVE
</FONT></I></B><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">when set
to </FONT></FONT><FONT FACE="CourierNewPSMT">&ldquo;TRUE&rdquo; </FONT><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">means
that the service is active and should be run.</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><B><I><FONT FACE="CourierNewPS-BoldItalicMT">INTERVAL
</FONT></I></B><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">defining
the interval in seconds of how often the service should be run.</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>To
create a customized service perform the following steps:</FONT></FONT></P>
<UL>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Create
	a custom service class implementing the
	org.signserver.server.service.IService interface. There exists a
	BaseService that can be inherited taking care of most of the basic
	functionality. If the BaseService is inherited only one method
	work() needs to be implemented.</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">You
	can define your own properties that the service can use for
	configuration.</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Make
	sure the custom class is available to the application server</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Redeploy
	the signer server and it the signer is ready to be configured and
	then used.</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Register
	the service in the application by setting a property
	</FONT></FONT><FONT FACE="CourierNewPSMT">WORKER&lt;id&gt;.CLASSPATH
	</FONT><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">with a global
	scope in the global configuration.</FONT></FONT></FONT></FONT></P>
	<LI><P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Reload
	the service with the CLI reload command.<BR></FONT></FONT></FONT></FONT><BR>
	</P>
</UL>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT STYLE="border-top: none; border-bottom: 1px solid #000000; border-left: none; border-right: none; padding-top: 0cm; padding-bottom: 0.07cm; padding-left: 0cm; padding-right: 0cm">
<FONT SIZE=3><FONT FACE="TimesNewRomanPSMT"><FONT COLOR="#000000">The
work method that needs to be implemented is described here:</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method that should do the actual work and should</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
be implemented by all services. The method is run</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
at a periodical interval defined in getNextInterval.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@throws
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">ServiceExecutionFailedException
if execution of a service failed</FONT></FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
void </FONT></FONT></B><FONT FACE="CourierNewPSMT">work() </FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">throws
</FONT></FONT></B><FONT FACE="CourierNewPSMT">ServiceExecutionFailedException;</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" STYLE="border-top: none; border-bottom: 1px solid #000000; border-left: none; border-right: none; padding-top: 0cm; padding-bottom: 0.07cm; padding-left: 0cm; padding-right: 0cm">
<BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H2 LANG="en-GB" CLASS="western">16.4Using the Global Configuration
Store</SPAN></H2>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>The
global configuration store is a memory bank that signers and services
can use to store data used</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>in
ongoing operations. The data can be either node (i.e. only read by
the current node) or global</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>scoped.<BR></FONT></FONT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">To
access the global configuration store use the
</FONT></FONT><FONT FACE="CourierNewPSMT">getGlobalConfigurationSession()
</FONT><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">method</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>from
the BaseWorker (inherited by both the BaseSigner and BaseService).
The returned</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>GlobalConfigurationSession
have the following methods that can be used (the other should be</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>avoided)</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" STYLE="border-top: none; border-bottom: 1px solid #000000; border-left: none; border-right: none; padding-top: 0cm; padding-bottom: 0.07cm; padding-left: 0cm; padding-right: 0cm">
<BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method setting a global configuration property. For node. prefix will
the</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">node
id be appended.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">scope,
one of the GlobalConfiguration.SCOPE_ constants</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">key
of the property should not have any scope prefix, never null</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">value
the value, never null.</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
void </FONT></FONT></B><FONT FACE="CourierNewPSMT">setProperty(
java.lang.String scope,java.lang.String</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">key,java.lang.String
value ) ;</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method used to remove a property from the global configuration.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">scope,
one of the GlobalConfiguration.SCOPE_ constants</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@param
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">key
of the property should start with either glob. or node., never</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">null</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@return
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">true
if removal was successful, othervise false.</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
boolean </FONT></FONT></B><FONT FACE="CourierNewPSMT">removeProperty(
java.lang.String scope,java.lang.String key )</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">;</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">/**</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*
Method that returns all the global properties with Global Scope and
Node</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">scopes
properties for this node.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">*
</FONT></FONT><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7fa0c0">@return
</FONT></FONT></B><FONT FACE="CourierNewPSMT"><FONT COLOR="#3f5fc0">A
GlobalConfiguration Object, nevel null</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT COLOR="#3f5fc0"><FONT FACE="CourierNewPSMT"><FONT SIZE=1 STYLE="font-size: 8pt">*/</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=1 STYLE="font-size: 8pt"><B><FONT FACE="CourierNewPS-BoldMT"><FONT COLOR="#7f0055">public
</FONT></FONT></B><FONT FACE="CourierNewPSMT">org.signserver.common.GlobalConfiguration
getGlobalConfiguration( ) ;</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" STYLE="border-top: none; border-bottom: 1px solid #000000; border-left: none; border-right: none; padding-top: 0cm; padding-bottom: 0.07cm; padding-left: 0cm; padding-right: 0cm">
<BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>The
getGlobalConfiguration returns a GlobalConfiguration and have a
method</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT FACE="CourierNewPSMT">String
getProperty(String scope, String property) </FONT><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">that
can be used.</FONT></FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>The
value of the property can be user-defined as long as it is guaranteed
to be unique over the entire</FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="TimesNewRomanPSMT"><FONT SIZE=3>application.<BR></FONT></FONT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><FONT FACE="Verdana"><FONT SIZE=2><FONT SIZE=3><FONT FACE="TimesNewRomanPSMT">Reserved
values are all property keys starting with &ldquo;</FONT></FONT><FONT FACE="CourierNewPSMT">WORKER&rdquo;.</FONT></FONT></FONT></P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT><BR>
</P>
<P LANG="en-GB" CLASS="western" ALIGN=LEFT STYLE="page-break-before: always">
<BR>
</P>
<H1 LANG="en-GB" CLASS="western">17 Testing</H1>
<P LANG="en-GB" CLASS="western">There exists some test scripts used
to test that the SignServer functions correctly. They are described
here.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<H2 LANG="en-GB" CLASS="western">17.1Automatic Junit Tests</SPAN></H2>
<P LANG="en-GB" CLASS="western">Automatic Junit tests lies in the
directory '<FONT SIZE=2><FONT FACE="Courier New, monospace">src/tests</FONT></FONT>'</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">To run the test suite do the
following:</P>
<UL>
	<LI><P LANG="en-GB" CLASS="western">Set the environment variable
	SIGNSERVER_HOME</P>
	<LI><P LANG="en-GB" CLASS="western">Make sure the sign server is
	deployed and JBoss is running</P>
	<LI><P LANG="en-GB" CLASS="western">do 'ant test:run' <BR><BR>
	</P>
</UL>
<H2 LANG="en-GB" CLASS="western">17.2The Test Client</SPAN></H2>
<P LANG="en-GB" CLASS="western">There exists a test client built with
the main distribution.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">It only works without client
authentication requirements and through HTTP.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">To run the client do</P>
<P LANG="en-GB" CLASS="western"><SAMP><FONT SIZE=2>ant</FONT></SAMP></P>
<P LANG="en-GB" CLASS="western"><SAMP><FONT SIZE=2>cd dist-client</FONT></SAMP></P>
<P LANG="en-GB" CLASS="western"><SAMP><FONT SIZE=2>java -jar
timeStampClient.jar
&ldquo;http://&lt;hostname&gt;:8080/signserver/tsa?signerId=1&rdquo;</FONT></SAMP></P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">It will continuously make one request
per second.</P>
<H2 LANG="en-GB" CLASS="western">17.3Manual Tests</SPAN></H2>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western">The time stamp signer have been
tested with the OpenTSA client with both HTTP and HTTPS.</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
<P LANG="en-GB" CLASS="western" STYLE="page-break-before: always"><BR>
</P>
<H1 LANG="en-GB" CLASS="western">18 References</H1>
<P LANG="en-GB" CLASS="western">Java 1.6 to 1.4 (http://java.sun.com)</P>
<P LANG="en-GB" CLASS="western">JBoss-4.0.5.GA (http://www.jboss.org)</P>
<P LANG="en-GB" CLASS="western">Ant version
1.7(<A HREF="http://ant.apache.org/">http://ant.apache.org</A>)</P>
<P LANG="en-GB" CLASS="western">Bouncycastle
(<A HREF="http://www.bouncycastle.org/">http://www.bouncycastle.org</A>)</P>
<P LANG="en-GB" CLASS="western">RFC3161, Time-Stamp Protocol (TSP)
(<A HREF="http://www.ietf.org/">http://www.ietf.org</A>)</P>
<P LANG="en-GB" CLASS="western"><BR>
</P>
</BODY>
</HTML>