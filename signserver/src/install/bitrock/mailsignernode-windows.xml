<project>
    <shortName>mailsignerserver</shortName>
    <fullName>SignServer MailSigner Server</fullName>
    <version>3.1</version>
    <readmeFile>../common/README-MailSigner.txt</readmeFile>
    <licenseFile>../../../doc/lgpl-2.1.txt</licenseFile>
    <!--<registerWithPackageDatabase>1</registerWithPackageDatabase> -->
    <vendor>PrimeKey Solutions AB</vendor>
    <summary>Server package of the SignServer MailSigner.</summary>
    <release>3.1</release>
    <description>Server package of the SignServer MailSigner.</description>
    <rebootRequired>0</rebootRequired>    
    <startMenuGroupName></startMenuGroupName>
    <preInstallationActionList>
        <setInstallerVariable>
                <name>installdir</name>
                <value>${env(PROGRAMFILES)}/MailSigner/MailSigner-${product_version}</value>
        </setInstallerVariable>
        <setInstallerVariable>
                <name>uninstallerName</name>
                <value>uninstall-${product_shortname}</value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>conffile</name>
            <persist>1</persist>
            <value>${env(SYSTEMROOT)}\mailsigner.conf</value>
        </setInstallerVariable>
        <setInstallerVariable>
            <name>servicename</name>
            <persist>1</persist>
            <value>MailSigner</value>
        </setInstallerVariable>
        <autodetectJava>
            <promptUser>0</promptUser>
            <validVersionList>
                <validVersion>
                    <maxVersion></maxVersion>
                    <minVersion>1.5.0</minVersion>
                    <requireJDK>0</requireJDK>
                    <vendor>sun</vendor>
                </validVersion>
            </validVersionList>
            <promptUser>0</promptUser>
        </autodetectJava>        
        <actionGroup>
            <actionList>
              <propertiesFileGet>
                <file>${conffile}</file>
                <variable>smtpport</variable>
                <key>mailsigner.smtpport</key>
                <ruleList>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>contains</logic>
                    <text>mailsigner.smtpport</text>
                  </fileContentTest>
                </ruleList>
              </propertiesFileGet>
              <propertiesFileGet>
                <file>${conffile}</file>
                <variable>primarydns</variable>
                <key>mailsigner.primarydns</key>
                <ruleList>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>contains</logic>
                    <text>mailsigner.primarydns</text>
                  </fileContentTest>
                </ruleList>
              </propertiesFileGet>
              <propertiesFileGet>
                <file>${conffile}</file>
                <variable>secondarydns</variable>
                <key>mailsigner.secondarydns</key>
                <ruleList>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>contains</logic>
                    <text>mailsigner.secondarydns</text>
                  </fileContentTest>
                </ruleList>
              </propertiesFileGet>
              <propertiesFileGet>
                <file>${conffile}</file>
                <variable>postmaster</variable>
                <key>mailsigner.postmaster</key>
                <ruleList>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>contains</logic>
                    <text>mailsigner.postmaster</text>
                  </fileContentTest>
                </ruleList>
              </propertiesFileGet>
              <propertiesFileGet>
                <file>${conffile}</file>
                <variable>smtpauth</variable>
                <key>mailsigner.smtpauth</key>
                <ruleList>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>contains</logic>
                    <text>mailsigner.smtpauth</text>
                  </fileContentTest>
                </ruleList>
              </propertiesFileGet>
              <propertiesFileGet>
                <file>${conffile}</file>
                <variable>gatewayhost</variable>
                <key>mailsigner.gatewayhost</key>
                <ruleList>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>contains</logic>
                    <text>mailsigner.gatewayhost</text>
                  </fileContentTest>
                </ruleList>
              </propertiesFileGet>
              <propertiesFileGet>
                <file>${conffile}</file>
                <variable>gatewayport</variable>
                <key>mailsigner.gatewayport</key>
                <ruleList>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>contains</logic>
                    <text>mailsigner.gatewayport</text>
                  </fileContentTest>
                </ruleList>
              </propertiesFileGet>
              <propertiesFileGet>
                <file>${conffile}</file>
                <variable>sysloghostname</variable>
                <key>syslog.hostname</key>
                <ruleList>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>contains</logic>
                    <text>syslog.hostname</text>
                  </fileContentTest>
                </ruleList>
              </propertiesFileGet>
            </actionList>
            <ruleEvaluationLogic>and</ruleEvaluationLogic>
            <ruleList>
                <platformTest>                    
                    <type>windows</type>
                </platformTest>
                <fileTest>                    
                  <path>${conffile}</path>
                  <condition>exists</condition>
                </fileTest>
            </ruleList>
         </actionGroup>        
    </preInstallationActionList>
    <postInstallationActionList>
        <actionGroup>
            <actionList>
                <runProgram>
                  <program>Wrapper.exe</program>
                  <programArguments> -i ..\conf\wrapper_mailsigner.conf</programArguments>
                  <workingDirectory>${installdir}/james/bin</workingDirectory>
                </runProgram>
                <addEnvironmentVariable>
                    <name>SIGNSERVER_HOME</name>
                    <scope>system</scope>
                    <value>${installdir}</value>
                </addEnvironmentVariable>
                <addEnvironmentVariable>
                    <name>PHOENIX_HOME</name>
                    <scope>system</scope>
                    <value>${installdir}\james</value>
                </addEnvironmentVariable>

                <copyFile>
		  <origin>${installdir}/james/apps/james/SAR-INF/config_org.xml</origin>
		  <destination>${installdir}/james/apps/james/SAR-INF/config.xml</destination>
                </copyFile>
                <substitute>
                  <files>${installdir}/james/apps/james/SAR-INF/config.xml</files>
                  <substitutionList>
                    <substitution>
                      <pattern>@mailsigner.postmaster@</pattern>
                      <value>${postmaster}</value>
                    </substitution>
                    <substitution>
                      <pattern>@mailsigner.primarydns@</pattern>
                      <value>${primarydns}</value>
                    </substitution>
                    <substitution>
                      <pattern>@mailsigner.secondarydns@</pattern>
                      <value>${secondarydns}</value>
                    </substitution>
                    <substitution>
                      <pattern>@mailsigner.mailetpackage@</pattern>
                      <value>org.signserver.mailsigner.core</value>
                    </substitution>
                    <substitution>
                      <pattern>@mailsigner.mailetname@</pattern>
                      <value>MailSignerContainerMailet</value>
                    </substitution>
                    <substitution>
                      <pattern>@mailsigner.smtpport@</pattern>
                      <value>${smtpport}</value>
                    </substitution>
                    <substitution>
                      <pattern>@mailsigner.smtpauth@</pattern>
                      <value>${smtpauth}</value>
                    </substitution>
                  </substitutionList>
                </substitute>
               <substitute>
                  <files>${installdir}/james/apps/james/SAR-INF/config.xml</files>
                  <substitutionList>
                    <substitution>
                      <pattern>!--@GATEWAYHOST1@</pattern>
                      <value>gateway>${gatewayhost}</value>
                    </substitution>
                    <substitution>
                      <pattern>!--@GATEWAYPORT1@</pattern>
                      <value>gatewayPort>${gatewayport}</value>
                    </substitution> 
                    <substitution>
                      <pattern>@GATEWAYHOST2@--</pattern>
                      <value>/gateway</value>
                    </substitution>
                    <substitution>
                      <pattern>@GATEWAYPORT2@--</pattern>
                      <value>/gatewayPort</value>
                    </substitution>                    
                  </substitutionList>
                   <ruleEvaluationLogic>or</ruleEvaluationLogic>
                   <ruleList>
                     <ruleGroup>
                       <ruleEvaluationLogic>and</ruleEvaluationLogic>
                       <ruleList>
                          <fileTest>                    
                            <path>${conffile}</path>
                            <condition>exists</condition>
                          </fileTest>
                          <fileContentTest>
                            <path>${conffile}</path>
                            <logic>contains</logic>
                            <text>mailsigner.gatewayhost</text>
                          </fileContentTest>
                          <fileContentTest>
                            <path>${conffile}</path>
                            <logic>contains</logic>
                            <text>mailsigner.gatewayport</text>
                          </fileContentTest>
                        </ruleList>
                     </ruleGroup>
                     <compareText>
                      <text>${usegateway}</text>
                      <logic>equals</logic>
                      <value>1</value>
                     </compareText>
                   </ruleList>
                </substitute>
                
                <createDirectory>
                   <path>${installdir}/james/ext</path>
                </createDirectory>
                <createDirectory>
                   <path>${installdir}/james/logs</path>
                </createDirectory>

                <actionGroup>
                   <actionList>
                     <deleteFile>
                       <path>${installdir}/james/apps/james/SAR-INF/environment.xml</path>
                     </deleteFile>
                     <copyFile>
                       <destination>${installdir}/james/apps/james/SAR-INF/environment.xml</destination>
                       <origin>${installdir}/logconf/james-environment-windows.xml</origin>
                     </copyFile> 
                   </actionList>
                   <ruleEvaluationLogic>or</ruleEvaluationLogic>
                   <ruleList>
                     <compareText>
                      <text>${usesyslog}</text>
                      <logic>equals</logic>
                      <value>0</value>
                     </compareText> 
                     <fileTest>                    
                        <path>${conffile}</path>
                        <condition>not_exists</condition>
                     </fileTest>
                     <fileContentTest>
                        <path>${conffile}</path>
                        <logic>does_not_contain</logic>
                        <text>syslog.hostname</text>
                     </fileContentTest>                     
                   </ruleList>
                </actionGroup>
                <actionGroup>
                   <actionList>
                     <deleteFile>
                       <path>${installdir}/james/apps/james/SAR-INF/environment.xml</path>
                     </deleteFile>
                     <copyFile>
                       <destination>${installdir}/james/apps/james/SAR-INF/environment.xml</destination>
                       <origin>${installdir}/logconf/james-environment-windows-syslog.xml</origin>
                     </copyFile> 
                     <substitute>
                       <files>${installdir}/james/apps/james/SAR-INF/environment.xml</files>
                       <substitutionList>
                         <substitution>
                           <pattern>@SYSLOG_HOST@</pattern>
                           <value>${sysloghostname}</value>
                         </substitution>
                       </substitutionList>
                     </substitute>
                   </actionList>
                   <ruleEvaluationLogic>or</ruleEvaluationLogic>
                   <ruleList>
                     <ruleGroup>
                       <ruleEvaluationLogic>and</ruleEvaluationLogic>
                       <ruleList>
                          <fileTest>                    
                            <path>${conffile}</path>
                            <condition>exists</condition>
                          </fileTest>
                          <fileContentTest>
                            <path>${conffile}</path>
                            <logic>contains</logic>
                            <text>syslog.hostname</text>
                          </fileContentTest>
                        </ruleList>
                     </ruleGroup>
                     <compareText>
                      <text>${usesyslog}</text>
                      <logic>equals</logic>
                      <value>1</value>
                     </compareText>
                   </ruleList>
                </actionGroup>
                <addTextToFile>
                  <file>${conffile}</file>
                  <text>#MailSigner properties file.</text>
                  <ruleList>
                    <fileTest>                    
                      <path>${conffile}</path>
                      <condition>not_exists</condition>
                    </fileTest>
                  </ruleList>
                </addTextToFile>                                           
                <propertiesFileSet>
                  <file>${conffile}</file>
                  <key>mailsigner.smtpport</key>
                  <value>${smtpport}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                  <file>${conffile}</file>
                  <key>mailsigner.primarydns</key>
                  <value>${primarydns}</value>
                </propertiesFileSet>
                <propertiesFileSet>
                  <file>${conffile}</file>
                  <key>mailsigner.secondarydns</key>
                  <value>${secondarydns}</value>
                </propertiesFileSet> 
                <propertiesFileSet>
                  <file>${conffile}</file>
                  <key>mailsigner.postmaster</key>
                  <value>${postmaster}</value>
                </propertiesFileSet> 
                <propertiesFileSet>
                  <file>${conffile}</file>
                  <key>mailsigner.smtpauth</key>
                  <value>${smtpauth}</value>
                </propertiesFileSet> 
                <actionGroup>
                  <actionList>
                    <propertiesFileSet>
                      <file>${conffile}</file>
                      <key>mailsigner.gatewayhost</key>
                      <value>${gatewayhost}</value>
                    </propertiesFileSet> 
                  </actionList>
                  <ruleEvaluationLogic>or</ruleEvaluationLogic>
                  <ruleList>
                     <ruleGroup>
                       <ruleEvaluationLogic>and</ruleEvaluationLogic>
                       <ruleList>
                          <fileTest>                    
                            <path>${conffile}</path>
                            <condition>exists</condition>
                          </fileTest>
                          <fileContentTest>
                            <path>${conffile}</path>
                            <logic>contains</logic>
                            <text>gatewayhost</text>
                          </fileContentTest>
                        </ruleList>
                     </ruleGroup>
                     <compareText>
                      <text>${usegateway}</text>
                      <logic>equals</logic>
                      <value>1</value>
                     </compareText>
                   </ruleList>
                </actionGroup>
                <actionGroup>
                  <actionList>
                    <propertiesFileSet>
                      <file>${conffile}</file>
                      <key>mailsigner.gatewayport</key>
                      <value>${gatewayport}</value>
                    </propertiesFileSet> 
                  </actionList>
                  <ruleEvaluationLogic>or</ruleEvaluationLogic>
                  <ruleList>
                     <ruleGroup>
                       <ruleEvaluationLogic>and</ruleEvaluationLogic>
                       <ruleList>
                          <fileTest>                    
                            <path>${conffile}</path>
                            <condition>exists</condition>
                          </fileTest>
                          <fileContentTest>
                            <path>${conffile}</path>
                            <logic>contains</logic>
                            <text>gatewayport</text>
                          </fileContentTest>
                        </ruleList>
                     </ruleGroup>
                     <compareText>
                      <text>${usegateway}</text>
                      <logic>equals</logic>
                      <value>1</value>
                     </compareText>
                   </ruleList>
                </actionGroup>
                <actionGroup>
                  <actionList>
                    <propertiesFileSet>
                      <file>${conffile}</file>
                      <key>syslog.hostname</key>
                      <value>${sysloghostname}</value>
                    </propertiesFileSet> 
                  </actionList>
                  <ruleEvaluationLogic>or</ruleEvaluationLogic>
                  <ruleList>
                     <ruleGroup>
                       <ruleEvaluationLogic>and</ruleEvaluationLogic>
                       <ruleList>
                          <fileTest>                    
                            <path>${conffile}</path>
                            <condition>exists</condition>
                          </fileTest>
                          <fileContentTest>
                            <path>${conffile}</path>
                            <logic>contains</logic>
                            <text>syslog.hostname</text>
                          </fileContentTest>
                        </ruleList>
                     </ruleGroup>
                     <compareText>
                      <text>${usesyslog}</text>
                      <logic>equals</logic>
                      <value>1</value>
                     </compareText>
                   </ruleList>
                </actionGroup>
                <showInfo>
                  <text>

About to start the James MailSigner Server. This will be done in the background and will be ready to process requests in about 1 minute.
</text>
                </showInfo>
                <startWindowsService>
                  <serviceName>${servicename}</serviceName>
                </startWindowsService>
            </actionList>
            <ruleEvaluationLogic>or</ruleEvaluationLogic>
            <ruleList>
                <platformTest>                    
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </actionGroup>
        
    </postInstallationActionList>
    <preUninstallationActionList>
       <actionGroup>
         <actionList>
           <showInfo>
             <text>

Before uninstalling the MailSigner must James MailSigner be stopped. This might take a few seconds.

</text>
          
           </showInfo>
           <stopWindowsService>
             <serviceName>${servicename}</serviceName>
           </stopWindowsService>
           <waitForPort>
             <state>free</state>
             <port>1099</port>
             <timeout>240000</timeout>
           </waitForPort>
           <runProgram>
             <program>Wrapper.exe</program>
             <programArguments> -r ..\conf\wrapper_mailsigner.conf</programArguments>
             <workingDirectory>${installdir}/james/bin</workingDirectory>
           </runProgram>
         </actionList>
         <ruleList>
           <portTest>
              <port>1099</port>
              <condition>cannot_bind</condition>
           </portTest>
         </ruleList>
      </actionGroup>
    </preUninstallationActionList>
    <postUninstallationActionList>
        <actionGroup>
          <actionList>
            <showQuestion>
            <text>
Do you want to remove the configuration file ${conffile} ?</text>
             <variable>remove_config</variable>
             <default>no</default>
            </showQuestion>
            <actionGroup>
             <actionList>
               <deleteFile>
                 <path>${conffile}</path>
               </deleteFile>
              </actionList>
              <ruleList>
                 <compareText>
                    <text>${remove_config}</text>
                    <logic>equals</logic>
                    <value>yes</value>
                 </compareText>
              </ruleList>
            </actionGroup> 
           <deleteEnvironmentVariable>
                    <name>SIGNSERVER_HOME</name>
                    <scope>system</scope>
            </deleteEnvironmentVariable>
           <deleteEnvironmentVariable>
                    <name>PHEONIX_HOME</name>
                    <scope>system</scope>
            </deleteEnvironmentVariable>
            <deleteFile>
              <path>${installdir}/james</path>
            </deleteFile>
            <actionGroup>
             <actionList>
                <deleteFile>
                  <path>${installdir}</path>                   
                </deleteFile>
             </actionList>
             <ruleList>
               <fileTest>
                 <path>${installdir}</path>
                 <condition>is_empty</condition>
               </fileTest> 
             </ruleList>
           </actionGroup>
         </actionList>
            <ruleEvaluationLogic>or</ruleEvaluationLogic>
            <ruleList>
                <platformTest>                    
                    <type>windows</type>
                </platformTest>
            </ruleList>
      </actionGroup>
    </postUninstallationActionList>
    <enableRollback>1</enableRollback>
    <requireInstallationByRootUser>1</requireInstallationByRootUser>
    <saveRelativePaths>1</saveRelativePaths>
                    
    <componentList>
        <component>
            <name>default</name>
            <description>Default Component</description>
            <canBeEdited>1</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfiles</name>
                    <platforms>all</platforms>
                    <shortcutList>
                        <shortcut>
                            <comment>Uninstall</comment>
                            <exec>${installdir}/${uninstallerName}</exec>
                            <icon></icon>
                            <name>Uninstall ${product_fullname}</name>
                            <path>${installdir}</path>
                            <platforms>all</platforms>
                            <runInTerminal>0</runInTerminal>
                            <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                            <windowsExecArgs></windowsExecArgs>
                            <windowsIcon></windowsIcon>
                            <windowsPath>${installdir}</windowsPath>
                        </shortcut>
                        <fileShortcut>
                            <comment>MailSigner installation configuration</comment>
                            <filePath>${conffile}</filePath>
                            <icon></icon>
                            <name>mailsigner.conf</name>
                            <platforms>windows</platforms>
                            <runInTerminal>0</runInTerminal>
                            <windowsIcon></windowsIcon>
                            <windowsPath>${installdir}</windowsPath>
                        </fileShortcut>
                        <fileShortcut>
                            <comment>MailSigner log configuration</comment>
                            <filePath>${installdir}/james/apps/james/SAR-INF/environment.xml</filePath>
                            <icon></icon>
                            <name>log-conf.xml</name>
                            <platforms>windows</platforms>
                            <runInTerminal>0</runInTerminal>
                            <windowsIcon></windowsIcon>
                            <windowsPath>${installdir}</windowsPath>
                        </fileShortcut>
                        <fileShortcut>
                            <comment>MailSigner SMTP configuration</comment>
                            <filePath>${installdir}/james/apps/james/SAR-INF/config.xml</filePath>
                            <icon></icon>
                            <name>mailsigner-conf.xml</name>
                            <platforms>windows</platforms>
                            <runInTerminal>0</runInTerminal>
                            <windowsIcon></windowsIcon>
                            <windowsPath>${installdir}</windowsPath>
                        </fileShortcut>
                    </shortcutList>
                </folder>
                <folder>
                    <description>Program Files</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>../../../dist-pkg/usr/share/mailsigner-server/bin</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>../../../dist-pkg/usr/share/mailsigner-server/james</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>../../../dist-pkg/usr/share/mailsigner-server/logconf</origin>
                        </distributionDirectory>                       
                    </distributionFileList>
                </folder>
            </folderList>
        </component>
    </componentList>

    <parameterList>
        <stringParameter>
          <name>smtpport</name>
          <default>25</default>
          <description>SMTP Port</description>
          <explanation>Enter the port that the server should listen to (default is 25). </explanation>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>smtpport</cliOptionName>
            <ruleEvaluationLogic>or</ruleEvaluationLogic>
            <ruleList>
              <fileTest>                    
                <path>${conffile}</path>
                <condition>not_exists</condition>
              </fileTest>
              <fileContentTest>
                <path>${conffile}</path>
                <logic>does_not_contain</logic>
                <text>mailsigner.smtpport</text>
              </fileContentTest>
            </ruleList>
        </stringParameter>
        <parameterGroup>
          <name>dnsservers</name>
          <description>DNS Server Configuration</description>
          <explanation>Please IP addresses of the primary and secondary DNS servers.</explanation>
          <parameterList>
            <stringParameter>
              <name>primarydns</name>
              <default></default>
              <allowEmptyValue>0</allowEmptyValue>
              <description>Primary DNS Server</description>
              <cliOptionName>primarydns</cliOptionName>
            </stringParameter>  
            <stringParameter>
              <name>secondarydns</name>
              <default></default>
              <allowEmptyValue>0</allowEmptyValue>
              <description>Secondary DNS Server</description>
              <cliOptionName>secondarydns</cliOptionName>
            </stringParameter>    
          </parameterList>  
            <ruleEvaluationLogic>or</ruleEvaluationLogic>
            <ruleList>
              <fileTest>                    
                <path>${conffile}</path>
                <condition>not_exists</condition>
              </fileTest>
              <ruleGroup>
                <ruleEvaluationLogic>and</ruleEvaluationLogic>
                <ruleList>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>does_not_contain</logic>
                    <text>mailsigner.primarydns</text>
                  </fileContentTest>
                  <fileContentTest>
                    <path>${conffile}</path>
                    <logic>does_not_contain</logic>
                    <text>mailsigner.secondarydns</text>
                  </fileContentTest>
                </ruleList>
              </ruleGroup>
            </ruleList>    
        </parameterGroup>  
        <stringParameter>
          <name>postmaster</name>
          <default></default>
          <description>Postmaster address</description>
          <explanation>Enter the e-mail address of the Post Master (main administrator).</explanation>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>postmaster</cliOptionName>
            <ruleEvaluationLogic>or</ruleEvaluationLogic>
            <ruleList>
               <fileTest>                    
                  <path>${conffile}</path>
                  <condition>not_exists</condition>
               </fileTest>
               <fileContentTest>
                 <path>${conffile}</path>
                 <logic>does_not_contain</logic>
                 <text>mailsigner.postmaster</text>
               </fileContentTest>
            </ruleList>            
        </stringParameter>
      <choiceParameter>
          <ask>1</ask>
          <default>true</default>
          <description>Use STMP Authentication?</description>
          <explanation></explanation>
          <title>Use SMTP Auth</title>
          <name>smtpauth</name>
           <optionList>
              <option>
                <value>true</value>
                <text>True, but not to trusted addresses</text>
              </option>
              <option>
                <value>announce</value>
                <text>Announce, Always announce AUTH</text>
              </option>
              <option>
                <value>false</value>
                <text>False, don't use SMTP Auth</text>
              </option>
            </optionList>
            <ruleEvaluationLogic>or</ruleEvaluationLogic>
            <ruleList>
                <fileTest>                    
                  <path>${conffile}</path>
                  <condition>not_exists</condition>
                </fileTest>
                <fileContentTest>
                  <path>${conffile}</path>
                  <logic>does_not_contain</logic>
                  <text>mailsigner.smtpauth</text>
                </fileContentTest>
            </ruleList>
        </choiceParameter>
        <booleanParameter>
          <name>usegateway</name>
          <ask>yes</ask>
          <default>0</default>
          <title>Use Forwarding Gateway</title>
          <explanation>Should emails be forwarded through a gateway SMTP server.</explanation>
          <cliOptionName>usegateway</cliOptionName>
          <ruleEvaluationLogic>or</ruleEvaluationLogic>
          <ruleList>
               <fileTest>                    
                 <path>${conffile}</path>
                 <condition>not_exists</condition>
               </fileTest>
               <fileContentTest>
                 <path>${conffile}</path>
                 <logic>does_not_contain</logic>
                 <text>mailsigner.gatewayhost</text>
               </fileContentTest>
            </ruleList>
        </booleanParameter>
       <stringParameter>
          <name>gatewayhost</name>
          <default>localhost</default>
          <description>Hostname of gateway</description>
          <explanation>Enter the hostname of the gateway SMTP server.</explanation>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>gatewayhost</cliOptionName>
            <ruleEvaluationLogic>and</ruleEvaluationLogic>
            <ruleList>
              <ruleGroup>
                <ruleEvaluationLogic>or</ruleEvaluationLogic>
                <ruleList>
                   <fileTest>                    
                     <path>${conffile}</path>
                     <condition>not_exists</condition>
                   </fileTest>
                   <fileContentTest>
                      <path>${conffile}</path>
                      <logic>does_not_contain</logic>
                      <text>mailsigner.gatewayhost</text>
                   </fileContentTest>
                </ruleList>
              </ruleGroup>
               <compareText>
                    <text>${usegateway}</text>
                    <logic>equals</logic>
                    <value>1</value>
               </compareText>
            </ruleList>
        </stringParameter>
       <stringParameter>
          <name>gatewayport</name>
          <default>25</default>
          <description>Port of gateway</description>
          <explanation>Enter the port of the gateway SMTP server.</explanation>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>gatewayport</cliOptionName>
            <ruleEvaluationLogic>and</ruleEvaluationLogic>
            <ruleList>
              <ruleGroup>
                <ruleEvaluationLogic>or</ruleEvaluationLogic>
                <ruleList>
                   <fileTest>                    
                     <path>${conffile}</path>
                     <condition>not_exists</condition>
                   </fileTest>
                   <fileContentTest>
                      <path>${conffile}</path>
                      <logic>does_not_contain</logic>
                      <text>mailsigner.gatewayport</text>
                   </fileContentTest>
                </ruleList>
              </ruleGroup>
               <compareText>
                    <text>${usegateway}</text>
                    <logic>equals</logic>
                    <value>1</value>
               </compareText>
            </ruleList>
        </stringParameter>
        <booleanParameter>
          <name>usesyslog</name>
          <ask>yes</ask>
          <default>0</default>
          <title>Use Syslog</title>
          <explanation>Do you want to send events to Syslog?</explanation>
          <cliOptionName>usesyslog</cliOptionName>
          <ruleEvaluationLogic>or</ruleEvaluationLogic>
          <ruleList>
               <fileTest>                    
                 <path>${conffile}</path>
                 <condition>not_exists</condition>
               </fileTest>
               <fileContentTest>
                 <path>${conffile}</path>
                 <logic>does_not_contain</logic>
                 <text>syslog.hostname</text>
               </fileContentTest>
            </ruleList>
        </booleanParameter>
        <stringParameter>
          <name>sysloghostname</name>
          <default>localhost</default>
          <description>Syslog Hostname</description>
          <explanation>Enter the hostname of the Syslog server.</explanation>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>sysloghostname</cliOptionName>
            <ruleEvaluationLogic>and</ruleEvaluationLogic>
            <ruleList>
              <ruleGroup>
                <ruleEvaluationLogic>or</ruleEvaluationLogic>
                <ruleList>
                   <fileTest>                    
                     <path>${conffile}</path>
                     <condition>not_exists</condition>
                   </fileTest>
                   <fileContentTest>
                      <path>${conffile}</path>
                      <logic>does_not_contain</logic>
                      <text>syslog.hostname</text>
                   </fileContentTest>
                </ruleList>
              </ruleGroup>
               <compareText>
                    <text>${usesyslog}</text>
                    <logic>equals</logic>
                    <value>1</value>
               </compareText>
            </ruleList>
        </stringParameter>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value>${platform_install_prefix}/${product_shortname}-${product_version}</value>
            <default>${platform_install_prefix}/${product_shortname}-${product_version}</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>yes</mustBeWritable>
            <mustExist>0</mustExist>
            <width>40</width>
        </directoryParameter>
    </parameterList>

</project>

