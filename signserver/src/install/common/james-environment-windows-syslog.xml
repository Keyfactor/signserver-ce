<?xml version="1.0"?>

<server>

  <!-- Overrides the default behaviour of phoenix that use "." as dir --> 
  <!-- and /SAR-INF/lib/*.jar as include resulting in a full scan -->
  <!-- of the james folder and very slow startup when there are a lot of -->
  <!-- messages in var -->
  <!-- -->
  <classloaders default="default" version="1.0">
    <classloader name="default" parent="*system*">
      <entry location="./SAR-INF/classes" />
      <fileset dir="./SAR-INF/lib">
        <include name="*.jar" />
      </fileset>
    </classloader>
    <predefined name="*system*" />
  </classloaders>

<logs version="log4j" xmlns:log4j="http://jakarta.apache.org/log4j/" debug="false">

          <!-- Send only error messages to stdout -->
          <appender name="STDOUT" class="org.apache.log4j.ConsoleAppender">
            <param name="Threshold" value="ERROR"/>
            <layout class="org.apache.log4j.PatternLayout">
              <param name="ConversionPattern" value="%d %-5p [%t] %C{2} (%F:%L) - %m%n"/>
            </layout>
          </appender>

          <!-- Log messages to a file and rotate it everyday at midnight -->
          <appender name="DATE_LOGFILE" class="org.apache.log4j.DailyRollingFileAppender">
            <param name="File" value="../logs/james.log"/>
            <param name="Append" value="true"/>
            <param name="Threshold" value="INFO"/>
            <!-- Rollover at midnight each day -->
            <param name="DatePattern" value="'.'yyyy-MM-dd"/>
            <!-- Message layout format -->
            <layout class="org.apache.log4j.PatternLayout">
              <param name="ConversionPattern" value="%d %-5p [%c] %m%n"/>
            </layout>
          </appender>
          
          <!-- Syslog events -->
          <appender name="SYSLOG" class="org.apache.log4j.net.SyslogAppender">              
            <param name="Facility" value="LOCAL7"/>
            <param name="Threshold" value="INFO"/>
            <param name="FacilityPrinting" value="true"/>
            <param name="SyslogHost" value="@SYSLOG_HOST@"/>
            <layout class="org.apache.log4j.PatternLayout">
              <param name="ConversionPattern" value="[%d{ABSOLUTE},%c{1}] %m%n"/>
            </layout>
          </appender>

          <!-- CATEGORIES -->

          <category name="smtpserver">
            <priority value="INFO"/>
          </category>
          <category name="spoolmanager">
            <priority value="INFO"/>
          </category>
          <category name="James.Mailet">
            <priority value="INFO"/>
          </category>
          <!-- Do not show INFO about Apache utilities -->
          <category name="org.apache">
            <priority value="WARN"/>
          </category>
          <!--
          Some categories to choose :
            James.Mailet, James, spoolmanager, dnsserver,
            remotemanager, pop3server, smtpserver, nntpserver,
            nntp-repository, mailstore, users-store, objectstorage,
            connections, sockets, scheduler, fetchpop, fetchmail, ...
          -->

          <!-- ROOT CATEGORY -->

          <root>
            <priority value="DEBUG"/>
            <appender-ref ref="DATE_LOGFILE"/>
            <appender-ref ref="STDOUT" />            
            <appender-ref ref="SYSLOG" />            
          </root>

  </logs>
</server>
